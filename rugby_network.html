<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rugby Network</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="rugby_network_files/libs/clipboard/clipboard.min.js"></script>
<script src="rugby_network_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="rugby_network_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="rugby_network_files/libs/quarto-html/popper.min.js"></script>
<script src="rugby_network_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rugby_network_files/libs/quarto-html/anchor.min.js"></script>
<link href="rugby_network_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rugby_network_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rugby_network_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rugby_network_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rugby_network_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script type="module" src="rugby_network_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="rugby_network_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rugby Network</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="11" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 10;"><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>personal_colours <span class="op">=</span> [</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#0080AB"</span><span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#C9197D"</span><span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#1E7B20"</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#914278"</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#28412C"</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D11F0B"</span><span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#4224BF"</span><span class="op">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#88502E"</span><span class="op">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#100739"</span><span class="op">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#370E01"</span><span class="op">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2F65D0"</span><span class="op">,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#9F04FC"</span><span class="op">,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#3399BC"</span><span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D44797"</span><span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#4B954D"</span><span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A76893"</span><span class="op">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#536756"</span><span class="op">,</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#DA4C3C"</span><span class="op">,</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#6850CC"</span><span class="op">,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A07358"</span><span class="op">,</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#403961"</span><span class="op">,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#5F3E34"</span><span class="op">,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#5984D9"</span><span class="op">,</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B236FD"</span><span class="op">,</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#66B3CD"</span><span class="op">,</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#DF75B1"</span><span class="op">,</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#78B079"</span><span class="op">,</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#BD8EAE"</span><span class="op">,</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#7E8D80"</span><span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E3796D"</span><span class="op">,</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#8E7CD9"</span><span class="op">,</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B89682"</span><span class="op">,</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#706A88"</span><span class="op">,</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#876E67"</span><span class="op">,</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#82A3E3"</span><span class="op">,</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#C568FD"</span><span class="op">,</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#99CCDD"</span><span class="op">,</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E9A3CB"</span><span class="op">,</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A5CAA6"</span><span class="op">,</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D3B3C9"</span><span class="op">,</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#A9B3AB"</span><span class="op">,</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#EDA59D"</span><span class="op">,</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B3A7E5"</span><span class="op">,</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#CFB9AB"</span><span class="op">,</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#9F9CB0"</span><span class="op">,</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#AF9F99"</span><span class="op">,</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ACC1EC"</span><span class="op">,</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D99BFE"</span><span class="op">,</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#CCE6EE"</span><span class="op">,</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#F4D1E5"</span><span class="op">,</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D2E5D2"</span><span class="op">,</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E9D9E4"</span><span class="op">,</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D4D9D5"</span><span class="op">,</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#F6D2CE"</span><span class="op">,</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D9D3F2"</span><span class="op">,</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#E7DCD5"</span><span class="op">,</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#CFCDD7"</span><span class="op">,</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D7CFCC"</span><span class="op">,</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#D5E0F6"</span><span class="op">,</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ECCDFE"</span><span class="op">,</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sparkbar</span>(max) {</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x) <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #66B3CD;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: </span><span class="sc">${</span>(<span class="dv">100</span> <span class="op">*</span> x) <span class="op">/</span> max<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="vs">          float: right;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding-right: 3px;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="vs">          box-sizing: border-box;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="vs">          overflow: visible;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="vs">          justify-content: end;"&gt;</span><span class="sc">${</span>x<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sparkbarPercent</span>(max) {</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x) <span class="kw">=&gt;</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="vs">          background: #66B3CD;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: </span><span class="sc">${</span>(<span class="dv">100</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(x)) <span class="op">/</span> max<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="vs">          float: right;</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="vs">          padding-right: 3px;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="vs">          box-sizing: border-box;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="vs">          overflow: visible;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="vs">          display: flex;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="vs">          justify-content: end;"&gt;</span><span class="sc">${</span>x<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-GB"</span><span class="op">,</span> {</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>              <span class="dt">style</span><span class="op">:</span> <span class="st">"percent"</span><span class="op">,</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>              <span class="dt">minimumFractionDigits</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>              <span class="dt">maximumFractionDigits</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>          })<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="104" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 103;"><span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>matchDataSixNations <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">"Six Nations"</span>))</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>teamStatsSixNations <span class="op">=</span> {</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> matchDataSixNations) {</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>            <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>edgesSixNations <span class="op">=</span> {</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> matchDataSixNations) {</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key))</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>            edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> {</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>                team1<span class="op">,</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>                team2<span class="op">,</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>                <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>                <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>                <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>            })<span class="op">;</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>        ({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>                <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>                <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>                <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>            }<span class="op">;</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>nodesSixNations <span class="op">=</span> teamStatsSixNations</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>circularNodesSixNations <span class="op">=</span> {</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesSixNations<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesSixNations<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Six Nations Matches">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="194" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 193;"><span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesSixNations<span class="op">,</span> {</span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-six-nations" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-six-nations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1
</figcaption>
<div aria-describedby="tbl-six-nations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="221" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 220;"><span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesSixNations<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesSixNations<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3<span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"link"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>))</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)</span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span>)<span class="op">;</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended))<span class="op">;</span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a>        node</span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>        labels</span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)</span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-six-nations" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-six-nations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-six-nations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Six Nations.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="353" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 352;"><span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>matchDataRugbyChampionship <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> (</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby Championship"</span> <span class="op">||</span></span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"The Rugby Championship"</span></span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> (</span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>                <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>                <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>                <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>                <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>                <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>                <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyChampionship <span class="op">=</span> {</span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()</span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> d <span class="kw">of</span> matchDataRugbyChampionship) {</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++</span></span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)</span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>edgesRugbyChampionship <span class="op">=</span> {</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> d <span class="kw">of</span> matchDataRugbyChampionship) {</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()</span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)</span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++</span></span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++</span></span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++</span></span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>nodesRugbyChampionship <span class="op">=</span> teamStatsRugbyChampionship</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyChampionship <span class="op">=</span> {</span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyChampionship<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyChampionship<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby Championship Matches">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="441" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 440;"><span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyChampionship<span class="op">,</span> {</span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyChampionship<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-championship" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-championship-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2
</figcaption>
<div aria-describedby="tbl-rugby-championship-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-6" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="468" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 467;"><span id="cb7-468"><a href="#cb7-468" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyChampionship<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyChampionship<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-498"><a href="#cb7-498" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb7-499"><a href="#cb7-499" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb7-500"><a href="#cb7-500" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb7-501"><a href="#cb7-501" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb7-502"><a href="#cb7-502" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb7-503"><a href="#cb7-503" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb7-504"><a href="#cb7-504" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb7-505"><a href="#cb7-505" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb7-506"><a href="#cb7-506" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb7-507"><a href="#cb7-507" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb7-508"><a href="#cb7-508" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb7-509"><a href="#cb7-509" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb7-510"><a href="#cb7-510" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb7-511"><a href="#cb7-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-512"><a href="#cb7-512" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb7-513"><a href="#cb7-513" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb7-514"><a href="#cb7-514" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb7-587"><a href="#cb7-587" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb7-588"><a href="#cb7-588" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb7-608"><a href="#cb7-608" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-championship" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-championship-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-championship-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Rugby Championship.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="613" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 612;"><span id="cb8-613"><a href="#cb8-613" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCup <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb8-614"><a href="#cb8-614" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb8-615"><a href="#cb8-615" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb8-616"><a href="#cb8-616" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> (</span>
<span id="cb8-617"><a href="#cb8-617" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb8-618"><a href="#cb8-618" aria-hidden="true" tabindex="-1"></a>                <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb8-619"><a href="#cb8-619" aria-hidden="true" tabindex="-1"></a>                <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb8-620"><a href="#cb8-620" aria-hidden="true" tabindex="-1"></a>                <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a>                <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a>                <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a>                <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCup <span class="op">=</span> {</span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()</span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> d <span class="kw">of</span> matchDataRugbyWorldCup) {</span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })</span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++</span></span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++</span></span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)</span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCup <span class="op">=</span> {</span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()</span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">const</span> d <span class="kw">of</span> matchDataRugbyWorldCup) {</span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()</span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })</span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)</span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++</span></span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++</span></span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++</span></span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2</span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2</span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCup <span class="op">=</span> teamStatsRugbyWorldCup</span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCup <span class="op">=</span> {</span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCup<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCup<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-8-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Matches">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="696" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 695;"><span id="cb9-696"><a href="#cb9-696" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCup<span class="op">,</span> {</span>
<span id="cb9-697"><a href="#cb9-697" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb9-698"><a href="#cb9-698" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb9-699"><a href="#cb9-699" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb9-700"><a href="#cb9-700" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb9-701"><a href="#cb9-701" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb9-702"><a href="#cb9-702" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb9-703"><a href="#cb9-703" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb9-704"><a href="#cb9-704" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb9-705"><a href="#cb9-705" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb9-706"><a href="#cb9-706" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb9-707"><a href="#cb9-707" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb9-708"><a href="#cb9-708" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-709"><a href="#cb9-709" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb9-710"><a href="#cb9-710" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb9-711"><a href="#cb9-711" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb9-712"><a href="#cb9-712" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb9-713"><a href="#cb9-713" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb9-714"><a href="#cb9-714" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb9-715"><a href="#cb9-715" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-716"><a href="#cb9-716" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb9-717"><a href="#cb9-717" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-9" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="723" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 722;"><span id="cb10-723"><a href="#cb10-723" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-724"><a href="#cb10-724" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb10-725"><a href="#cb10-725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb10-726"><a href="#cb10-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-727"><a href="#cb10-727" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb10-728"><a href="#cb10-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-729"><a href="#cb10-729" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCup<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb10-730"><a href="#cb10-730" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCup<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb10-731"><a href="#cb10-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-732"><a href="#cb10-732" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb10-733"><a href="#cb10-733" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb10-734"><a href="#cb10-734" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb10-735"><a href="#cb10-735" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">25</span>])<span class="op">;</span></span>
<span id="cb10-736"><a href="#cb10-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-737"><a href="#cb10-737" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb10-738"><a href="#cb10-738" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb10-739"><a href="#cb10-739" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb10-740"><a href="#cb10-740" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb10-741"><a href="#cb10-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-742"><a href="#cb10-742" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb10-743"><a href="#cb10-743" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb10-744"><a href="#cb10-744" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb10-745"><a href="#cb10-745" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb10-746"><a href="#cb10-746" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb10-747"><a href="#cb10-747" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb10-748"><a href="#cb10-748" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb10-749"><a href="#cb10-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-750"><a href="#cb10-750" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb10-751"><a href="#cb10-751" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb10-752"><a href="#cb10-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-753"><a href="#cb10-753" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb10-754"><a href="#cb10-754" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb10-755"><a href="#cb10-755" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb10-756"><a href="#cb10-756" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb10-757"><a href="#cb10-757" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb10-758"><a href="#cb10-758" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb10-759"><a href="#cb10-759" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb10-760"><a href="#cb10-760" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb10-761"><a href="#cb10-761" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb10-762"><a href="#cb10-762" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb10-763"><a href="#cb10-763" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb10-764"><a href="#cb10-764" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb10-765"><a href="#cb10-765" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb10-766"><a href="#cb10-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-767"><a href="#cb10-767" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb10-768"><a href="#cb10-768" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb10-769"><a href="#cb10-769" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb10-770"><a href="#cb10-770" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb10-771"><a href="#cb10-771" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb10-772"><a href="#cb10-772" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-773"><a href="#cb10-773" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb10-774"><a href="#cb10-774" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb10-775"><a href="#cb10-775" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb10-776"><a href="#cb10-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-777"><a href="#cb10-777" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb10-778"><a href="#cb10-778" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-779"><a href="#cb10-779" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb10-780"><a href="#cb10-780" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb10-781"><a href="#cb10-781" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb10-782"><a href="#cb10-782" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb10-783"><a href="#cb10-783" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb10-784"><a href="#cb10-784" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb10-785"><a href="#cb10-785" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">2</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb10-786"><a href="#cb10-786" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb10-787"><a href="#cb10-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-788"><a href="#cb10-788" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb10-789"><a href="#cb10-789" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-790"><a href="#cb10-790" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb10-791"><a href="#cb10-791" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb10-792"><a href="#cb10-792" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb10-793"><a href="#cb10-793" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb10-794"><a href="#cb10-794" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb10-795"><a href="#cb10-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-796"><a href="#cb10-796" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb10-797"><a href="#cb10-797" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb10-798"><a href="#cb10-798" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb10-799"><a href="#cb10-799" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb10-800"><a href="#cb10-800" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb10-801"><a href="#cb10-801" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb10-802"><a href="#cb10-802" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb10-803"><a href="#cb10-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-804"><a href="#cb10-804" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb10-805"><a href="#cb10-805" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb10-806"><a href="#cb10-806" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb10-807"><a href="#cb10-807" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb10-808"><a href="#cb10-808" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb10-809"><a href="#cb10-809" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb10-810"><a href="#cb10-810" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb10-811"><a href="#cb10-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-812"><a href="#cb10-812" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb10-813"><a href="#cb10-813" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-814"><a href="#cb10-814" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb10-815"><a href="#cb10-815" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb10-816"><a href="#cb10-816" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb10-817"><a href="#cb10-817" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb10-818"><a href="#cb10-818" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb10-819"><a href="#cb10-819" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb10-820"><a href="#cb10-820" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb10-821"><a href="#cb10-821" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb10-822"><a href="#cb10-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-823"><a href="#cb10-823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb10-824"><a href="#cb10-824" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb10-825"><a href="#cb10-825" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-826"><a href="#cb10-826" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-827"><a href="#cb10-827" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb10-828"><a href="#cb10-828" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb10-829"><a href="#cb10-829" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb10-830"><a href="#cb10-830" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb10-831"><a href="#cb10-831" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb10-832"><a href="#cb10-832" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb10-833"><a href="#cb10-833" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb10-834"><a href="#cb10-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-835"><a href="#cb10-835" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb10-836"><a href="#cb10-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-837"><a href="#cb10-837" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb10-838"><a href="#cb10-838" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-839"><a href="#cb10-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-840"><a href="#cb10-840" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb10-841"><a href="#cb10-841" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb10-842"><a href="#cb10-842" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-843"><a href="#cb10-843" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-844"><a href="#cb10-844" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-845"><a href="#cb10-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-846"><a href="#cb10-846" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb10-847"><a href="#cb10-847" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb10-848"><a href="#cb10-848" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb10-849"><a href="#cb10-849" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-850"><a href="#cb10-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-851"><a href="#cb10-851" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb10-852"><a href="#cb10-852" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb10-853"><a href="#cb10-853" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-854"><a href="#cb10-854" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-855"><a href="#cb10-855" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-856"><a href="#cb10-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-857"><a href="#cb10-857" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb10-858"><a href="#cb10-858" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb10-859"><a href="#cb10-859" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb10-860"><a href="#cb10-860" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb10-861"><a href="#cb10-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-862"><a href="#cb10-862" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb10-863"><a href="#cb10-863" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Rugby World Cup Matches.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="868" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 867;"><span id="cb11-868"><a href="#cb11-868" aria-hidden="true" tabindex="-1"></a>matchesByYearGroup <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb11-869"><a href="#cb11-869" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb11-870"><a href="#cb11-870" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb11-871"><a href="#cb11-871" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb11-872"><a href="#cb11-872" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb11-873"><a href="#cb11-873" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb11-874"><a href="#cb11-874" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb11-875"><a href="#cb11-875" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">.</span><span class="fu">getFullYear</span>()</span>
<span id="cb11-876"><a href="#cb11-876" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb11-877"><a href="#cb11-877" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb11-878"><a href="#cb11-878" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a<span class="op">.</span><span class="at">year</span> <span class="op">!==</span> b<span class="op">.</span><span class="at">year</span>) <span class="cf">return</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb11-879"><a href="#cb11-879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>)<span class="op">;</span></span>
<span id="cb11-880"><a href="#cb11-880" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-881"><a href="#cb11-881" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> match) <span class="kw">=&gt;</span> {</span>
<span id="cb11-882"><a href="#cb11-882" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> year <span class="op">=</span> match<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb11-883"><a href="#cb11-883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>acc[year]) acc[year] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb11-884"><a href="#cb11-884" aria-hidden="true" tabindex="-1"></a>        acc[year]<span class="op">.</span><span class="fu">push</span>(match)<span class="op">;</span></span>
<span id="cb11-885"><a href="#cb11-885" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb11-886"><a href="#cb11-886" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb11-887"><a href="#cb11-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-888"><a href="#cb11-888" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCupGroup <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(</span>
<span id="cb11-889"><a href="#cb11-889" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(matchesByYearGroup)<span class="op">.</span><span class="fu">map</span>(([year<span class="op">,</span> matches]) <span class="kw">=&gt;</span> [</span>
<span id="cb11-890"><a href="#cb11-890" aria-hidden="true" tabindex="-1"></a>        year<span class="op">,</span></span>
<span id="cb11-891"><a href="#cb11-891" aria-hidden="true" tabindex="-1"></a>        matches<span class="op">.</span><span class="fu">slice</span>(<span class="dv">8</span><span class="op">,</span> <span class="dv">200</span>)</span>
<span id="cb11-892"><a href="#cb11-892" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb11-893"><a href="#cb11-893" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb11-894"><a href="#cb11-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-895"><a href="#cb11-895" aria-hidden="true" tabindex="-1"></a>groupMatches <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(matchDataRugbyWorldCupGroup)</span>
<span id="cb11-896"><a href="#cb11-896" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb11-897"><a href="#cb11-897" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>))</span>
<span id="cb11-898"><a href="#cb11-898" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb11-899"><a href="#cb11-899" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb11-900"><a href="#cb11-900" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb11-901"><a href="#cb11-901" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb11-902"><a href="#cb11-902" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb11-903"><a href="#cb11-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-904"><a href="#cb11-904" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCupGroup <span class="op">=</span> {</span>
<span id="cb11-905"><a href="#cb11-905" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb11-906"><a href="#cb11-906" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> groupMatches) {</span>
<span id="cb11-907"><a href="#cb11-907" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb11-908"><a href="#cb11-908" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb11-909"><a href="#cb11-909" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb11-910"><a href="#cb11-910" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-911"><a href="#cb11-911" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb11-912"><a href="#cb11-912" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-913"><a href="#cb11-913" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb11-914"><a href="#cb11-914" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb11-915"><a href="#cb11-915" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb11-916"><a href="#cb11-916" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb11-917"><a href="#cb11-917" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb11-918"><a href="#cb11-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-919"><a href="#cb11-919" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCupGroup <span class="op">=</span> {</span>
<span id="cb11-920"><a href="#cb11-920" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb11-921"><a href="#cb11-921" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> groupMatches) {</span>
<span id="cb11-922"><a href="#cb11-922" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb11-923"><a href="#cb11-923" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb11-924"><a href="#cb11-924" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb11-925"><a href="#cb11-925" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb11-926"><a href="#cb11-926" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb11-927"><a href="#cb11-927" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb11-928"><a href="#cb11-928" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb11-929"><a href="#cb11-929" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-930"><a href="#cb11-930" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb11-931"><a href="#cb11-931" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb11-932"><a href="#cb11-932" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb11-933"><a href="#cb11-933" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb11-934"><a href="#cb11-934" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb11-935"><a href="#cb11-935" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb11-936"><a href="#cb11-936" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb11-937"><a href="#cb11-937" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb11-938"><a href="#cb11-938" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-939"><a href="#cb11-939" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb11-940"><a href="#cb11-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-941"><a href="#cb11-941" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCupGroup <span class="op">=</span> teamStatsRugbyWorldCupGroup</span>
<span id="cb11-942"><a href="#cb11-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb11-943"><a href="#cb11-943" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb11-944"><a href="#cb11-944" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb11-945"><a href="#cb11-945" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb11-946"><a href="#cb11-946" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb11-947"><a href="#cb11-947" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb11-948"><a href="#cb11-948" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb11-949"><a href="#cb11-949" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb11-950"><a href="#cb11-950" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb11-951"><a href="#cb11-951" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb11-952"><a href="#cb11-952" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb11-953"><a href="#cb11-953" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb11-954"><a href="#cb11-954" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb11-955"><a href="#cb11-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-956"><a href="#cb11-956" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCupGroup <span class="op">=</span> {</span>
<span id="cb11-957"><a href="#cb11-957" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb11-958"><a href="#cb11-958" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb11-959"><a href="#cb11-959" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb11-960"><a href="#cb11-960" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCupGroup<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb11-961"><a href="#cb11-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-962"><a href="#cb11-962" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCupGroup<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb11-963"><a href="#cb11-963" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb11-964"><a href="#cb11-964" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb11-965"><a href="#cb11-965" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb11-966"><a href="#cb11-966" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb11-967"><a href="#cb11-967" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-7" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Group Matches">
<div class="sourceCode cell-code hidden" id="cb12" data-startfrom="972" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 971;"><span id="cb12-972"><a href="#cb12-972" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCupGroup<span class="op">,</span> {</span>
<span id="cb12-973"><a href="#cb12-973" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb12-974"><a href="#cb12-974" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb12-975"><a href="#cb12-975" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb12-976"><a href="#cb12-976" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb12-977"><a href="#cb12-977" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb12-978"><a href="#cb12-978" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb12-979"><a href="#cb12-979" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb12-980"><a href="#cb12-980" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb12-981"><a href="#cb12-981" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb12-982"><a href="#cb12-982" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb12-983"><a href="#cb12-983" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb12-984"><a href="#cb12-984" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-985"><a href="#cb12-985" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb12-986"><a href="#cb12-986" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupGroup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb12-987"><a href="#cb12-987" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupGroup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb12-988"><a href="#cb12-988" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb12-989"><a href="#cb12-989" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupGroup<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb12-990"><a href="#cb12-990" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb12-991"><a href="#cb12-991" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb12-992"><a href="#cb12-992" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb12-993"><a href="#cb12-993" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup-group" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-group-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-group-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-12" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb13" data-startfrom="999" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 998;"><span id="cb13-999"><a href="#cb13-999" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-1000"><a href="#cb13-1000" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb13-1001"><a href="#cb13-1001" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb13-1002"><a href="#cb13-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1003"><a href="#cb13-1003" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb13-1004"><a href="#cb13-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1005"><a href="#cb13-1005" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCupGroup<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb13-1006"><a href="#cb13-1006" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCupGroup<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb13-1007"><a href="#cb13-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1008"><a href="#cb13-1008" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb13-1009"><a href="#cb13-1009" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb13-1010"><a href="#cb13-1010" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb13-1011"><a href="#cb13-1011" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">25</span>])<span class="op">;</span></span>
<span id="cb13-1012"><a href="#cb13-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1013"><a href="#cb13-1013" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb13-1014"><a href="#cb13-1014" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb13-1015"><a href="#cb13-1015" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb13-1016"><a href="#cb13-1016" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb13-1017"><a href="#cb13-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1018"><a href="#cb13-1018" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb13-1019"><a href="#cb13-1019" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb13-1020"><a href="#cb13-1020" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb13-1021"><a href="#cb13-1021" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb13-1022"><a href="#cb13-1022" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb13-1023"><a href="#cb13-1023" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb13-1024"><a href="#cb13-1024" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb13-1025"><a href="#cb13-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1026"><a href="#cb13-1026" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb13-1027"><a href="#cb13-1027" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb13-1028"><a href="#cb13-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1029"><a href="#cb13-1029" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb13-1030"><a href="#cb13-1030" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb13-1031"><a href="#cb13-1031" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb13-1032"><a href="#cb13-1032" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb13-1033"><a href="#cb13-1033" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb13-1034"><a href="#cb13-1034" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb13-1035"><a href="#cb13-1035" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb13-1036"><a href="#cb13-1036" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb13-1037"><a href="#cb13-1037" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb13-1038"><a href="#cb13-1038" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb13-1039"><a href="#cb13-1039" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb13-1040"><a href="#cb13-1040" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb13-1041"><a href="#cb13-1041" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-1042"><a href="#cb13-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1043"><a href="#cb13-1043" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb13-1044"><a href="#cb13-1044" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb13-1045"><a href="#cb13-1045" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb13-1046"><a href="#cb13-1046" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb13-1047"><a href="#cb13-1047" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb13-1048"><a href="#cb13-1048" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-1049"><a href="#cb13-1049" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb13-1050"><a href="#cb13-1050" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb13-1051"><a href="#cb13-1051" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb13-1052"><a href="#cb13-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1053"><a href="#cb13-1053" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb13-1054"><a href="#cb13-1054" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1055"><a href="#cb13-1055" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb13-1056"><a href="#cb13-1056" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb13-1057"><a href="#cb13-1057" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb13-1058"><a href="#cb13-1058" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb13-1059"><a href="#cb13-1059" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb13-1060"><a href="#cb13-1060" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb13-1061"><a href="#cb13-1061" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">2</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb13-1062"><a href="#cb13-1062" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb13-1063"><a href="#cb13-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1064"><a href="#cb13-1064" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb13-1065"><a href="#cb13-1065" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1066"><a href="#cb13-1066" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb13-1067"><a href="#cb13-1067" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb13-1068"><a href="#cb13-1068" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb13-1069"><a href="#cb13-1069" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb13-1070"><a href="#cb13-1070" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb13-1071"><a href="#cb13-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1072"><a href="#cb13-1072" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb13-1073"><a href="#cb13-1073" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb13-1074"><a href="#cb13-1074" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb13-1075"><a href="#cb13-1075" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb13-1076"><a href="#cb13-1076" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-1077"><a href="#cb13-1077" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb13-1078"><a href="#cb13-1078" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb13-1079"><a href="#cb13-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1080"><a href="#cb13-1080" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb13-1081"><a href="#cb13-1081" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb13-1082"><a href="#cb13-1082" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb13-1083"><a href="#cb13-1083" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb13-1084"><a href="#cb13-1084" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb13-1085"><a href="#cb13-1085" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb13-1086"><a href="#cb13-1086" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb13-1087"><a href="#cb13-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1088"><a href="#cb13-1088" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb13-1089"><a href="#cb13-1089" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb13-1090"><a href="#cb13-1090" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb13-1091"><a href="#cb13-1091" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb13-1092"><a href="#cb13-1092" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb13-1093"><a href="#cb13-1093" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb13-1094"><a href="#cb13-1094" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb13-1095"><a href="#cb13-1095" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb13-1096"><a href="#cb13-1096" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb13-1097"><a href="#cb13-1097" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb13-1098"><a href="#cb13-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1099"><a href="#cb13-1099" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb13-1100"><a href="#cb13-1100" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb13-1101"><a href="#cb13-1101" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb13-1102"><a href="#cb13-1102" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb13-1103"><a href="#cb13-1103" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb13-1104"><a href="#cb13-1104" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb13-1105"><a href="#cb13-1105" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb13-1106"><a href="#cb13-1106" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb13-1107"><a href="#cb13-1107" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb13-1108"><a href="#cb13-1108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb13-1109"><a href="#cb13-1109" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb13-1110"><a href="#cb13-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1111"><a href="#cb13-1111" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb13-1112"><a href="#cb13-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1113"><a href="#cb13-1113" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb13-1114"><a href="#cb13-1114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-1115"><a href="#cb13-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1116"><a href="#cb13-1116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb13-1117"><a href="#cb13-1117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb13-1118"><a href="#cb13-1118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb13-1119"><a href="#cb13-1119" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb13-1120"><a href="#cb13-1120" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-1121"><a href="#cb13-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1122"><a href="#cb13-1122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb13-1123"><a href="#cb13-1123" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb13-1124"><a href="#cb13-1124" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb13-1125"><a href="#cb13-1125" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-1126"><a href="#cb13-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1127"><a href="#cb13-1127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb13-1128"><a href="#cb13-1128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-1129"><a href="#cb13-1129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb13-1130"><a href="#cb13-1130" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb13-1131"><a href="#cb13-1131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-1132"><a href="#cb13-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1133"><a href="#cb13-1133" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb13-1134"><a href="#cb13-1134" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb13-1135"><a href="#cb13-1135" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb13-1136"><a href="#cb13-1136" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb13-1137"><a href="#cb13-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-1138"><a href="#cb13-1138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb13-1139"><a href="#cb13-1139" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup-group" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-group-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-13" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-group-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Rugby World Cup Group Matches.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="1144" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1143;"><span id="cb14-1144"><a href="#cb14-1144" aria-hidden="true" tabindex="-1"></a>matchesByYearQuarters <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb14-1145"><a href="#cb14-1145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb14-1146"><a href="#cb14-1146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb14-1147"><a href="#cb14-1147" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb14-1148"><a href="#cb14-1148" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb14-1149"><a href="#cb14-1149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb14-1150"><a href="#cb14-1150" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb14-1151"><a href="#cb14-1151" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">.</span><span class="fu">getFullYear</span>()</span>
<span id="cb14-1152"><a href="#cb14-1152" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb14-1153"><a href="#cb14-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb14-1154"><a href="#cb14-1154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a<span class="op">.</span><span class="at">year</span> <span class="op">!==</span> b<span class="op">.</span><span class="at">year</span>) <span class="cf">return</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb14-1155"><a href="#cb14-1155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>)<span class="op">;</span></span>
<span id="cb14-1156"><a href="#cb14-1156" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-1157"><a href="#cb14-1157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> match) <span class="kw">=&gt;</span> {</span>
<span id="cb14-1158"><a href="#cb14-1158" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> year <span class="op">=</span> match<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb14-1159"><a href="#cb14-1159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>acc[year]) acc[year] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb14-1160"><a href="#cb14-1160" aria-hidden="true" tabindex="-1"></a>        acc[year]<span class="op">.</span><span class="fu">push</span>(match)<span class="op">;</span></span>
<span id="cb14-1161"><a href="#cb14-1161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb14-1162"><a href="#cb14-1162" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb14-1163"><a href="#cb14-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1164"><a href="#cb14-1164" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCupQuarters <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(</span>
<span id="cb14-1165"><a href="#cb14-1165" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(matchesByYearQuarters)<span class="op">.</span><span class="fu">map</span>(([year<span class="op">,</span> matches]) <span class="kw">=&gt;</span> [</span>
<span id="cb14-1166"><a href="#cb14-1166" aria-hidden="true" tabindex="-1"></a>        year<span class="op">,</span></span>
<span id="cb14-1167"><a href="#cb14-1167" aria-hidden="true" tabindex="-1"></a>        matches<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb14-1168"><a href="#cb14-1168" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb14-1169"><a href="#cb14-1169" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb14-1170"><a href="#cb14-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1171"><a href="#cb14-1171" aria-hidden="true" tabindex="-1"></a>top8Matches <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(matchDataRugbyWorldCupQuarters)</span>
<span id="cb14-1172"><a href="#cb14-1172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb14-1173"><a href="#cb14-1173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>))</span>
<span id="cb14-1174"><a href="#cb14-1174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb14-1175"><a href="#cb14-1175" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb14-1176"><a href="#cb14-1176" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb14-1177"><a href="#cb14-1177" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb14-1178"><a href="#cb14-1178" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb14-1179"><a href="#cb14-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1180"><a href="#cb14-1180" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCupQuarters <span class="op">=</span> {</span>
<span id="cb14-1181"><a href="#cb14-1181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb14-1182"><a href="#cb14-1182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top8Matches) {</span>
<span id="cb14-1183"><a href="#cb14-1183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb14-1184"><a href="#cb14-1184" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb14-1185"><a href="#cb14-1185" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb14-1186"><a href="#cb14-1186" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-1187"><a href="#cb14-1187" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb14-1188"><a href="#cb14-1188" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-1189"><a href="#cb14-1189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb14-1190"><a href="#cb14-1190" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb14-1191"><a href="#cb14-1191" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb14-1192"><a href="#cb14-1192" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb14-1193"><a href="#cb14-1193" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-1194"><a href="#cb14-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1195"><a href="#cb14-1195" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCupQuarters <span class="op">=</span> {</span>
<span id="cb14-1196"><a href="#cb14-1196" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb14-1197"><a href="#cb14-1197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top8Matches) {</span>
<span id="cb14-1198"><a href="#cb14-1198" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb14-1199"><a href="#cb14-1199" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb14-1200"><a href="#cb14-1200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb14-1201"><a href="#cb14-1201" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb14-1202"><a href="#cb14-1202" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb14-1203"><a href="#cb14-1203" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb14-1204"><a href="#cb14-1204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb14-1205"><a href="#cb14-1205" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-1206"><a href="#cb14-1206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb14-1207"><a href="#cb14-1207" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb14-1208"><a href="#cb14-1208" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb14-1209"><a href="#cb14-1209" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb14-1210"><a href="#cb14-1210" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb14-1211"><a href="#cb14-1211" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb14-1212"><a href="#cb14-1212" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb14-1213"><a href="#cb14-1213" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb14-1214"><a href="#cb14-1214" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb14-1215"><a href="#cb14-1215" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-1216"><a href="#cb14-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1217"><a href="#cb14-1217" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCupQuarters <span class="op">=</span> teamStatsRugbyWorldCupQuarters</span>
<span id="cb14-1218"><a href="#cb14-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb14-1219"><a href="#cb14-1219" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb14-1220"><a href="#cb14-1220" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb14-1221"><a href="#cb14-1221" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb14-1222"><a href="#cb14-1222" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb14-1223"><a href="#cb14-1223" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb14-1224"><a href="#cb14-1224" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb14-1225"><a href="#cb14-1225" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb14-1226"><a href="#cb14-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb14-1227"><a href="#cb14-1227" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb14-1228"><a href="#cb14-1228" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb14-1229"><a href="#cb14-1229" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb14-1230"><a href="#cb14-1230" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb14-1231"><a href="#cb14-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1232"><a href="#cb14-1232" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCupQuarters <span class="op">=</span> {</span>
<span id="cb14-1233"><a href="#cb14-1233" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb14-1234"><a href="#cb14-1234" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb14-1235"><a href="#cb14-1235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb14-1236"><a href="#cb14-1236" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCupQuarters<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb14-1237"><a href="#cb14-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1238"><a href="#cb14-1238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCupQuarters<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb14-1239"><a href="#cb14-1239" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb14-1240"><a href="#cb14-1240" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb14-1241"><a href="#cb14-1241" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb14-1242"><a href="#cb14-1242" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb14-1243"><a href="#cb14-1243" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-14-7" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Quarter Final, Semi Final, and Final Matches">
<div class="sourceCode cell-code hidden" id="cb15" data-startfrom="1248" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1247;"><span id="cb15-1248"><a href="#cb15-1248" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCupQuarters<span class="op">,</span> {</span>
<span id="cb15-1249"><a href="#cb15-1249" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb15-1250"><a href="#cb15-1250" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb15-1251"><a href="#cb15-1251" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb15-1252"><a href="#cb15-1252" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb15-1253"><a href="#cb15-1253" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb15-1254"><a href="#cb15-1254" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb15-1255"><a href="#cb15-1255" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb15-1256"><a href="#cb15-1256" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb15-1257"><a href="#cb15-1257" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb15-1258"><a href="#cb15-1258" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb15-1259"><a href="#cb15-1259" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb15-1260"><a href="#cb15-1260" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-1261"><a href="#cb15-1261" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb15-1262"><a href="#cb15-1262" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupQuarters<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb15-1263"><a href="#cb15-1263" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupQuarters<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb15-1264"><a href="#cb15-1264" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb15-1265"><a href="#cb15-1265" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupQuarters<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb15-1266"><a href="#cb15-1266" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb15-1267"><a href="#cb15-1267" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb15-1268"><a href="#cb15-1268" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb15-1269"><a href="#cb15-1269" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup-quarter-finals" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-quarter-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-quarter-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-15" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb16" data-startfrom="1275" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1274;"><span id="cb16-1275"><a href="#cb16-1275" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-1276"><a href="#cb16-1276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb16-1277"><a href="#cb16-1277" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb16-1278"><a href="#cb16-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1279"><a href="#cb16-1279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb16-1280"><a href="#cb16-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1281"><a href="#cb16-1281" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCupQuarters<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb16-1282"><a href="#cb16-1282" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCupQuarters<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb16-1283"><a href="#cb16-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1284"><a href="#cb16-1284" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb16-1285"><a href="#cb16-1285" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb16-1286"><a href="#cb16-1286" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb16-1287"><a href="#cb16-1287" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">50</span>])<span class="op">;</span></span>
<span id="cb16-1288"><a href="#cb16-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1289"><a href="#cb16-1289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb16-1290"><a href="#cb16-1290" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb16-1291"><a href="#cb16-1291" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb16-1292"><a href="#cb16-1292" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb16-1293"><a href="#cb16-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1294"><a href="#cb16-1294" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb16-1295"><a href="#cb16-1295" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb16-1296"><a href="#cb16-1296" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb16-1297"><a href="#cb16-1297" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb16-1298"><a href="#cb16-1298" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb16-1299"><a href="#cb16-1299" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb16-1300"><a href="#cb16-1300" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb16-1301"><a href="#cb16-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1302"><a href="#cb16-1302" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb16-1303"><a href="#cb16-1303" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb16-1304"><a href="#cb16-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1305"><a href="#cb16-1305" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb16-1306"><a href="#cb16-1306" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb16-1307"><a href="#cb16-1307" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb16-1308"><a href="#cb16-1308" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb16-1309"><a href="#cb16-1309" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb16-1310"><a href="#cb16-1310" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb16-1311"><a href="#cb16-1311" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb16-1312"><a href="#cb16-1312" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb16-1313"><a href="#cb16-1313" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb16-1314"><a href="#cb16-1314" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb16-1315"><a href="#cb16-1315" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb16-1316"><a href="#cb16-1316" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb16-1317"><a href="#cb16-1317" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-1318"><a href="#cb16-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1319"><a href="#cb16-1319" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb16-1320"><a href="#cb16-1320" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb16-1321"><a href="#cb16-1321" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb16-1322"><a href="#cb16-1322" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb16-1323"><a href="#cb16-1323" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb16-1324"><a href="#cb16-1324" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-1325"><a href="#cb16-1325" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb16-1326"><a href="#cb16-1326" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb16-1327"><a href="#cb16-1327" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb16-1328"><a href="#cb16-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1329"><a href="#cb16-1329" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb16-1330"><a href="#cb16-1330" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1331"><a href="#cb16-1331" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb16-1332"><a href="#cb16-1332" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb16-1333"><a href="#cb16-1333" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb16-1334"><a href="#cb16-1334" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb16-1335"><a href="#cb16-1335" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb16-1336"><a href="#cb16-1336" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb16-1337"><a href="#cb16-1337" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb16-1338"><a href="#cb16-1338" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb16-1339"><a href="#cb16-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1340"><a href="#cb16-1340" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb16-1341"><a href="#cb16-1341" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1342"><a href="#cb16-1342" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb16-1343"><a href="#cb16-1343" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb16-1344"><a href="#cb16-1344" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb16-1345"><a href="#cb16-1345" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb16-1346"><a href="#cb16-1346" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb16-1347"><a href="#cb16-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1348"><a href="#cb16-1348" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb16-1349"><a href="#cb16-1349" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb16-1350"><a href="#cb16-1350" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb16-1351"><a href="#cb16-1351" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb16-1352"><a href="#cb16-1352" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb16-1353"><a href="#cb16-1353" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb16-1354"><a href="#cb16-1354" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb16-1355"><a href="#cb16-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1356"><a href="#cb16-1356" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb16-1357"><a href="#cb16-1357" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb16-1358"><a href="#cb16-1358" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb16-1359"><a href="#cb16-1359" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb16-1360"><a href="#cb16-1360" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb16-1361"><a href="#cb16-1361" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb16-1362"><a href="#cb16-1362" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb16-1363"><a href="#cb16-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1364"><a href="#cb16-1364" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb16-1365"><a href="#cb16-1365" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb16-1366"><a href="#cb16-1366" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb16-1367"><a href="#cb16-1367" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb16-1368"><a href="#cb16-1368" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb16-1369"><a href="#cb16-1369" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb16-1370"><a href="#cb16-1370" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb16-1371"><a href="#cb16-1371" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb16-1372"><a href="#cb16-1372" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb16-1373"><a href="#cb16-1373" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb16-1374"><a href="#cb16-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1375"><a href="#cb16-1375" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb16-1376"><a href="#cb16-1376" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb16-1377"><a href="#cb16-1377" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb16-1378"><a href="#cb16-1378" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb16-1379"><a href="#cb16-1379" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb16-1380"><a href="#cb16-1380" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb16-1381"><a href="#cb16-1381" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb16-1382"><a href="#cb16-1382" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb16-1383"><a href="#cb16-1383" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb16-1384"><a href="#cb16-1384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb16-1385"><a href="#cb16-1385" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb16-1386"><a href="#cb16-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1387"><a href="#cb16-1387" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb16-1388"><a href="#cb16-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1389"><a href="#cb16-1389" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb16-1390"><a href="#cb16-1390" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1391"><a href="#cb16-1391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1392"><a href="#cb16-1392" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb16-1393"><a href="#cb16-1393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb16-1394"><a href="#cb16-1394" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb16-1395"><a href="#cb16-1395" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb16-1396"><a href="#cb16-1396" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1397"><a href="#cb16-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1398"><a href="#cb16-1398" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb16-1399"><a href="#cb16-1399" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb16-1400"><a href="#cb16-1400" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb16-1401"><a href="#cb16-1401" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1402"><a href="#cb16-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1403"><a href="#cb16-1403" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb16-1404"><a href="#cb16-1404" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb16-1405"><a href="#cb16-1405" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb16-1406"><a href="#cb16-1406" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb16-1407"><a href="#cb16-1407" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1408"><a href="#cb16-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1409"><a href="#cb16-1409" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb16-1410"><a href="#cb16-1410" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb16-1411"><a href="#cb16-1411" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb16-1412"><a href="#cb16-1412" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb16-1413"><a href="#cb16-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1414"><a href="#cb16-1414" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb16-1415"><a href="#cb16-1415" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup-quarter-finals" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-quarter-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-16" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-quarter-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Rugby World Cup Quarter Final, Semi Final, and Final Matches.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb17" data-startfrom="1420" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1419;"><span id="cb17-1420"><a href="#cb17-1420" aria-hidden="true" tabindex="-1"></a>matchesByYearSemis <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb17-1421"><a href="#cb17-1421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb17-1422"><a href="#cb17-1422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb17-1423"><a href="#cb17-1423" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb17-1424"><a href="#cb17-1424" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb17-1425"><a href="#cb17-1425" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb17-1426"><a href="#cb17-1426" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb17-1427"><a href="#cb17-1427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">.</span><span class="fu">getFullYear</span>()</span>
<span id="cb17-1428"><a href="#cb17-1428" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb17-1429"><a href="#cb17-1429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1430"><a href="#cb17-1430" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a<span class="op">.</span><span class="at">year</span> <span class="op">!==</span> b<span class="op">.</span><span class="at">year</span>) <span class="cf">return</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb17-1431"><a href="#cb17-1431" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>)<span class="op">;</span></span>
<span id="cb17-1432"><a href="#cb17-1432" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb17-1433"><a href="#cb17-1433" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> match) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1434"><a href="#cb17-1434" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> year <span class="op">=</span> match<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb17-1435"><a href="#cb17-1435" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>acc[year]) acc[year] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb17-1436"><a href="#cb17-1436" aria-hidden="true" tabindex="-1"></a>        acc[year]<span class="op">.</span><span class="fu">push</span>(match)<span class="op">;</span></span>
<span id="cb17-1437"><a href="#cb17-1437" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb17-1438"><a href="#cb17-1438" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb17-1439"><a href="#cb17-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1440"><a href="#cb17-1440" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCupSemis <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(</span>
<span id="cb17-1441"><a href="#cb17-1441" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(matchesByYearSemis)<span class="op">.</span><span class="fu">map</span>(([year<span class="op">,</span> matches]) <span class="kw">=&gt;</span> [</span>
<span id="cb17-1442"><a href="#cb17-1442" aria-hidden="true" tabindex="-1"></a>        year<span class="op">,</span></span>
<span id="cb17-1443"><a href="#cb17-1443" aria-hidden="true" tabindex="-1"></a>        matches<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>) <span class="co">// assuming sorted from latest to earliest</span></span>
<span id="cb17-1444"><a href="#cb17-1444" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb17-1445"><a href="#cb17-1445" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb17-1446"><a href="#cb17-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1447"><a href="#cb17-1447" aria-hidden="true" tabindex="-1"></a>top4Matches <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(matchDataRugbyWorldCupSemis)</span>
<span id="cb17-1448"><a href="#cb17-1448" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb17-1449"><a href="#cb17-1449" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>))</span>
<span id="cb17-1450"><a href="#cb17-1450" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb17-1451"><a href="#cb17-1451" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb17-1452"><a href="#cb17-1452" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb17-1453"><a href="#cb17-1453" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb17-1454"><a href="#cb17-1454" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb17-1455"><a href="#cb17-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1456"><a href="#cb17-1456" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCupSemis <span class="op">=</span> {</span>
<span id="cb17-1457"><a href="#cb17-1457" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb17-1458"><a href="#cb17-1458" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top4Matches) {</span>
<span id="cb17-1459"><a href="#cb17-1459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb17-1460"><a href="#cb17-1460" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb17-1461"><a href="#cb17-1461" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb17-1462"><a href="#cb17-1462" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-1463"><a href="#cb17-1463" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb17-1464"><a href="#cb17-1464" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-1465"><a href="#cb17-1465" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb17-1466"><a href="#cb17-1466" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb17-1467"><a href="#cb17-1467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb17-1468"><a href="#cb17-1468" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb17-1469"><a href="#cb17-1469" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1470"><a href="#cb17-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1471"><a href="#cb17-1471" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCupSemis <span class="op">=</span> {</span>
<span id="cb17-1472"><a href="#cb17-1472" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb17-1473"><a href="#cb17-1473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top4Matches) {</span>
<span id="cb17-1474"><a href="#cb17-1474" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb17-1475"><a href="#cb17-1475" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb17-1476"><a href="#cb17-1476" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb17-1477"><a href="#cb17-1477" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb17-1478"><a href="#cb17-1478" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb17-1479"><a href="#cb17-1479" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb17-1480"><a href="#cb17-1480" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb17-1481"><a href="#cb17-1481" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-1482"><a href="#cb17-1482" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb17-1483"><a href="#cb17-1483" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb17-1484"><a href="#cb17-1484" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb17-1485"><a href="#cb17-1485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb17-1486"><a href="#cb17-1486" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb17-1487"><a href="#cb17-1487" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb17-1488"><a href="#cb17-1488" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb17-1489"><a href="#cb17-1489" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb17-1490"><a href="#cb17-1490" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb17-1491"><a href="#cb17-1491" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-1492"><a href="#cb17-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1493"><a href="#cb17-1493" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCupSemis <span class="op">=</span> teamStatsRugbyWorldCupSemis</span>
<span id="cb17-1494"><a href="#cb17-1494" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb17-1495"><a href="#cb17-1495" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb17-1496"><a href="#cb17-1496" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb17-1497"><a href="#cb17-1497" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb17-1498"><a href="#cb17-1498" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb17-1499"><a href="#cb17-1499" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb17-1500"><a href="#cb17-1500" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb17-1501"><a href="#cb17-1501" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb17-1502"><a href="#cb17-1502" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb17-1503"><a href="#cb17-1503" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb17-1504"><a href="#cb17-1504" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb17-1505"><a href="#cb17-1505" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb17-1506"><a href="#cb17-1506" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb17-1507"><a href="#cb17-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1508"><a href="#cb17-1508" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCupSemis <span class="op">=</span> {</span>
<span id="cb17-1509"><a href="#cb17-1509" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb17-1510"><a href="#cb17-1510" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb17-1511"><a href="#cb17-1511" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb17-1512"><a href="#cb17-1512" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCupSemis<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb17-1513"><a href="#cb17-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-1514"><a href="#cb17-1514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCupSemis<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb17-1515"><a href="#cb17-1515" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb17-1516"><a href="#cb17-1516" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb17-1517"><a href="#cb17-1517" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb17-1518"><a href="#cb17-1518" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb17-1519"><a href="#cb17-1519" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-7" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Semi Final and Final Matches">
<div class="sourceCode cell-code hidden" id="cb18" data-startfrom="1524" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1523;"><span id="cb18-1524"><a href="#cb18-1524" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCupSemis<span class="op">,</span> {</span>
<span id="cb18-1525"><a href="#cb18-1525" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb18-1526"><a href="#cb18-1526" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb18-1527"><a href="#cb18-1527" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb18-1528"><a href="#cb18-1528" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb18-1529"><a href="#cb18-1529" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb18-1530"><a href="#cb18-1530" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb18-1531"><a href="#cb18-1531" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb18-1532"><a href="#cb18-1532" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb18-1533"><a href="#cb18-1533" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb18-1534"><a href="#cb18-1534" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb18-1535"><a href="#cb18-1535" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb18-1536"><a href="#cb18-1536" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-1537"><a href="#cb18-1537" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb18-1538"><a href="#cb18-1538" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupSemis<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb18-1539"><a href="#cb18-1539" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupSemis<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb18-1540"><a href="#cb18-1540" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb18-1541"><a href="#cb18-1541" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupSemis<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb18-1542"><a href="#cb18-1542" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb18-1543"><a href="#cb18-1543" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb18-1544"><a href="#cb18-1544" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb18-1545"><a href="#cb18-1545" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup-semis" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-semis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-semis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-18" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb19" data-startfrom="1551" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1550;"><span id="cb19-1551"><a href="#cb19-1551" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb19-1552"><a href="#cb19-1552" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb19-1553"><a href="#cb19-1553" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb19-1554"><a href="#cb19-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1555"><a href="#cb19-1555" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb19-1556"><a href="#cb19-1556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1557"><a href="#cb19-1557" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCupSemis<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb19-1558"><a href="#cb19-1558" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCupSemis<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb19-1559"><a href="#cb19-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1560"><a href="#cb19-1560" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb19-1561"><a href="#cb19-1561" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb19-1562"><a href="#cb19-1562" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb19-1563"><a href="#cb19-1563" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">50</span>])<span class="op">;</span></span>
<span id="cb19-1564"><a href="#cb19-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1565"><a href="#cb19-1565" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb19-1566"><a href="#cb19-1566" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb19-1567"><a href="#cb19-1567" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb19-1568"><a href="#cb19-1568" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb19-1569"><a href="#cb19-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1570"><a href="#cb19-1570" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb19-1571"><a href="#cb19-1571" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb19-1572"><a href="#cb19-1572" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb19-1573"><a href="#cb19-1573" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb19-1574"><a href="#cb19-1574" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb19-1575"><a href="#cb19-1575" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb19-1576"><a href="#cb19-1576" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb19-1577"><a href="#cb19-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1578"><a href="#cb19-1578" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb19-1579"><a href="#cb19-1579" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb19-1580"><a href="#cb19-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1581"><a href="#cb19-1581" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1582"><a href="#cb19-1582" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb19-1583"><a href="#cb19-1583" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb19-1584"><a href="#cb19-1584" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb19-1585"><a href="#cb19-1585" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb19-1586"><a href="#cb19-1586" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb19-1587"><a href="#cb19-1587" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb19-1588"><a href="#cb19-1588" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb19-1589"><a href="#cb19-1589" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb19-1590"><a href="#cb19-1590" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1591"><a href="#cb19-1591" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb19-1592"><a href="#cb19-1592" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb19-1593"><a href="#cb19-1593" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-1594"><a href="#cb19-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1595"><a href="#cb19-1595" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb19-1596"><a href="#cb19-1596" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb19-1597"><a href="#cb19-1597" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb19-1598"><a href="#cb19-1598" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb19-1599"><a href="#cb19-1599" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb19-1600"><a href="#cb19-1600" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb19-1601"><a href="#cb19-1601" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb19-1602"><a href="#cb19-1602" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb19-1603"><a href="#cb19-1603" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb19-1604"><a href="#cb19-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1605"><a href="#cb19-1605" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb19-1606"><a href="#cb19-1606" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1607"><a href="#cb19-1607" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb19-1608"><a href="#cb19-1608" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb19-1609"><a href="#cb19-1609" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1610"><a href="#cb19-1610" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb19-1611"><a href="#cb19-1611" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb19-1612"><a href="#cb19-1612" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb19-1613"><a href="#cb19-1613" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb19-1614"><a href="#cb19-1614" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb19-1615"><a href="#cb19-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1616"><a href="#cb19-1616" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb19-1617"><a href="#cb19-1617" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1618"><a href="#cb19-1618" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb19-1619"><a href="#cb19-1619" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb19-1620"><a href="#cb19-1620" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb19-1621"><a href="#cb19-1621" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb19-1622"><a href="#cb19-1622" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb19-1623"><a href="#cb19-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1624"><a href="#cb19-1624" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb19-1625"><a href="#cb19-1625" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb19-1626"><a href="#cb19-1626" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb19-1627"><a href="#cb19-1627" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb19-1628"><a href="#cb19-1628" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb19-1629"><a href="#cb19-1629" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb19-1630"><a href="#cb19-1630" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb19-1631"><a href="#cb19-1631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1632"><a href="#cb19-1632" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb19-1633"><a href="#cb19-1633" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb19-1634"><a href="#cb19-1634" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb19-1635"><a href="#cb19-1635" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb19-1636"><a href="#cb19-1636" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb19-1637"><a href="#cb19-1637" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb19-1638"><a href="#cb19-1638" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb19-1639"><a href="#cb19-1639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1640"><a href="#cb19-1640" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb19-1641"><a href="#cb19-1641" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb19-1642"><a href="#cb19-1642" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1643"><a href="#cb19-1643" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb19-1644"><a href="#cb19-1644" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb19-1645"><a href="#cb19-1645" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb19-1646"><a href="#cb19-1646" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb19-1647"><a href="#cb19-1647" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb19-1648"><a href="#cb19-1648" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb19-1649"><a href="#cb19-1649" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb19-1650"><a href="#cb19-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1651"><a href="#cb19-1651" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb19-1652"><a href="#cb19-1652" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb19-1653"><a href="#cb19-1653" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb19-1654"><a href="#cb19-1654" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb19-1655"><a href="#cb19-1655" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb19-1656"><a href="#cb19-1656" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb19-1657"><a href="#cb19-1657" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb19-1658"><a href="#cb19-1658" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb19-1659"><a href="#cb19-1659" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb19-1660"><a href="#cb19-1660" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb19-1661"><a href="#cb19-1661" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb19-1662"><a href="#cb19-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1663"><a href="#cb19-1663" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb19-1664"><a href="#cb19-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1665"><a href="#cb19-1665" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb19-1666"><a href="#cb19-1666" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-1667"><a href="#cb19-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1668"><a href="#cb19-1668" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb19-1669"><a href="#cb19-1669" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb19-1670"><a href="#cb19-1670" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb19-1671"><a href="#cb19-1671" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb19-1672"><a href="#cb19-1672" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-1673"><a href="#cb19-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1674"><a href="#cb19-1674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb19-1675"><a href="#cb19-1675" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb19-1676"><a href="#cb19-1676" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb19-1677"><a href="#cb19-1677" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-1678"><a href="#cb19-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1679"><a href="#cb19-1679" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb19-1680"><a href="#cb19-1680" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb19-1681"><a href="#cb19-1681" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb19-1682"><a href="#cb19-1682" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb19-1683"><a href="#cb19-1683" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-1684"><a href="#cb19-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1685"><a href="#cb19-1685" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb19-1686"><a href="#cb19-1686" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb19-1687"><a href="#cb19-1687" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb19-1688"><a href="#cb19-1688" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb19-1689"><a href="#cb19-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-1690"><a href="#cb19-1690" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb19-1691"><a href="#cb19-1691" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup-semis" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-semis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-19" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-semis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Rugby World Cup Semi Final and Final Matches.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb20" data-startfrom="1696" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1695;"><span id="cb20-1696"><a href="#cb20-1696" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCupFinals <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb20-1697"><a href="#cb20-1697" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb20-1698"><a href="#cb20-1698" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb20-1699"><a href="#cb20-1699" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb20-1700"><a href="#cb20-1700" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb20-1701"><a href="#cb20-1701" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb20-1702"><a href="#cb20-1702" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb20-1703"><a href="#cb20-1703" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">.</span><span class="fu">getFullYear</span>()</span>
<span id="cb20-1704"><a href="#cb20-1704" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb20-1705"><a href="#cb20-1705" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb20-1706"><a href="#cb20-1706" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a<span class="op">.</span><span class="at">year</span> <span class="op">!==</span> b<span class="op">.</span><span class="at">year</span>) <span class="cf">return</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb20-1707"><a href="#cb20-1707" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>)<span class="op">;</span></span>
<span id="cb20-1708"><a href="#cb20-1708" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> match) <span class="kw">=&gt;</span> {</span>
<span id="cb20-1709"><a href="#cb20-1709" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> year <span class="op">=</span> match<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb20-1710"><a href="#cb20-1710" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>acc[year]) acc[year] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb20-1711"><a href="#cb20-1711" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (acc[year]<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">2</span>) acc[year]<span class="op">.</span><span class="fu">push</span>(match)<span class="op">;</span></span>
<span id="cb20-1712"><a href="#cb20-1712" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb20-1713"><a href="#cb20-1713" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb20-1714"><a href="#cb20-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1715"><a href="#cb20-1715" aria-hidden="true" tabindex="-1"></a>top2Matches <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(matchDataRugbyWorldCupFinals)</span>
<span id="cb20-1716"><a href="#cb20-1716" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb20-1717"><a href="#cb20-1717" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>))</span>
<span id="cb20-1718"><a href="#cb20-1718" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb20-1719"><a href="#cb20-1719" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb20-1720"><a href="#cb20-1720" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb20-1721"><a href="#cb20-1721" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb20-1722"><a href="#cb20-1722" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb20-1723"><a href="#cb20-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1724"><a href="#cb20-1724" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCupFinals <span class="op">=</span> {</span>
<span id="cb20-1725"><a href="#cb20-1725" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb20-1726"><a href="#cb20-1726" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top2Matches) {</span>
<span id="cb20-1727"><a href="#cb20-1727" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb20-1728"><a href="#cb20-1728" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb20-1729"><a href="#cb20-1729" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb20-1730"><a href="#cb20-1730" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-1731"><a href="#cb20-1731" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb20-1732"><a href="#cb20-1732" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-1733"><a href="#cb20-1733" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb20-1734"><a href="#cb20-1734" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb20-1735"><a href="#cb20-1735" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb20-1736"><a href="#cb20-1736" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb20-1737"><a href="#cb20-1737" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb20-1738"><a href="#cb20-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1739"><a href="#cb20-1739" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCupFinals <span class="op">=</span> {</span>
<span id="cb20-1740"><a href="#cb20-1740" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb20-1741"><a href="#cb20-1741" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> top2Matches) {</span>
<span id="cb20-1742"><a href="#cb20-1742" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb20-1743"><a href="#cb20-1743" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb20-1744"><a href="#cb20-1744" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb20-1745"><a href="#cb20-1745" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb20-1746"><a href="#cb20-1746" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb20-1747"><a href="#cb20-1747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb20-1748"><a href="#cb20-1748" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb20-1749"><a href="#cb20-1749" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-1750"><a href="#cb20-1750" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb20-1751"><a href="#cb20-1751" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb20-1752"><a href="#cb20-1752" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb20-1753"><a href="#cb20-1753" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb20-1754"><a href="#cb20-1754" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb20-1755"><a href="#cb20-1755" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb20-1756"><a href="#cb20-1756" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb20-1757"><a href="#cb20-1757" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb20-1758"><a href="#cb20-1758" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb20-1759"><a href="#cb20-1759" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb20-1760"><a href="#cb20-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1761"><a href="#cb20-1761" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCupFinals <span class="op">=</span> teamStatsRugbyWorldCupFinals</span>
<span id="cb20-1762"><a href="#cb20-1762" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb20-1763"><a href="#cb20-1763" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb20-1764"><a href="#cb20-1764" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb20-1765"><a href="#cb20-1765" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb20-1766"><a href="#cb20-1766" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb20-1767"><a href="#cb20-1767" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb20-1768"><a href="#cb20-1768" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb20-1769"><a href="#cb20-1769" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb20-1770"><a href="#cb20-1770" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb20-1771"><a href="#cb20-1771" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb20-1772"><a href="#cb20-1772" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb20-1773"><a href="#cb20-1773" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb20-1774"><a href="#cb20-1774" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb20-1775"><a href="#cb20-1775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1776"><a href="#cb20-1776" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCupFinals <span class="op">=</span> {</span>
<span id="cb20-1777"><a href="#cb20-1777" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb20-1778"><a href="#cb20-1778" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb20-1779"><a href="#cb20-1779" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb20-1780"><a href="#cb20-1780" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCupFinals<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb20-1781"><a href="#cb20-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-1782"><a href="#cb20-1782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCupFinals<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb20-1783"><a href="#cb20-1783" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb20-1784"><a href="#cb20-1784" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb20-1785"><a href="#cb20-1785" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb20-1786"><a href="#cb20-1786" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb20-1787"><a href="#cb20-1787" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-20-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Final Matches">
<div class="sourceCode cell-code hidden" id="cb21" data-startfrom="1792" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1791;"><span id="cb21-1792"><a href="#cb21-1792" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCupFinals<span class="op">,</span> {</span>
<span id="cb21-1793"><a href="#cb21-1793" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb21-1794"><a href="#cb21-1794" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb21-1795"><a href="#cb21-1795" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb21-1796"><a href="#cb21-1796" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb21-1797"><a href="#cb21-1797" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb21-1798"><a href="#cb21-1798" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb21-1799"><a href="#cb21-1799" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb21-1800"><a href="#cb21-1800" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb21-1801"><a href="#cb21-1801" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb21-1802"><a href="#cb21-1802" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb21-1803"><a href="#cb21-1803" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb21-1804"><a href="#cb21-1804" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb21-1805"><a href="#cb21-1805" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb21-1806"><a href="#cb21-1806" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupFinals<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb21-1807"><a href="#cb21-1807" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupFinals<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb21-1808"><a href="#cb21-1808" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb21-1809"><a href="#cb21-1809" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupFinals<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb21-1810"><a href="#cb21-1810" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb21-1811"><a href="#cb21-1811" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb21-1812"><a href="#cb21-1812" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb21-1813"><a href="#cb21-1813" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup-finals" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-21" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb22" data-startfrom="1819" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1818;"><span id="cb22-1819"><a href="#cb22-1819" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-1820"><a href="#cb22-1820" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb22-1821"><a href="#cb22-1821" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb22-1822"><a href="#cb22-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1823"><a href="#cb22-1823" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb22-1824"><a href="#cb22-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1825"><a href="#cb22-1825" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCupFinals<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb22-1826"><a href="#cb22-1826" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCupFinals<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb22-1827"><a href="#cb22-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1828"><a href="#cb22-1828" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb22-1829"><a href="#cb22-1829" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb22-1830"><a href="#cb22-1830" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb22-1831"><a href="#cb22-1831" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">50</span>])<span class="op">;</span></span>
<span id="cb22-1832"><a href="#cb22-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1833"><a href="#cb22-1833" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb22-1834"><a href="#cb22-1834" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb22-1835"><a href="#cb22-1835" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb22-1836"><a href="#cb22-1836" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb22-1837"><a href="#cb22-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1838"><a href="#cb22-1838" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb22-1839"><a href="#cb22-1839" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb22-1840"><a href="#cb22-1840" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb22-1841"><a href="#cb22-1841" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb22-1842"><a href="#cb22-1842" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb22-1843"><a href="#cb22-1843" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb22-1844"><a href="#cb22-1844" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb22-1845"><a href="#cb22-1845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1846"><a href="#cb22-1846" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb22-1847"><a href="#cb22-1847" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb22-1848"><a href="#cb22-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1849"><a href="#cb22-1849" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb22-1850"><a href="#cb22-1850" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb22-1851"><a href="#cb22-1851" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb22-1852"><a href="#cb22-1852" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb22-1853"><a href="#cb22-1853" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb22-1854"><a href="#cb22-1854" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb22-1855"><a href="#cb22-1855" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb22-1856"><a href="#cb22-1856" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb22-1857"><a href="#cb22-1857" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb22-1858"><a href="#cb22-1858" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb22-1859"><a href="#cb22-1859" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb22-1860"><a href="#cb22-1860" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb22-1861"><a href="#cb22-1861" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb22-1862"><a href="#cb22-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1863"><a href="#cb22-1863" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb22-1864"><a href="#cb22-1864" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb22-1865"><a href="#cb22-1865" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb22-1866"><a href="#cb22-1866" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb22-1867"><a href="#cb22-1867" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb22-1868"><a href="#cb22-1868" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-1869"><a href="#cb22-1869" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb22-1870"><a href="#cb22-1870" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb22-1871"><a href="#cb22-1871" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb22-1872"><a href="#cb22-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1873"><a href="#cb22-1873" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb22-1874"><a href="#cb22-1874" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb22-1875"><a href="#cb22-1875" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb22-1876"><a href="#cb22-1876" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb22-1877"><a href="#cb22-1877" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb22-1878"><a href="#cb22-1878" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb22-1879"><a href="#cb22-1879" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb22-1880"><a href="#cb22-1880" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb22-1881"><a href="#cb22-1881" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb22-1882"><a href="#cb22-1882" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb22-1883"><a href="#cb22-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1884"><a href="#cb22-1884" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb22-1885"><a href="#cb22-1885" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb22-1886"><a href="#cb22-1886" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb22-1887"><a href="#cb22-1887" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb22-1888"><a href="#cb22-1888" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb22-1889"><a href="#cb22-1889" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb22-1890"><a href="#cb22-1890" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb22-1891"><a href="#cb22-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1892"><a href="#cb22-1892" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb22-1893"><a href="#cb22-1893" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb22-1894"><a href="#cb22-1894" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb22-1895"><a href="#cb22-1895" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb22-1896"><a href="#cb22-1896" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb22-1897"><a href="#cb22-1897" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb22-1898"><a href="#cb22-1898" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb22-1899"><a href="#cb22-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1900"><a href="#cb22-1900" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb22-1901"><a href="#cb22-1901" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb22-1902"><a href="#cb22-1902" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb22-1903"><a href="#cb22-1903" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb22-1904"><a href="#cb22-1904" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb22-1905"><a href="#cb22-1905" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb22-1906"><a href="#cb22-1906" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb22-1907"><a href="#cb22-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1908"><a href="#cb22-1908" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb22-1909"><a href="#cb22-1909" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb22-1910"><a href="#cb22-1910" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb22-1911"><a href="#cb22-1911" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb22-1912"><a href="#cb22-1912" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb22-1913"><a href="#cb22-1913" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb22-1914"><a href="#cb22-1914" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb22-1915"><a href="#cb22-1915" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb22-1916"><a href="#cb22-1916" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb22-1917"><a href="#cb22-1917" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb22-1918"><a href="#cb22-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1919"><a href="#cb22-1919" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb22-1920"><a href="#cb22-1920" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb22-1921"><a href="#cb22-1921" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb22-1922"><a href="#cb22-1922" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb22-1923"><a href="#cb22-1923" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb22-1924"><a href="#cb22-1924" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb22-1925"><a href="#cb22-1925" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb22-1926"><a href="#cb22-1926" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb22-1927"><a href="#cb22-1927" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb22-1928"><a href="#cb22-1928" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb22-1929"><a href="#cb22-1929" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb22-1930"><a href="#cb22-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1931"><a href="#cb22-1931" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb22-1932"><a href="#cb22-1932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1933"><a href="#cb22-1933" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb22-1934"><a href="#cb22-1934" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1935"><a href="#cb22-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1936"><a href="#cb22-1936" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb22-1937"><a href="#cb22-1937" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb22-1938"><a href="#cb22-1938" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb22-1939"><a href="#cb22-1939" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb22-1940"><a href="#cb22-1940" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1941"><a href="#cb22-1941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1942"><a href="#cb22-1942" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb22-1943"><a href="#cb22-1943" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb22-1944"><a href="#cb22-1944" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb22-1945"><a href="#cb22-1945" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1946"><a href="#cb22-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1947"><a href="#cb22-1947" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb22-1948"><a href="#cb22-1948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb22-1949"><a href="#cb22-1949" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb22-1950"><a href="#cb22-1950" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb22-1951"><a href="#cb22-1951" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-1952"><a href="#cb22-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1953"><a href="#cb22-1953" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb22-1954"><a href="#cb22-1954" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb22-1955"><a href="#cb22-1955" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb22-1956"><a href="#cb22-1956" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb22-1957"><a href="#cb22-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1958"><a href="#cb22-1958" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb22-1959"><a href="#cb22-1959" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup-finals" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-22" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-finals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Rugby World Cup Final Matches.
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb23" data-startfrom="1964" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1963;"><span id="cb23-1964"><a href="#cb23-1964" aria-hidden="true" tabindex="-1"></a>matchDataRugbyWorldCupTest <span class="op">=</span> (<span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"rugby.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({ <span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span> }))</span>
<span id="cb23-1965"><a href="#cb23-1965" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">competition_name</span> <span class="op">===</span> <span class="st">"Rugby World Cup"</span>)</span>
<span id="cb23-1966"><a href="#cb23-1966" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb23-1967"><a href="#cb23-1967" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb23-1968"><a href="#cb23-1968" aria-hidden="true" tabindex="-1"></a>        <span class="dt">home_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">home_score</span><span class="op">,</span></span>
<span id="cb23-1969"><a href="#cb23-1969" aria-hidden="true" tabindex="-1"></a>        <span class="dt">away_score</span><span class="op">:</span> <span class="op">+</span>d<span class="op">.</span><span class="at">away_score</span><span class="op">,</span></span>
<span id="cb23-1970"><a href="#cb23-1970" aria-hidden="true" tabindex="-1"></a>        <span class="dt">match_date</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">,</span></span>
<span id="cb23-1971"><a href="#cb23-1971" aria-hidden="true" tabindex="-1"></a>        <span class="dt">year</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">match_date</span>)<span class="op">.</span><span class="fu">getFullYear</span>()</span>
<span id="cb23-1972"><a href="#cb23-1972" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb23-1973"><a href="#cb23-1973" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> {</span>
<span id="cb23-1974"><a href="#cb23-1974" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (a<span class="op">.</span><span class="at">year</span> <span class="op">!==</span> b<span class="op">.</span><span class="at">year</span>) <span class="cf">return</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb23-1975"><a href="#cb23-1975" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>)<span class="op">;</span></span>
<span id="cb23-1976"><a href="#cb23-1976" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> match) <span class="kw">=&gt;</span> {</span>
<span id="cb23-1977"><a href="#cb23-1977" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> year <span class="op">=</span> match<span class="op">.</span><span class="at">year</span><span class="op">;</span></span>
<span id="cb23-1978"><a href="#cb23-1978" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>acc[year]) acc[year] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb23-1979"><a href="#cb23-1979" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (acc[year]<span class="op">.</span><span class="at">length</span> <span class="op">&lt;</span> <span class="dv">8</span>) acc[year]<span class="op">.</span><span class="fu">push</span>(match)<span class="op">;</span></span>
<span id="cb23-1980"><a href="#cb23-1980" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb23-1981"><a href="#cb23-1981" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb23-1982"><a href="#cb23-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1983"><a href="#cb23-1983" aria-hidden="true" tabindex="-1"></a>testMatches <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(matchDataRugbyWorldCupTest)</span>
<span id="cb23-1984"><a href="#cb23-1984" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">flat</span>()</span>
<span id="cb23-1985"><a href="#cb23-1985" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(a<span class="op">.</span><span class="at">match_date</span>) <span class="op">-</span> <span class="kw">new</span> <span class="bu">Date</span>(b<span class="op">.</span><span class="at">match_date</span>))</span>
<span id="cb23-1986"><a href="#cb23-1986" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb23-1987"><a href="#cb23-1987" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb23-1988"><a href="#cb23-1988" aria-hidden="true" tabindex="-1"></a>        <span class="dt">winner</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">home_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">away_team</span><span class="op">,</span></span>
<span id="cb23-1989"><a href="#cb23-1989" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loser</span><span class="op">:</span> d<span class="op">.</span><span class="at">home_score</span> <span class="op">&gt;</span> d<span class="op">.</span><span class="at">away_score</span> <span class="op">?</span> d<span class="op">.</span><span class="at">away_team</span> <span class="op">:</span> d<span class="op">.</span><span class="at">home_team</span></span>
<span id="cb23-1990"><a href="#cb23-1990" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb23-1991"><a href="#cb23-1991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1992"><a href="#cb23-1992" aria-hidden="true" tabindex="-1"></a>teamStatsRugbyWorldCupTest <span class="op">=</span> {</span>
<span id="cb23-1993"><a href="#cb23-1993" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> stats <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb23-1994"><a href="#cb23-1994" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> testMatches) {</span>
<span id="cb23-1995"><a href="#cb23-1995" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">const</span> team <span class="kw">of</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]) {</span>
<span id="cb23-1996"><a href="#cb23-1996" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (<span class="op">!</span>stats<span class="op">.</span><span class="fu">has</span>(team)) stats<span class="op">.</span><span class="fu">set</span>(team<span class="op">,</span> { team<span class="op">,</span> <span class="dt">games</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb23-1997"><a href="#cb23-1997" aria-hidden="true" tabindex="-1"></a>            stats<span class="op">.</span><span class="fu">get</span>(team)<span class="op">.</span><span class="at">games</span><span class="op">++;</span></span>
<span id="cb23-1998"><a href="#cb23-1998" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-1999"><a href="#cb23-1999" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">winner</span>)<span class="op">.</span><span class="at">wins</span><span class="op">++;</span></span>
<span id="cb23-2000"><a href="#cb23-2000" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-2001"><a href="#cb23-2001" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(stats<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb23-2002"><a href="#cb23-2002" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb23-2003"><a href="#cb23-2003" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span> <span class="op">/</span> d<span class="op">.</span><span class="at">games</span></span>
<span id="cb23-2004"><a href="#cb23-2004" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span> b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span> b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span>)<span class="op">;</span></span>
<span id="cb23-2005"><a href="#cb23-2005" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb23-2006"><a href="#cb23-2006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2007"><a href="#cb23-2007" aria-hidden="true" tabindex="-1"></a>edgesRugbyWorldCupTest <span class="op">=</span> {</span>
<span id="cb23-2008"><a href="#cb23-2008" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> edgeMap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb23-2009"><a href="#cb23-2009" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> d <span class="kw">of</span> testMatches) {</span>
<span id="cb23-2010"><a href="#cb23-2010" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> [team1<span class="op">,</span> team2] <span class="op">=</span> [d<span class="op">.</span><span class="at">home_team</span><span class="op">,</span> d<span class="op">.</span><span class="at">away_team</span>]<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb23-2011"><a href="#cb23-2011" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>team1<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>team2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb23-2012"><a href="#cb23-2012" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>edgeMap<span class="op">.</span><span class="fu">has</span>(key)) edgeMap<span class="op">.</span><span class="fu">set</span>(key<span class="op">,</span> { team1<span class="op">,</span> team2<span class="op">,</span> <span class="dt">wins_team1</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">wins_team2</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">total</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb23-2013"><a href="#cb23-2013" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> edge <span class="op">=</span> edgeMap<span class="op">.</span><span class="fu">get</span>(key)<span class="op">;</span></span>
<span id="cb23-2014"><a href="#cb23-2014" aria-hidden="true" tabindex="-1"></a>        edge<span class="op">.</span><span class="at">total</span><span class="op">++;</span></span>
<span id="cb23-2015"><a href="#cb23-2015" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (d<span class="op">.</span><span class="at">winner</span> <span class="op">===</span> team1) edge<span class="op">.</span><span class="at">wins_team1</span><span class="op">++;</span></span>
<span id="cb23-2016"><a href="#cb23-2016" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> edge<span class="op">.</span><span class="at">wins_team2</span><span class="op">++;</span></span>
<span id="cb23-2017"><a href="#cb23-2017" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-2018"><a href="#cb23-2018" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(edgeMap<span class="op">.</span><span class="fu">values</span>())<span class="op">.</span><span class="fu">map</span>(({ team1<span class="op">,</span> team2<span class="op">,</span> wins_team1<span class="op">,</span> wins_team2<span class="op">,</span> total }) <span class="kw">=&gt;</span> {</span>
<span id="cb23-2019"><a href="#cb23-2019" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dominant <span class="op">=</span> wins_team1 <span class="op">&gt;=</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb23-2020"><a href="#cb23-2020" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> weaker <span class="op">=</span> wins_team1 <span class="op">&lt;</span> wins_team2 <span class="op">?</span> team1 <span class="op">:</span> team2<span class="op">;</span></span>
<span id="cb23-2021"><a href="#cb23-2021" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb23-2022"><a href="#cb23-2022" aria-hidden="true" tabindex="-1"></a>            <span class="dt">source</span><span class="op">:</span> dominant<span class="op">,</span></span>
<span id="cb23-2023"><a href="#cb23-2023" aria-hidden="true" tabindex="-1"></a>            <span class="dt">target</span><span class="op">:</span> weaker<span class="op">,</span></span>
<span id="cb23-2024"><a href="#cb23-2024" aria-hidden="true" tabindex="-1"></a>            <span class="dt">weight</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(wins_team1<span class="op">,</span> wins_team2) <span class="op">/</span> total</span>
<span id="cb23-2025"><a href="#cb23-2025" aria-hidden="true" tabindex="-1"></a>        }<span class="op">;</span></span>
<span id="cb23-2026"><a href="#cb23-2026" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb23-2027"><a href="#cb23-2027" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb23-2028"><a href="#cb23-2028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2029"><a href="#cb23-2029" aria-hidden="true" tabindex="-1"></a>nodesRugbyWorldCupTest <span class="op">=</span> teamStatsRugbyWorldCupTest</span>
<span id="cb23-2030"><a href="#cb23-2030" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> ({</span>
<span id="cb23-2031"><a href="#cb23-2031" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> d<span class="op">.</span><span class="at">team</span><span class="op">,</span></span>
<span id="cb23-2032"><a href="#cb23-2032" aria-hidden="true" tabindex="-1"></a>        <span class="dt">group</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb23-2033"><a href="#cb23-2033" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> d<span class="op">.</span><span class="at">wins</span><span class="op">,</span></span>
<span id="cb23-2034"><a href="#cb23-2034" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> d<span class="op">.</span><span class="at">games</span><span class="op">,</span></span>
<span id="cb23-2035"><a href="#cb23-2035" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> d<span class="op">.</span><span class="at">win_rate</span><span class="op">,</span></span>
<span id="cb23-2036"><a href="#cb23-2036" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">team</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb23-2037"><a href="#cb23-2037" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb23-2038"><a href="#cb23-2038" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span></span>
<span id="cb23-2039"><a href="#cb23-2039" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">wins</span> <span class="op">-</span> a<span class="op">.</span><span class="at">wins</span> <span class="op">||</span></span>
<span id="cb23-2040"><a href="#cb23-2040" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">games</span> <span class="op">-</span> a<span class="op">.</span><span class="at">games</span> <span class="op">||</span></span>
<span id="cb23-2041"><a href="#cb23-2041" aria-hidden="true" tabindex="-1"></a>        b<span class="op">.</span><span class="at">win_rate</span> <span class="op">-</span> a<span class="op">.</span><span class="at">win_rate</span></span>
<span id="cb23-2042"><a href="#cb23-2042" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb23-2043"><a href="#cb23-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2044"><a href="#cb23-2044" aria-hidden="true" tabindex="-1"></a>circularNodesRugbyWorldCupTest <span class="op">=</span> {</span>
<span id="cb23-2045"><a href="#cb23-2045" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">250</span><span class="op">;</span></span>
<span id="cb23-2046"><a href="#cb23-2046" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerX <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb23-2047"><a href="#cb23-2047" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> centerY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span>
<span id="cb23-2048"><a href="#cb23-2048" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angleStep <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> nodesRugbyWorldCupTest<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb23-2049"><a href="#cb23-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2050"><a href="#cb23-2050" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodesRugbyWorldCupTest<span class="op">.</span><span class="fu">map</span>((node<span class="op">,</span> i) <span class="kw">=&gt;</span> ({</span>
<span id="cb23-2051"><a href="#cb23-2051" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>node<span class="op">,</span></span>
<span id="cb23-2052"><a href="#cb23-2052" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fx</span><span class="op">:</span> centerX <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> angleStep)<span class="op">,</span></span>
<span id="cb23-2053"><a href="#cb23-2053" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fy</span><span class="op">:</span> centerY <span class="op">+</span> radius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> angleStep)</span>
<span id="cb23-2054"><a href="#cb23-2054" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb23-2055"><a href="#cb23-2055" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell" data-tbl-cap="Rugby World Cup Test Matches">
<div class="sourceCode cell-code hidden" id="cb24" data-startfrom="2060" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2059;"><span id="cb24-2060"><a href="#cb24-2060" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(nodesRugbyWorldCupTest<span class="op">,</span> {</span>
<span id="cb24-2061"><a href="#cb24-2061" aria-hidden="true" tabindex="-1"></a>    <span class="dt">columns</span><span class="op">:</span> [</span>
<span id="cb24-2062"><a href="#cb24-2062" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id"</span><span class="op">,</span></span>
<span id="cb24-2063"><a href="#cb24-2063" aria-hidden="true" tabindex="-1"></a>        <span class="st">"games"</span><span class="op">,</span></span>
<span id="cb24-2064"><a href="#cb24-2064" aria-hidden="true" tabindex="-1"></a>        <span class="st">"wins"</span><span class="op">,</span></span>
<span id="cb24-2065"><a href="#cb24-2065" aria-hidden="true" tabindex="-1"></a>        <span class="st">"win_rate"</span></span>
<span id="cb24-2066"><a href="#cb24-2066" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb24-2067"><a href="#cb24-2067" aria-hidden="true" tabindex="-1"></a>    <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb24-2068"><a href="#cb24-2068" aria-hidden="true" tabindex="-1"></a>        <span class="dt">id</span><span class="op">:</span> <span class="st">"Country"</span><span class="op">,</span></span>
<span id="cb24-2069"><a href="#cb24-2069" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="st">"Number of Matches Played"</span><span class="op">,</span></span>
<span id="cb24-2070"><a href="#cb24-2070" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="st">"Number of Matches Won"</span><span class="op">,</span></span>
<span id="cb24-2071"><a href="#cb24-2071" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="st">"Win Rate"</span></span>
<span id="cb24-2072"><a href="#cb24-2072" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb24-2073"><a href="#cb24-2073" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb24-2074"><a href="#cb24-2074" aria-hidden="true" tabindex="-1"></a>        <span class="dt">games</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupTest<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"games"</span>]))<span class="op">,</span></span>
<span id="cb24-2075"><a href="#cb24-2075" aria-hidden="true" tabindex="-1"></a>        <span class="dt">wins</span><span class="op">:</span> <span class="fu">sparkbar</span>(d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupTest<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"wins"</span>]))<span class="op">,</span></span>
<span id="cb24-2076"><a href="#cb24-2076" aria-hidden="true" tabindex="-1"></a>        <span class="dt">win_rate</span><span class="op">:</span> <span class="fu">sparkbarPercent</span>(</span>
<span id="cb24-2077"><a href="#cb24-2077" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">max</span>(nodesRugbyWorldCupTest<span class="op">,</span> (d) <span class="kw">=&gt;</span> d[<span class="st">"win_rate"</span>])</span>
<span id="cb24-2078"><a href="#cb24-2078" aria-hidden="true" tabindex="-1"></a>        )<span class="op">,</span></span>
<span id="cb24-2079"><a href="#cb24-2079" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb24-2080"><a href="#cb24-2080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rows</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb24-2081"><a href="#cb24-2081" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-rugby-world-cup-test" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-rugby-world-cup-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8
</figcaption>
<div aria-describedby="tbl-rugby-world-cup-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-24" data-nodetype="expression">

</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb25" data-startfrom="2087" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2086;"><span id="cb25-2087"><a href="#cb25-2087" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-2088"><a href="#cb25-2088" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb25-2089"><a href="#cb25-2089" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> height <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span>
<span id="cb25-2090"><a href="#cb25-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2091"><a href="#cb25-2091" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> color <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleOrdinal</span>(personal_colours)<span class="op">;</span></span>
<span id="cb25-2092"><a href="#cb25-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2093"><a href="#cb25-2093" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links <span class="op">=</span> edgesRugbyWorldCupTest<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb25-2094"><a href="#cb25-2094" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> nodes <span class="op">=</span> circularNodesRugbyWorldCupTest<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({ <span class="op">...</span>d }))<span class="op">;</span></span>
<span id="cb25-2095"><a href="#cb25-2095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2096"><a href="#cb25-2096" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> radiusScale <span class="op">=</span> d3</span>
<span id="cb25-2097"><a href="#cb25-2097" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleSqrt</span>()</span>
<span id="cb25-2098"><a href="#cb25-2098" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(nodes<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">wins</span>)])</span>
<span id="cb25-2099"><a href="#cb25-2099" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="dv">5</span><span class="op">,</span> <span class="dv">50</span>])<span class="op">;</span></span>
<span id="cb25-2100"><a href="#cb25-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2101"><a href="#cb25-2101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> linkColor <span class="op">=</span> d3</span>
<span id="cb25-2102"><a href="#cb25-2102" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb25-2103"><a href="#cb25-2103" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">,</span> <span class="dv">1</span>])</span>
<span id="cb25-2104"><a href="#cb25-2104" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">range</span>([<span class="st">"#2ca02c"</span><span class="op">,</span> <span class="st">"#ff7f0e"</span><span class="op">,</span> <span class="st">"#d62728"</span>])<span class="op">;</span></span>
<span id="cb25-2105"><a href="#cb25-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2106"><a href="#cb25-2106" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb25-2107"><a href="#cb25-2107" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb25-2108"><a href="#cb25-2108" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb25-2109"><a href="#cb25-2109" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb25-2110"><a href="#cb25-2110" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height <span class="op">+</span> <span class="dv">50</span>])</span>
<span id="cb25-2111"><a href="#cb25-2111" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"preserveAspectRatio"</span><span class="op">,</span> <span class="st">"xMidYMid meet"</span>)</span>
<span id="cb25-2112"><a href="#cb25-2112" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb25-2113"><a href="#cb25-2113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2114"><a href="#cb25-2114" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create a unique arrowhead marker for each link</span></span>
<span id="cb25-2115"><a href="#cb25-2115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb25-2116"><a href="#cb25-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2117"><a href="#cb25-2117" aria-hidden="true" tabindex="-1"></a>    links<span class="op">.</span><span class="fu">forEach</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb25-2118"><a href="#cb25-2118" aria-hidden="true" tabindex="-1"></a>        defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb25-2119"><a href="#cb25-2119" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="vs">`arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb25-2120"><a href="#cb25-2120" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="st">"0 -3 6 6"</span>)</span>
<span id="cb25-2121"><a href="#cb25-2121" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb25-2122"><a href="#cb25-2122" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb25-2123"><a href="#cb25-2123" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb25-2124"><a href="#cb25-2124" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb25-2125"><a href="#cb25-2125" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto"</span>)</span>
<span id="cb25-2126"><a href="#cb25-2126" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb25-2127"><a href="#cb25-2127" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="st">"M0,-3L6,0L0,3"</span>)</span>
<span id="cb25-2128"><a href="#cb25-2128" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))<span class="op">;</span></span>
<span id="cb25-2129"><a href="#cb25-2129" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb25-2130"><a href="#cb25-2130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2131"><a href="#cb25-2131" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> simulation <span class="op">=</span> d3</span>
<span id="cb25-2132"><a href="#cb25-2132" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">forceSimulation</span>(nodes)</span>
<span id="cb25-2133"><a href="#cb25-2133" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(</span>
<span id="cb25-2134"><a href="#cb25-2134" aria-hidden="true" tabindex="-1"></a>            <span class="st">"link"</span><span class="op">,</span></span>
<span id="cb25-2135"><a href="#cb25-2135" aria-hidden="true" tabindex="-1"></a>            d3<span class="op">.</span><span class="fu">forceLink</span>(links)<span class="op">.</span><span class="fu">id</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)</span>
<span id="cb25-2136"><a href="#cb25-2136" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-2137"><a href="#cb25-2137" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"charge"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceManyBody</span>())</span>
<span id="cb25-2138"><a href="#cb25-2138" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">force</span>(<span class="st">"center"</span><span class="op">,</span> d3<span class="op">.</span><span class="fu">forceCenter</span>(width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb25-2139"><a href="#cb25-2139" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">on</span>(<span class="st">"tick"</span><span class="op">,</span> ticked)<span class="op">;</span></span>
<span id="cb25-2140"><a href="#cb25-2140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2141"><a href="#cb25-2141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> svg</span>
<span id="cb25-2142"><a href="#cb25-2142" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb25-2143"><a href="#cb25-2143" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb25-2144"><a href="#cb25-2144" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb25-2145"><a href="#cb25-2145" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb25-2146"><a href="#cb25-2146" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(links)</span>
<span id="cb25-2147"><a href="#cb25-2147" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb25-2148"><a href="#cb25-2148" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">linkColor</span>(d<span class="op">.</span><span class="at">weight</span>))</span>
<span id="cb25-2149"><a href="#cb25-2149" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">weight</span>)</span>
<span id="cb25-2150"><a href="#cb25-2150" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`url(#arrowhead-</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb25-2151"><a href="#cb25-2151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2152"><a href="#cb25-2152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> node <span class="op">=</span> svg</span>
<span id="cb25-2153"><a href="#cb25-2153" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb25-2154"><a href="#cb25-2154" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb25-2155"><a href="#cb25-2155" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb25-2156"><a href="#cb25-2156" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb25-2157"><a href="#cb25-2157" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">wins</span>))</span>
<span id="cb25-2158"><a href="#cb25-2158" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">color</span>(d<span class="op">.</span><span class="at">group</span>))<span class="op">;</span></span>
<span id="cb25-2159"><a href="#cb25-2159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2160"><a href="#cb25-2160" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Tooltip with full team stats</span></span>
<span id="cb25-2161"><a href="#cb25-2161" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">append</span>(<span class="st">"title"</span>)<span class="op">.</span><span class="fu">text</span>(</span>
<span id="cb25-2162"><a href="#cb25-2162" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span></span>
<span id="cb25-2163"><a href="#cb25-2163" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">id</span><span class="sc">}\n</span><span class="vs">Wins: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">wins</span><span class="sc">}\n</span><span class="vs">Games: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">games</span><span class="sc">}\n</span><span class="vs">Win Rate: </span><span class="sc">${</span>(</span>
<span id="cb25-2164"><a href="#cb25-2164" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="at">win_rate</span> <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb25-2165"><a href="#cb25-2165" aria-hidden="true" tabindex="-1"></a>            )<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb25-2166"><a href="#cb25-2166" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb25-2167"><a href="#cb25-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2168"><a href="#cb25-2168" aria-hidden="true" tabindex="-1"></a>    node<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb25-2169"><a href="#cb25-2169" aria-hidden="true" tabindex="-1"></a>        d3</span>
<span id="cb25-2170"><a href="#cb25-2170" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb25-2171"><a href="#cb25-2171" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"start"</span><span class="op">,</span> dragstarted)</span>
<span id="cb25-2172"><a href="#cb25-2172" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> dragged)</span>
<span id="cb25-2173"><a href="#cb25-2173" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">on</span>(<span class="st">"end"</span><span class="op">,</span> dragended)</span>
<span id="cb25-2174"><a href="#cb25-2174" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb25-2175"><a href="#cb25-2175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2176"><a href="#cb25-2176" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> labels <span class="op">=</span> svg</span>
<span id="cb25-2177"><a href="#cb25-2177" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb25-2178"><a href="#cb25-2178" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text"</span>)</span>
<span id="cb25-2179"><a href="#cb25-2179" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb25-2180"><a href="#cb25-2180" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb25-2181"><a href="#cb25-2181" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb25-2182"><a href="#cb25-2182" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb25-2183"><a href="#cb25-2183" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"10px"</span>)</span>
<span id="cb25-2184"><a href="#cb25-2184" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#333"</span>)</span>
<span id="cb25-2185"><a href="#cb25-2185" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb25-2186"><a href="#cb25-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2187"><a href="#cb25-2187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">ticked</span>() {</span>
<span id="cb25-2188"><a href="#cb25-2188" aria-hidden="true" tabindex="-1"></a>        link<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb25-2189"><a href="#cb25-2189" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dx <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">x</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb25-2190"><a href="#cb25-2190" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dy <span class="op">=</span> d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">y</span> <span class="op">-</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb25-2191"><a href="#cb25-2191" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> dr <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy)<span class="op">;</span></span>
<span id="cb25-2192"><a href="#cb25-2192" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> r <span class="op">=</span> <span class="fu">radiusScale</span>(d<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="at">wins</span>)<span class="op">;</span></span>
<span id="cb25-2193"><a href="#cb25-2193" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ratio <span class="op">=</span> (dr <span class="op">-</span> r) <span class="op">/</span> dr<span class="op">;</span></span>
<span id="cb25-2194"><a href="#cb25-2194" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> tx <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span> <span class="op">+</span> dx <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb25-2195"><a href="#cb25-2195" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> ty <span class="op">=</span> d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span> <span class="op">+</span> dy <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb25-2196"><a href="#cb25-2196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">source</span><span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">L</span><span class="sc">${</span>tx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>ty<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb25-2197"><a href="#cb25-2197" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb25-2198"><a href="#cb25-2198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2199"><a href="#cb25-2199" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb25-2200"><a href="#cb25-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2201"><a href="#cb25-2201" aria-hidden="true" tabindex="-1"></a>        labels<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">;</span></span>
<span id="cb25-2202"><a href="#cb25-2202" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-2203"><a href="#cb25-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2204"><a href="#cb25-2204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragstarted</span>(<span class="bu">event</span>) {</span>
<span id="cb25-2205"><a href="#cb25-2205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="fl">0.3</span>)<span class="op">.</span><span class="fu">restart</span>()<span class="op">;</span></span>
<span id="cb25-2206"><a href="#cb25-2206" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb25-2207"><a href="#cb25-2207" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb25-2208"><a href="#cb25-2208" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-2209"><a href="#cb25-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2210"><a href="#cb25-2210" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragged</span>(<span class="bu">event</span>) {</span>
<span id="cb25-2211"><a href="#cb25-2211" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">;</span></span>
<span id="cb25-2212"><a href="#cb25-2212" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span><span class="op">;</span></span>
<span id="cb25-2213"><a href="#cb25-2213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-2214"><a href="#cb25-2214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2215"><a href="#cb25-2215" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">dragended</span>(<span class="bu">event</span>) {</span>
<span id="cb25-2216"><a href="#cb25-2216" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">active</span>) simulation<span class="op">.</span><span class="fu">alphaTarget</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb25-2217"><a href="#cb25-2217" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fx</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb25-2218"><a href="#cb25-2218" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="at">subject</span><span class="op">.</span><span class="at">fy</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb25-2219"><a href="#cb25-2219" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-2220"><a href="#cb25-2220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2221"><a href="#cb25-2221" aria-hidden="true" tabindex="-1"></a>    <span class="co">// When this cell is re-run, stop the previous simulation. (This doesn’t</span></span>
<span id="cb25-2222"><a href="#cb25-2222" aria-hidden="true" tabindex="-1"></a>    <span class="co">// really matter since the target alpha is zero and the simulation will</span></span>
<span id="cb25-2223"><a href="#cb25-2223" aria-hidden="true" tabindex="-1"></a>    <span class="co">// stop naturally, but it’s a good practice.)</span></span>
<span id="cb25-2224"><a href="#cb25-2224" aria-hidden="true" tabindex="-1"></a>    invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> simulation<span class="op">.</span><span class="fu">stop</span>())<span class="op">;</span></span>
<span id="cb25-2225"><a href="#cb25-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2226"><a href="#cb25-2226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb25-2227"><a href="#cb25-2227" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-rugby-world-cup-test" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rugby-world-cup-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ojs-cell-25" data-nodetype="expression">

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rugby-world-cup-test-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Rugby World Cup Test Matches.
</figcaption>
</figure>
</div>
</div>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBlcnNvbmFsX2NvbG91cnMgPSBbXHJcbiAgICBcIiMwMDgwQUJcIixcclxuICAgIFwiI0M5MTk3RFwiLFxyXG4gICAgXCIjMUU3QjIwXCIsXHJcbiAgICBcIiM5MTQyNzhcIixcclxuICAgIFwiIzI4NDEyQ1wiLFxyXG4gICAgXCIjRDExRjBCXCIsXHJcbiAgICBcIiM0MjI0QkZcIixcclxuICAgIFwiIzg4NTAyRVwiLFxyXG4gICAgXCIjMTAwNzM5XCIsXHJcbiAgICBcIiMzNzBFMDFcIixcclxuICAgIFwiIzJGNjVEMFwiLFxyXG4gICAgXCIjOUYwNEZDXCIsXHJcbiAgICBcIiMzMzk5QkNcIixcclxuICAgIFwiI0Q0NDc5N1wiLFxyXG4gICAgXCIjNEI5NTREXCIsXHJcbiAgICBcIiNBNzY4OTNcIixcclxuICAgIFwiIzUzNjc1NlwiLFxyXG4gICAgXCIjREE0QzNDXCIsXHJcbiAgICBcIiM2ODUwQ0NcIixcclxuICAgIFwiI0EwNzM1OFwiLFxyXG4gICAgXCIjNDAzOTYxXCIsXHJcbiAgICBcIiM1RjNFMzRcIixcclxuICAgIFwiIzU5ODREOVwiLFxyXG4gICAgXCIjQjIzNkZEXCIsXHJcbiAgICBcIiM2NkIzQ0RcIixcclxuICAgIFwiI0RGNzVCMVwiLFxyXG4gICAgXCIjNzhCMDc5XCIsXHJcbiAgICBcIiNCRDhFQUVcIixcclxuICAgIFwiIzdFOEQ4MFwiLFxyXG4gICAgXCIjRTM3OTZEXCIsXHJcbiAgICBcIiM4RTdDRDlcIixcclxuICAgIFwiI0I4OTY4MlwiLFxyXG4gICAgXCIjNzA2QTg4XCIsXHJcbiAgICBcIiM4NzZFNjdcIixcclxuICAgIFwiIzgyQTNFM1wiLFxyXG4gICAgXCIjQzU2OEZEXCIsXHJcbiAgICBcIiM5OUNDRERcIixcclxuICAgIFwiI0U5QTNDQlwiLFxyXG4gICAgXCIjQTVDQUE2XCIsXHJcbiAgICBcIiNEM0IzQzlcIixcclxuICAgIFwiI0E5QjNBQlwiLFxyXG4gICAgXCIjRURBNTlEXCIsXHJcbiAgICBcIiNCM0E3RTVcIixcclxuICAgIFwiI0NGQjlBQlwiLFxyXG4gICAgXCIjOUY5Q0IwXCIsXHJcbiAgICBcIiNBRjlGOTlcIixcclxuICAgIFwiI0FDQzFFQ1wiLFxyXG4gICAgXCIjRDk5QkZFXCIsXHJcbiAgICBcIiNDQ0U2RUVcIixcclxuICAgIFwiI0Y0RDFFNVwiLFxyXG4gICAgXCIjRDJFNUQyXCIsXHJcbiAgICBcIiNFOUQ5RTRcIixcclxuICAgIFwiI0Q0RDlENVwiLFxyXG4gICAgXCIjRjZEMkNFXCIsXHJcbiAgICBcIiNEOUQzRjJcIixcclxuICAgIFwiI0U3RENENVwiLFxyXG4gICAgXCIjQ0ZDREQ3XCIsXHJcbiAgICBcIiNEN0NGQ0NcIixcclxuICAgIFwiI0Q1RTBGNlwiLFxyXG4gICAgXCIjRUNDREZFXCIsXHJcbl07XHJcblxyXG5mdW5jdGlvbiBzcGFya2JhcihtYXgpIHtcclxuICAgIHJldHVybiAoeCkgPT4gaHRsLmh0bWxgPGRpdiBzdHlsZT1cIlxyXG4gICAgICAgICAgYmFja2dyb3VuZDogIzY2QjNDRDtcclxuICAgICAgICAgIHdpZHRoOiAkeygxMDAgKiB4KSAvIG1heH0lO1xyXG4gICAgICAgICAgZmxvYXQ6IHJpZ2h0O1xyXG4gICAgICAgICAgcGFkZGluZy1yaWdodDogM3B4O1xyXG4gICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuICAgICAgICAgIG92ZXJmbG93OiB2aXNpYmxlO1xyXG4gICAgICAgICAgZGlzcGxheTogZmxleDtcclxuICAgICAgICAgIGp1c3RpZnktY29udGVudDogZW5kO1wiPiR7eC50b0xvY2FsZVN0cmluZyhcImVuLUdCXCIpfWA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNwYXJrYmFyUGVyY2VudChtYXgpIHtcclxuICAgIHJldHVybiAoeCkgPT4gaHRsLmh0bWxgPGRpdiBzdHlsZT1cIlxyXG4gICAgICAgICAgYmFja2dyb3VuZDogIzY2QjNDRDtcclxuICAgICAgICAgIHdpZHRoOiAkeygxMDAgKiBNYXRoLmFicyh4KSkgLyBtYXh9JTtcclxuICAgICAgICAgIGZsb2F0OiByaWdodDtcclxuICAgICAgICAgIHBhZGRpbmctcmlnaHQ6IDNweDtcclxuICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XHJcbiAgICAgICAgICBvdmVyZmxvdzogdmlzaWJsZTtcclxuICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGVuZDtcIj4ke3gudG9Mb2NhbGVTdHJpbmcoXCJlbi1HQlwiLCB7XHJcbiAgICAgICAgICAgICAgc3R5bGU6IFwicGVyY2VudFwiLFxyXG4gICAgICAgICAgICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMSxcclxuICAgICAgICAgICAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDFcclxuICAgICAgICAgIH0pfWA7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWF0Y2hEYXRhU2l4TmF0aW9ucyA9IChhd2FpdCBGaWxlQXR0YWNobWVudChcInJ1Z2J5LmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KSlcclxuICAgIC5maWx0ZXIoZCA9PiBkLmNvbXBldGl0aW9uX25hbWUuaW5jbHVkZXMoXCJTaXggTmF0aW9uc1wiKSlcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgaG9tZV9zY29yZTogK2QuaG9tZV9zY29yZSxcclxuICAgICAgICBhd2F5X3Njb3JlOiArZC5hd2F5X3Njb3JlLFxyXG4gICAgICAgIG1hdGNoX2RhdGU6IG5ldyBEYXRlKGQubWF0Y2hfZGF0ZSksXHJcbiAgICAgICAgd2lubmVyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmhvbWVfdGVhbSA6IGQuYXdheV90ZWFtLFxyXG4gICAgICAgIGxvc2VyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmF3YXlfdGVhbSA6IGQuaG9tZV90ZWFtXHJcbiAgICB9KSk7XHJcblxyXG50ZWFtU3RhdHNTaXhOYXRpb25zID0ge1xyXG4gICAgY29uc3Qgc3RhdHMgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKGNvbnN0IGQgb2YgbWF0Y2hEYXRhU2l4TmF0aW9ucykge1xyXG4gICAgICAgIGZvciAoY29uc3QgdGVhbSBvZiBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXSkge1xyXG4gICAgICAgICAgICBpZiAoIXN0YXRzLmhhcyh0ZWFtKSkgc3RhdHMuc2V0KHRlYW0sIHsgdGVhbSwgZ2FtZXM6IDAsIHdpbnM6IDAgfSk7XHJcbiAgICAgICAgICAgIHN0YXRzLmdldCh0ZWFtKS5nYW1lcysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0cy5nZXQoZC53aW5uZXIpLndpbnMrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRzLnZhbHVlcygpKVxyXG4gICAgICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgICAgICAuLi5kLFxyXG4gICAgICAgICAgICB3aW5fcmF0ZTogZC53aW5zIC8gZC5nYW1lc1xyXG4gICAgICAgIH0pKVxyXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLndpbnMgLSBhLndpbnMgfHwgYi5nYW1lcyAtIGEuZ2FtZXMgfHwgYi53aW5fcmF0ZSAtIGEud2luX3JhdGUpO1xyXG59O1xyXG5cclxuZWRnZXNTaXhOYXRpb25zID0ge1xyXG4gICAgY29uc3QgZWRnZU1hcCA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiBtYXRjaERhdGFTaXhOYXRpb25zKSB7XHJcbiAgICAgICAgY29uc3QgW3RlYW0xLCB0ZWFtMl0gPSBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXS5zb3J0KCk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYCR7dGVhbTF9fCR7dGVhbTJ9YDtcclxuICAgICAgICBpZiAoIWVkZ2VNYXAuaGFzKGtleSkpXHJcbiAgICAgICAgICAgIGVkZ2VNYXAuc2V0KGtleSwge1xyXG4gICAgICAgICAgICAgICAgdGVhbTEsXHJcbiAgICAgICAgICAgICAgICB0ZWFtMixcclxuICAgICAgICAgICAgICAgIHdpbnNfdGVhbTE6IDAsXHJcbiAgICAgICAgICAgICAgICB3aW5zX3RlYW0yOiAwLFxyXG4gICAgICAgICAgICAgICAgdG90YWw6IDBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgZWRnZSA9IGVkZ2VNYXAuZ2V0KGtleSk7XHJcbiAgICAgICAgZWRnZS50b3RhbCsrO1xyXG4gICAgICAgIGlmIChkLndpbm5lciA9PT0gdGVhbTEpIGVkZ2Uud2luc190ZWFtMSsrO1xyXG4gICAgICAgIGVsc2UgZWRnZS53aW5zX3RlYW0yKys7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlZGdlTWFwLnZhbHVlcygpKS5tYXAoXHJcbiAgICAgICAgKHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xLCB3aW5zX3RlYW0yLCB0b3RhbCB9KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRvbWluYW50ID0gd2luc190ZWFtMSA+PSB3aW5zX3RlYW0yID8gdGVhbTEgOiB0ZWFtMjtcclxuICAgICAgICAgICAgY29uc3Qgd2Vha2VyID0gd2luc190ZWFtMSA8IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgc291cmNlOiBkb21pbmFudCxcclxuICAgICAgICAgICAgICAgIHRhcmdldDogd2Vha2VyLFxyXG4gICAgICAgICAgICAgICAgd2VpZ2h0OiBNYXRoLm1heCh3aW5zX3RlYW0xLCB3aW5zX3RlYW0yKSAvIHRvdGFsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgKTtcclxufTtcclxuXHJcbm5vZGVzU2l4TmF0aW9ucyA9IHRlYW1TdGF0c1NpeE5hdGlvbnNcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIGlkOiBkLnRlYW0sXHJcbiAgICAgICAgZ3JvdXA6IGQud2lucyxcclxuICAgICAgICB3aW5zOiBkLndpbnMsXHJcbiAgICAgICAgZ2FtZXM6IGQuZ2FtZXMsXHJcbiAgICAgICAgd2luX3JhdGU6IGQud2luX3JhdGUsXHJcbiAgICAgICAgdGl0bGU6IGAke2QudGVhbX1cXG5XaW5zOiAke2Qud2luc31cXG5HYW1lczogJHtkLmdhbWVzfVxcbldpbiBSYXRlOiAkeyhkLndpbl9yYXRlICogMTAwKS50b0ZpeGVkKDEpfSVgXHJcbiAgICB9KSlcclxuICAgIC5zb3J0KChhLCBiKSA9PlxyXG4gICAgICAgIGIud2lucyAtIGEud2lucyB8fFxyXG4gICAgICAgIGIuZ2FtZXMgLSBhLmdhbWVzIHx8XHJcbiAgICAgICAgYi53aW5fcmF0ZSAtIGEud2luX3JhdGVcclxuICAgICk7XHJcblxyXG5jaXJjdWxhck5vZGVzU2l4TmF0aW9ucyA9IHtcclxuICAgIGNvbnN0IHJhZGl1cyA9IDI1MDtcclxuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJZID0gMzAwO1xyXG4gICAgY29uc3QgYW5nbGVTdGVwID0gKDIgKiBNYXRoLlBJKSAvIG5vZGVzU2l4TmF0aW9ucy5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIG5vZGVzU2l4TmF0aW9ucy5tYXAoKG5vZGUsIGkpID0+ICh7XHJcbiAgICAgICAgLi4ubm9kZSxcclxuICAgICAgICBmeDogY2VudGVyWCArIHJhZGl1cyAqIE1hdGguY29zKGkgKiBhbmdsZVN0ZXApLFxyXG4gICAgICAgIGZ5OiBjZW50ZXJZICsgcmFkaXVzICogTWF0aC5zaW4oaSAqIGFuZ2xlU3RlcClcclxuICAgIH0pKTtcclxufTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLnRhYmxlKG5vZGVzU2l4TmF0aW9ucywge1xyXG4gICAgY29sdW1uczogW1xyXG4gICAgICAgIFwiaWRcIixcclxuICAgICAgICBcImdhbWVzXCIsXHJcbiAgICAgICAgXCJ3aW5zXCIsXHJcbiAgICAgICAgXCJ3aW5fcmF0ZVwiXHJcbiAgICBdLFxyXG4gICAgaGVhZGVyOiB7XHJcbiAgICAgICAgaWQ6IFwiQ291bnRyeVwiLFxyXG4gICAgICAgIGdhbWVzOiBcIk51bWJlciBvZiBNYXRjaGVzIFBsYXllZFwiLFxyXG4gICAgICAgIHdpbnM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgV29uXCIsXHJcbiAgICAgICAgd2luX3JhdGU6IFwiV2luIFJhdGVcIlxyXG4gICAgfSxcclxuICAgIGZvcm1hdDoge1xyXG4gICAgICAgIGdhbWVzOiBzcGFya2JhcihkMy5tYXgobm9kZXNSdWdieUNoYW1waW9uc2hpcCwgKGQpID0+IGRbXCJnYW1lc1wiXSkpLFxyXG4gICAgICAgIHdpbnM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5Q2hhbXBpb25zaGlwLCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieUNoYW1waW9uc2hpcCwgKGQpID0+IGRbXCJ3aW5fcmF0ZVwiXSlcclxuICAgICAgICApLFxyXG4gICAgfSxcclxuICAgIHJvd3M6IDEwMCxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcclxuICAgIGNvbnN0IHdpZHRoID0gOTI4O1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gNjAwO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yID0gZDMuc2NhbGVPcmRpbmFsKHBlcnNvbmFsX2NvbG91cnMpO1xyXG5cclxuICAgIGNvbnN0IGxpbmtzID0gZWRnZXNTaXhOYXRpb25zLm1hcChkID0+ICh7IC4uLmQgfSkpO1xyXG4gICAgY29uc3Qgbm9kZXMgPSBjaXJjdWxhck5vZGVzU2l4TmF0aW9ucy5tYXAoZCA9PiAoeyAuLi5kIH0pKTtcclxuXHJcbiAgICBjb25zdCByYWRpdXNTY2FsZSA9IGQzLnNjYWxlU3FydCgpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgZDMubWF4KG5vZGVzLCBkID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgMTAwXSk7XHJcblxyXG4gICAgY29uc3QgbGlua0NvbG9yID0gZDMuc2NhbGVMaW5lYXIoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIDAuNSwgMV0pXHJcbiAgICAgICAgLnJhbmdlKFtcIiMyY2EwMmNcIiwgXCIjZmY3ZjBlXCIsIFwiI2Q2MjcyOFwiXSk7XHJcblxyXG4gICAgY29uc3Qgc3ZnID0gZDMuY3JlYXRlKFwic3ZnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcclxuICAgICAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXHJcbiAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0ICsgNTBdKVxyXG4gICAgICAgIC5hdHRyKFwicHJlc2VydmVBc3BlY3RSYXRpb1wiLCBcInhNaWRZTWlkIG1lZXRcIilcclxuICAgICAgICAuYXR0cihcInN0eWxlXCIsIFwid2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bztcIik7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgdW5pcXVlIGFycm93aGVhZCBtYXJrZXIgZm9yIGVhY2ggbGlua1xyXG4gICAgY29uc3QgZGVmcyA9IHN2Zy5hcHBlbmQoXCJkZWZzXCIpO1xyXG5cclxuICAgIGxpbmtzLmZvckVhY2goKGQsIGkpID0+IHtcclxuICAgICAgICBkZWZzLmFwcGVuZChcIm1hcmtlclwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImlkXCIsIGBhcnJvd2hlYWQtJHtpfWApXHJcbiAgICAgICAgICAgIC5hdHRyKFwidmlld0JveFwiLCBcIjAgLTMgNiA2XCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWFwiLCA2KVxyXG4gICAgICAgICAgICAuYXR0cihcInJlZllcIiwgMClcclxuICAgICAgICAgICAgLmF0dHIoXCJtYXJrZXJXaWR0aFwiLCAyKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlckhlaWdodFwiLCA0KVxyXG4gICAgICAgICAgICAuYXR0cihcIm9yaWVudFwiLCBcImF1dG9cIilcclxuICAgICAgICAgICAgLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIFwiTTAsLTNMNiwwTDAsM1wiKVxyXG4gICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgbGlua0NvbG9yKGQud2VpZ2h0KSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBzaW11bGF0aW9uID0gZDMuZm9yY2VTaW11bGF0aW9uKG5vZGVzKVxyXG4gICAgICAgIC5mb3JjZShcImxpbmtcIiwgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZChkID0+IGQuaWQpKVxyXG4gICAgICAgIC5mb3JjZShcImNoYXJnZVwiLCBkMy5mb3JjZU1hbnlCb2R5KCkpXHJcbiAgICAgICAgLmZvcmNlKFwiY2VudGVyXCIsIGQzLmZvcmNlQ2VudGVyKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMikpXHJcbiAgICAgICAgLm9uKFwidGlja1wiLCB0aWNrZWQpO1xyXG5cclxuICAgIGNvbnN0IGxpbmsgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcclxuICAgICAgICAuYXR0cihcInN0cm9rZS1vcGFjaXR5XCIsIDAuNilcclxuICAgICAgICAuc2VsZWN0QWxsKFwicGF0aFwiKVxyXG4gICAgICAgIC5kYXRhKGxpbmtzKVxyXG4gICAgICAgIC5qb2luKFwicGF0aFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIGQgPT4gbGlua0NvbG9yKGQud2VpZ2h0KSlcclxuICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBkID0+IDUgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmcuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCBkID0+IHJhZGl1c1NjYWxlKGQud2lucykpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGQgPT4gY29sb3IoZC5ncm91cCkpO1xyXG5cclxuICAgIC8vIFRvb2x0aXAgd2l0aCBmdWxsIHRlYW0gc3RhdHNcclxuICAgIG5vZGUuYXBwZW5kKFwidGl0bGVcIilcclxuICAgICAgICAudGV4dChkID0+IGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoZC53aW5fcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYCk7XHJcblxyXG4gICAgbm9kZS5jYWxsKGQzLmRyYWcoKVxyXG4gICAgICAgIC5vbihcInN0YXJ0XCIsIGRyYWdzdGFydGVkKVxyXG4gICAgICAgIC5vbihcImRyYWdcIiwgZHJhZ2dlZClcclxuICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKSk7XHJcblxyXG4gICAgY29uc3QgbGFiZWxzID0gc3ZnLmFwcGVuZChcImdcIilcclxuICAgICAgICAuc2VsZWN0QWxsKFwidGV4dFwiKVxyXG4gICAgICAgIC5kYXRhKG5vZGVzKVxyXG4gICAgICAgIC5qb2luKFwidGV4dFwiKVxyXG4gICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjEwcHhcIilcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgXCIjZmZmXCIpXHJcbiAgICAgICAgLnRleHQoZCA9PiBkLmlkKTtcclxuXHJcbiAgICBmdW5jdGlvbiB0aWNrZWQoKSB7XHJcbiAgICAgICAgbGluay5hdHRyKFwiZFwiLCBkID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZVxyXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIGQgPT4gZC54KVxyXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIGQgPT4gZC55KTtcclxuXHJcbiAgICAgICAgbGFiZWxzXHJcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBkID0+IGQueClcclxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGQgPT4gZC55KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnc3RhcnRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMykucmVzdGFydCgpO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC5zdWJqZWN0Lng7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IGV2ZW50LnN1YmplY3QueTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnZ2VkKGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IGV2ZW50Lng7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IGV2ZW50Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2VuZGVkKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IG51bGw7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV2hlbiB0aGlzIGNlbGwgaXMgcmUtcnVuLCBzdG9wIHRoZSBwcmV2aW91cyBzaW11bGF0aW9uLiAoVGhpcyBkb2VzbuKAmXRcclxuICAgIC8vIHJlYWxseSBtYXR0ZXIgc2luY2UgdGhlIHRhcmdldCBhbHBoYSBpcyB6ZXJvIGFuZCB0aGUgc2ltdWxhdGlvbiB3aWxsXHJcbiAgICAvLyBzdG9wIG5hdHVyYWxseSwgYnV0IGl04oCZcyBhIGdvb2QgcHJhY3RpY2UuKVxyXG4gICAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gc2ltdWxhdGlvbi5zdG9wKCkpO1xyXG5cclxuICAgIHJldHVybiBzdmcubm9kZSgpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1hdGNoRGF0YVJ1Z2J5Q2hhbXBpb25zaGlwID0gKGF3YWl0IEZpbGVBdHRhY2htZW50KFwicnVnYnkuY3N2XCIpLmNzdih7IHR5cGVkOiB0cnVlIH0pKVxyXG4gICAgLmZpbHRlcihcclxuICAgICAgICBkID0+IChcclxuICAgICAgICAgICAgZC5jb21wZXRpdGlvbl9uYW1lID09PSBcIlJ1Z2J5IENoYW1waW9uc2hpcFwiIHx8XHJcbiAgICAgICAgICAgIGQuY29tcGV0aXRpb25fbmFtZSA9PT0gXCJUaGUgUnVnYnkgQ2hhbXBpb25zaGlwXCJcclxuICAgICAgICApXHJcbiAgICApXHJcbiAgICAubWFwKFxyXG4gICAgICAgIGQgPT4gKFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAuLi5kLFxyXG4gICAgICAgICAgICAgICAgaG9tZV9zY29yZTogK2QuaG9tZV9zY29yZSxcclxuICAgICAgICAgICAgICAgIGF3YXlfc2NvcmU6ICtkLmF3YXlfc2NvcmUsXHJcbiAgICAgICAgICAgICAgICBtYXRjaF9kYXRlOiBuZXcgRGF0ZShkLm1hdGNoX2RhdGUpLFxyXG4gICAgICAgICAgICAgICAgd2lubmVyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmhvbWVfdGVhbSA6IGQuYXdheV90ZWFtLFxyXG4gICAgICAgICAgICAgICAgbG9zZXI6IGQuaG9tZV9zY29yZSA+IGQuYXdheV9zY29yZSA/IGQuYXdheV90ZWFtIDogZC5ob21lX3RlYW1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgIClcclxuXHJcbnRlYW1TdGF0c1J1Z2J5Q2hhbXBpb25zaGlwID0ge1xyXG4gICAgY29uc3Qgc3RhdHMgPSBuZXcgTWFwKClcclxuICAgIGZvcihjb25zdCBkIG9mIG1hdGNoRGF0YVJ1Z2J5Q2hhbXBpb25zaGlwKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCB0ZWFtIG9mIFtkLmhvbWVfdGVhbSwgZC5hd2F5X3RlYW1dKSB7XHJcbiAgICAgICAgICAgIGlmICghc3RhdHMuaGFzKHRlYW0pKSBzdGF0cy5zZXQodGVhbSwgeyB0ZWFtLCBnYW1lczogMCwgd2luczogMCB9KVxyXG4gICAgICAgICAgICBzdGF0cy5nZXQodGVhbSkuZ2FtZXMrK1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0cy5nZXQoZC53aW5uZXIpLndpbnMrK1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oc3RhdHMudmFsdWVzKCkpLm1hcChkID0+ICh7XHJcbiAgICAgICAgLi4uZCxcclxuICAgICAgICB3aW5fcmF0ZTogZC53aW5zIC8gZC5nYW1lc1xyXG4gICAgfSkpLnNvcnQoKGEsIGIpID0+IGIud2lucyAtIGEud2lucyB8fCBiLmdhbWVzIC0gYS5nYW1lcyB8fCBiLndpbl9yYXRlIC0gYS53aW5fcmF0ZSlcclxufVxyXG5cclxuZWRnZXNSdWdieUNoYW1waW9uc2hpcCA9IHtcclxuICAgIGNvbnN0IGVkZ2VNYXAgPSBuZXcgTWFwKClcclxuICAgIGZvcihjb25zdCBkIG9mIG1hdGNoRGF0YVJ1Z2J5Q2hhbXBpb25zaGlwKSB7XHJcbiAgICAgICAgY29uc3QgW3RlYW0xLCB0ZWFtMl0gPSBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXS5zb3J0KClcclxuICAgICAgICBjb25zdCBrZXkgPSBgJHt0ZWFtMX18JHt0ZWFtMn1gXHJcbiAgICAgICAgaWYgKCFlZGdlTWFwLmhhcyhrZXkpKSBlZGdlTWFwLnNldChrZXksIHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xOiAwLCB3aW5zX3RlYW0yOiAwLCB0b3RhbDogMCB9KVxyXG4gICAgICAgIGNvbnN0IGVkZ2UgPSBlZGdlTWFwLmdldChrZXkpXHJcbiAgICAgICAgZWRnZS50b3RhbCsrXHJcbiAgICAgICAgaWYgKGQud2lubmVyID09PSB0ZWFtMSkgZWRnZS53aW5zX3RlYW0xKytcclxuICAgICAgICBlbHNlIGVkZ2Uud2luc190ZWFtMisrXHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlZGdlTWFwLnZhbHVlcygpKS5tYXAoKHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xLCB3aW5zX3RlYW0yLCB0b3RhbCB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZG9taW5hbnQgPSB3aW5zX3RlYW0xID49IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yXHJcbiAgICAgICAgY29uc3Qgd2Vha2VyID0gd2luc190ZWFtMSA8IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc291cmNlOiBkb21pbmFudCxcclxuICAgICAgICAgICAgdGFyZ2V0OiB3ZWFrZXIsXHJcbiAgICAgICAgICAgIHdlaWdodDogTWF0aC5tYXgod2luc190ZWFtMSwgd2luc190ZWFtMikgLyB0b3RhbFxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn1cclxuXHJcbm5vZGVzUnVnYnlDaGFtcGlvbnNoaXAgPSB0ZWFtU3RhdHNSdWdieUNoYW1waW9uc2hpcFxyXG4gICAgLm1hcChkID0+ICh7XHJcbiAgICAgICAgaWQ6IGQudGVhbSxcclxuICAgICAgICBncm91cDogZC53aW5zLFxyXG4gICAgICAgIHdpbnM6IGQud2lucyxcclxuICAgICAgICBnYW1lczogZC5nYW1lcyxcclxuICAgICAgICB3aW5fcmF0ZTogZC53aW5fcmF0ZSxcclxuICAgICAgICB0aXRsZTogYCR7ZC50ZWFtfVxcbldpbnM6ICR7ZC53aW5zfVxcbkdhbWVzOiAke2QuZ2FtZXN9XFxuV2luIFJhdGU6ICR7KGQud2luX3JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWBcclxuICAgIH0pKVxyXG4gICAgLnNvcnQoKGEsIGIpID0+XHJcbiAgICAgICAgYi53aW5zIC0gYS53aW5zIHx8XHJcbiAgICAgICAgYi5nYW1lcyAtIGEuZ2FtZXMgfHxcclxuICAgICAgICBiLndpbl9yYXRlIC0gYS53aW5fcmF0ZVxyXG4gICAgKTtcclxuXHJcbmNpcmN1bGFyTm9kZXNSdWdieUNoYW1waW9uc2hpcCA9IHtcclxuICAgIGNvbnN0IHJhZGl1cyA9IDI1MDtcclxuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJZID0gMzAwO1xyXG4gICAgY29uc3QgYW5nbGVTdGVwID0gKDIgKiBNYXRoLlBJKSAvIG5vZGVzUnVnYnlDaGFtcGlvbnNoaXAubGVuZ3RoO1xyXG5cclxuICAgIHJldHVybiBub2Rlc1J1Z2J5Q2hhbXBpb25zaGlwLm1hcCgobm9kZSwgaSkgPT4gKHtcclxuICAgICAgICAuLi5ub2RlLFxyXG4gICAgICAgIGZ4OiBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoaSAqIGFuZ2xlU3RlcCksXHJcbiAgICAgICAgZnk6IGNlbnRlclkgKyByYWRpdXMgKiBNYXRoLnNpbihpICogYW5nbGVTdGVwKVxyXG4gICAgfSkpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IklucHV0cy50YWJsZShub2Rlc1J1Z2J5Q2hhbXBpb25zaGlwLCB7XHJcbiAgICBjb2x1bW5zOiBbXHJcbiAgICAgICAgXCJpZFwiLFxyXG4gICAgICAgIFwiZ2FtZXNcIixcclxuICAgICAgICBcIndpbnNcIixcclxuICAgICAgICBcIndpbl9yYXRlXCJcclxuICAgIF0sXHJcbiAgICBoZWFkZXI6IHtcclxuICAgICAgICBpZDogXCJDb3VudHJ5XCIsXHJcbiAgICAgICAgZ2FtZXM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgUGxheWVkXCIsXHJcbiAgICAgICAgd2luczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBXb25cIixcclxuICAgICAgICB3aW5fcmF0ZTogXCJXaW4gUmF0ZVwiXHJcbiAgICB9LFxyXG4gICAgZm9ybWF0OiB7XHJcbiAgICAgICAgZ2FtZXM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5Q2hhbXBpb25zaGlwLCAoZCkgPT4gZFtcImdhbWVzXCJdKSksXHJcbiAgICAgICAgd2luczogc3BhcmtiYXIoZDMubWF4KG5vZGVzUnVnYnlDaGFtcGlvbnNoaXAsIChkKSA9PiBkW1wid2luc1wiXSkpLFxyXG4gICAgICAgIHdpbl9yYXRlOiBzcGFya2JhclBlcmNlbnQoXHJcbiAgICAgICAgICAgIGQzLm1heChub2Rlc1J1Z2J5Q2hhbXBpb25zaGlwLCAoZCkgPT4gZFtcIndpbl9yYXRlXCJdKVxyXG4gICAgICAgICksXHJcbiAgICB9LFxyXG4gICAgcm93czogMTAwLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xyXG4gICAgY29uc3Qgd2lkdGggPSA5Mjg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSA2MDA7XHJcblxyXG4gICAgY29uc3QgY29sb3IgPSBkMy5zY2FsZU9yZGluYWwocGVyc29uYWxfY29sb3Vycyk7XHJcblxyXG4gICAgY29uc3QgbGlua3MgPSBlZGdlc1J1Z2J5Q2hhbXBpb25zaGlwLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcbiAgICBjb25zdCBub2RlcyA9IGNpcmN1bGFyTm9kZXNSdWdieUNoYW1waW9uc2hpcC5tYXAoKGQpID0+ICh7IC4uLmQgfSkpO1xyXG5cclxuICAgIGNvbnN0IHJhZGl1c1NjYWxlID0gZDNcclxuICAgICAgICAuc2NhbGVTcXJ0KClcclxuICAgICAgICAuZG9tYWluKFswLCBkMy5tYXgobm9kZXMsIChkKSA9PiBkLndpbnMpXSlcclxuICAgICAgICAucmFuZ2UoWzUsIDEwMF0pO1xyXG5cclxuICAgIGNvbnN0IGxpbmtDb2xvciA9IGQzXHJcbiAgICAgICAgLnNjYWxlTGluZWFyKClcclxuICAgICAgICAuZG9tYWluKFswLCAwLjUsIDFdKVxyXG4gICAgICAgIC5yYW5nZShbXCIjMmNhMDJjXCIsIFwiI2ZmN2YwZVwiLCBcIiNkNjI3MjhcIl0pO1xyXG5cclxuICAgIGNvbnN0IHN2ZyA9IGQzXHJcbiAgICAgICAgLmNyZWF0ZShcInN2Z1wiKVxyXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXHJcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KVxyXG4gICAgICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgd2lkdGgsIGhlaWdodCArIDUwXSlcclxuICAgICAgICAuYXR0cihcInByZXNlcnZlQXNwZWN0UmF0aW9cIiwgXCJ4TWlkWU1pZCBtZWV0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHlsZVwiLCBcIndpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87XCIpO1xyXG5cclxuICAgIC8vIENyZWF0ZSBhIHVuaXF1ZSBhcnJvd2hlYWQgbWFya2VyIGZvciBlYWNoIGxpbmtcclxuICAgIGNvbnN0IGRlZnMgPSBzdmcuYXBwZW5kKFwiZGVmc1wiKTtcclxuXHJcbiAgICBsaW5rcy5mb3JFYWNoKChkLCBpKSA9PiB7XHJcbiAgICAgICAgZGVmcy5hcHBlbmQoXCJtYXJrZXJcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJpZFwiLCBgYXJyb3doZWFkLSR7aX1gKVxyXG4gICAgICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgXCIwIC0zIDYgNlwiKVxyXG4gICAgICAgICAgICAuYXR0cihcInJlZlhcIiwgNilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZZXCIsIDApXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VyV2lkdGhcIiwgMilcclxuICAgICAgICAgICAgLmF0dHIoXCJtYXJrZXJIZWlnaHRcIiwgNClcclxuICAgICAgICAgICAgLmF0dHIoXCJvcmllbnRcIiwgXCJhdXRvXCIpXHJcbiAgICAgICAgICAgIC5hcHBlbmQoXCJwYXRoXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZFwiLCBcIk0wLC0zTDYsMEwwLDNcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIGxpbmtDb2xvcihkLndlaWdodCkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3Qgc2ltdWxhdGlvbiA9IGQzXHJcbiAgICAgICAgLmZvcmNlU2ltdWxhdGlvbihub2RlcylcclxuICAgICAgICAuZm9yY2UoXHJcbiAgICAgICAgICAgIFwibGlua1wiLFxyXG4gICAgICAgICAgICBkMy5mb3JjZUxpbmsobGlua3MpLmlkKChkKSA9PiBkLmlkKVxyXG4gICAgICAgIClcclxuICAgICAgICAuZm9yY2UoXCJjaGFyZ2VcIiwgZDMuZm9yY2VNYW55Qm9keSgpKVxyXG4gICAgICAgIC5mb3JjZShcImNlbnRlclwiLCBkMy5mb3JjZUNlbnRlcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpKVxyXG4gICAgICAgIC5vbihcInRpY2tcIiwgdGlja2VkKTtcclxuXHJcbiAgICBjb25zdCBsaW5rID0gc3ZnXHJcbiAgICAgICAgLmFwcGVuZChcImdcIilcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utb3BhY2l0eVwiLCAwLjYpXHJcbiAgICAgICAgLnNlbGVjdEFsbChcInBhdGhcIilcclxuICAgICAgICAuZGF0YShsaW5rcylcclxuICAgICAgICAuam9pbihcInBhdGhcIilcclxuICAgICAgICAuYXR0cihcInN0cm9rZVwiLCAoZCkgPT4gbGlua0NvbG9yKGQud2VpZ2h0KSlcclxuICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAoZCkgPT4gNSAqIGQud2VpZ2h0KVxyXG4gICAgICAgIC5hdHRyKFwibWFya2VyLWVuZFwiLCAoZCwgaSkgPT4gYHVybCgjYXJyb3doZWFkLSR7aX0pYCk7XHJcblxyXG4gICAgY29uc3Qgbm9kZSA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLnNlbGVjdEFsbChcImNpcmNsZVwiKVxyXG4gICAgICAgIC5kYXRhKG5vZGVzKVxyXG4gICAgICAgIC5qb2luKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgLmF0dHIoXCJyXCIsIChkKSA9PiByYWRpdXNTY2FsZShkLndpbnMpKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCAoZCkgPT4gY29sb3IoZC5ncm91cCkpO1xyXG5cclxuICAgIC8vIFRvb2x0aXAgd2l0aCBmdWxsIHRlYW0gc3RhdHNcclxuICAgIG5vZGUuYXBwZW5kKFwidGl0bGVcIikudGV4dChcclxuICAgICAgICAoZCkgPT5cclxuICAgICAgICAgICAgYCR7ZC5pZH1cXG5XaW5zOiAke2Qud2luc31cXG5HYW1lczogJHtkLmdhbWVzfVxcbldpbiBSYXRlOiAkeyhcclxuICAgICAgICAgICAgICAgIGQud2luX3JhdGUgKiAxMDBcclxuICAgICAgICAgICAgKS50b0ZpeGVkKDEpfSVgXHJcbiAgICApO1xyXG5cclxuICAgIG5vZGUuY2FsbChcclxuICAgICAgICBkM1xyXG4gICAgICAgICAgICAuZHJhZygpXHJcbiAgICAgICAgICAgIC5vbihcInN0YXJ0XCIsIGRyYWdzdGFydGVkKVxyXG4gICAgICAgICAgICAub24oXCJkcmFnXCIsIGRyYWdnZWQpXHJcbiAgICAgICAgICAgIC5vbihcImVuZFwiLCBkcmFnZW5kZWQpXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGxhYmVscyA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLnNlbGVjdEFsbChcInRleHRcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcInRleHRcIilcclxuICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXHJcbiAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxMHB4XCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiI2ZmZlwiKVxyXG4gICAgICAgIC50ZXh0KChkKSA9PiBkLmlkKTtcclxuXHJcbiAgICBmdW5jdGlvbiB0aWNrZWQoKSB7XHJcbiAgICAgICAgbGluay5hdHRyKFwiZFwiLCAoZCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkeCA9IGQudGFyZ2V0LnggLSBkLnNvdXJjZS54O1xyXG4gICAgICAgICAgICBjb25zdCBkeSA9IGQudGFyZ2V0LnkgLSBkLnNvdXJjZS55O1xyXG4gICAgICAgICAgICBjb25zdCBkciA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHIgPSByYWRpdXNTY2FsZShkLnRhcmdldC53aW5zKTtcclxuICAgICAgICAgICAgY29uc3QgcmF0aW8gPSAoZHIgLSByKSAvIGRyO1xyXG4gICAgICAgICAgICBjb25zdCB0eCA9IGQuc291cmNlLnggKyBkeCAqIHJhdGlvO1xyXG4gICAgICAgICAgICBjb25zdCB0eSA9IGQuc291cmNlLnkgKyBkeSAqIHJhdGlvO1xyXG4gICAgICAgICAgICByZXR1cm4gYE0ke2Quc291cmNlLnh9LCR7ZC5zb3VyY2UueX1MJHt0eH0sJHt0eX1gO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBub2RlLmF0dHIoXCJjeFwiLCAoZCkgPT4gZC54KS5hdHRyKFwiY3lcIiwgKGQpID0+IGQueSk7XHJcblxyXG4gICAgICAgIGxhYmVscy5hdHRyKFwieFwiLCAoZCkgPT4gZC54KS5hdHRyKFwieVwiLCAoZCkgPT4gZC55KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnc3RhcnRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMykucmVzdGFydCgpO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC5zdWJqZWN0Lng7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IGV2ZW50LnN1YmplY3QueTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnZ2VkKGV2ZW50KSB7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IGV2ZW50Lng7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IGV2ZW50Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2VuZGVkKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IG51bGw7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meSA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV2hlbiB0aGlzIGNlbGwgaXMgcmUtcnVuLCBzdG9wIHRoZSBwcmV2aW91cyBzaW11bGF0aW9uLiAoVGhpcyBkb2VzbuKAmXRcclxuICAgIC8vIHJlYWxseSBtYXR0ZXIgc2luY2UgdGhlIHRhcmdldCBhbHBoYSBpcyB6ZXJvIGFuZCB0aGUgc2ltdWxhdGlvbiB3aWxsXHJcbiAgICAvLyBzdG9wIG5hdHVyYWxseSwgYnV0IGl04oCZcyBhIGdvb2QgcHJhY3RpY2UuKVxyXG4gICAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gc2ltdWxhdGlvbi5zdG9wKCkpO1xyXG5cclxuICAgIHJldHVybiBzdmcubm9kZSgpO1xyXG59XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1hdGNoRGF0YVJ1Z2J5V29ybGRDdXAgPSAoYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJydWdieS5jc3ZcIikuY3N2KHsgdHlwZWQ6IHRydWUgfSkpXHJcbiAgICAuZmlsdGVyKGQgPT4gZC5jb21wZXRpdGlvbl9uYW1lID09PSBcIlJ1Z2J5IFdvcmxkIEN1cFwiKVxyXG4gICAgLm1hcChcclxuICAgICAgICBkID0+IChcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLi4uZCxcclxuICAgICAgICAgICAgICAgIGhvbWVfc2NvcmU6ICtkLmhvbWVfc2NvcmUsXHJcbiAgICAgICAgICAgICAgICBhd2F5X3Njb3JlOiArZC5hd2F5X3Njb3JlLFxyXG4gICAgICAgICAgICAgICAgbWF0Y2hfZGF0ZTogbmV3IERhdGUoZC5tYXRjaF9kYXRlKSxcclxuICAgICAgICAgICAgICAgIHdpbm5lcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5ob21lX3RlYW0gOiBkLmF3YXlfdGVhbSxcclxuICAgICAgICAgICAgICAgIGxvc2VyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmF3YXlfdGVhbSA6IGQuaG9tZV90ZWFtXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICApXHJcblxyXG50ZWFtU3RhdHNSdWdieVdvcmxkQ3VwID0ge1xyXG4gICAgY29uc3Qgc3RhdHMgPSBuZXcgTWFwKClcclxuICAgIGZvcihjb25zdCBkIG9mIG1hdGNoRGF0YVJ1Z2J5V29ybGRDdXApIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHRlYW0gb2YgW2QuaG9tZV90ZWFtLCBkLmF3YXlfdGVhbV0pIHtcclxuICAgICAgICAgICAgaWYgKCFzdGF0cy5oYXModGVhbSkpIHN0YXRzLnNldCh0ZWFtLCB7IHRlYW0sIGdhbWVzOiAwLCB3aW5zOiAwIH0pXHJcbiAgICAgICAgICAgIHN0YXRzLmdldCh0ZWFtKS5nYW1lcysrXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXRzLmdldChkLndpbm5lcikud2lucysrXHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShzdGF0cy52YWx1ZXMoKSkubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbnMgLyBkLmdhbWVzXHJcbiAgICB9KSkuc29ydCgoYSwgYikgPT4gYi53aW5zIC0gYS53aW5zIHx8IGIuZ2FtZXMgLSBhLmdhbWVzIHx8IGIud2luX3JhdGUgLSBhLndpbl9yYXRlKVxyXG59XHJcblxyXG5lZGdlc1J1Z2J5V29ybGRDdXAgPSB7XHJcbiAgICBjb25zdCBlZGdlTWFwID0gbmV3IE1hcCgpXHJcbiAgICBmb3IoY29uc3QgZCBvZiBtYXRjaERhdGFSdWdieVdvcmxkQ3VwKSB7XHJcbiAgICAgICAgY29uc3QgW3RlYW0xLCB0ZWFtMl0gPSBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXS5zb3J0KClcclxuICAgICAgICBjb25zdCBrZXkgPSBgJHt0ZWFtMX18JHt0ZWFtMn1gXHJcbiAgICAgICAgaWYgKCFlZGdlTWFwLmhhcyhrZXkpKSBlZGdlTWFwLnNldChrZXksIHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xOiAwLCB3aW5zX3RlYW0yOiAwLCB0b3RhbDogMCB9KVxyXG4gICAgICAgIGNvbnN0IGVkZ2UgPSBlZGdlTWFwLmdldChrZXkpXHJcbiAgICAgICAgZWRnZS50b3RhbCsrXHJcbiAgICAgICAgaWYgKGQud2lubmVyID09PSB0ZWFtMSkgZWRnZS53aW5zX3RlYW0xKytcclxuICAgICAgICBlbHNlIGVkZ2Uud2luc190ZWFtMisrXHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlZGdlTWFwLnZhbHVlcygpKS5tYXAoKHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xLCB3aW5zX3RlYW0yLCB0b3RhbCB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZG9taW5hbnQgPSB3aW5zX3RlYW0xID49IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yXHJcbiAgICAgICAgY29uc3Qgd2Vha2VyID0gd2luc190ZWFtMSA8IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc291cmNlOiBkb21pbmFudCxcclxuICAgICAgICAgICAgdGFyZ2V0OiB3ZWFrZXIsXHJcbiAgICAgICAgICAgIHdlaWdodDogTWF0aC5tYXgod2luc190ZWFtMSwgd2luc190ZWFtMikgLyB0b3RhbFxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn1cclxuXHJcbm5vZGVzUnVnYnlXb3JsZEN1cCA9IHRlYW1TdGF0c1J1Z2J5V29ybGRDdXBcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIGlkOiBkLnRlYW0sXHJcbiAgICAgICAgZ3JvdXA6IGQud2lucyxcclxuICAgICAgICB3aW5zOiBkLndpbnMsXHJcbiAgICAgICAgZ2FtZXM6IGQuZ2FtZXMsXHJcbiAgICAgICAgd2luX3JhdGU6IGQud2luX3JhdGUsXHJcbiAgICAgICAgdGl0bGU6IGAke2QudGVhbX1cXG5XaW5zOiAke2Qud2luc31cXG5HYW1lczogJHtkLmdhbWVzfVxcbldpbiBSYXRlOiAkeyhkLndpbl9yYXRlICogMTAwKS50b0ZpeGVkKDEpfSVgXHJcbiAgICB9KSlcclxuICAgIC5zb3J0KChhLCBiKSA9PlxyXG4gICAgICAgIGIud2lucyAtIGEud2lucyB8fFxyXG4gICAgICAgIGIuZ2FtZXMgLSBhLmdhbWVzIHx8XHJcbiAgICAgICAgYi53aW5fcmF0ZSAtIGEud2luX3JhdGVcclxuICAgICk7XHJcblxyXG5jaXJjdWxhck5vZGVzUnVnYnlXb3JsZEN1cCA9IHtcclxuICAgIGNvbnN0IHJhZGl1cyA9IDI1MDtcclxuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJZID0gMzAwO1xyXG4gICAgY29uc3QgYW5nbGVTdGVwID0gKDIgKiBNYXRoLlBJKSAvIG5vZGVzUnVnYnlXb3JsZEN1cC5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIG5vZGVzUnVnYnlXb3JsZEN1cC5tYXAoKG5vZGUsIGkpID0+ICh7XHJcbiAgICAgICAgLi4ubm9kZSxcclxuICAgICAgICBmeDogY2VudGVyWCArIHJhZGl1cyAqIE1hdGguY29zKGkgKiBhbmdsZVN0ZXApLFxyXG4gICAgICAgIGZ5OiBjZW50ZXJZICsgcmFkaXVzICogTWF0aC5zaW4oaSAqIGFuZ2xlU3RlcClcclxuICAgIH0pKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMudGFibGUobm9kZXNSdWdieVdvcmxkQ3VwLCB7XHJcbiAgICBjb2x1bW5zOiBbXHJcbiAgICAgICAgXCJpZFwiLFxyXG4gICAgICAgIFwiZ2FtZXNcIixcclxuICAgICAgICBcIndpbnNcIixcclxuICAgICAgICBcIndpbl9yYXRlXCJcclxuICAgIF0sXHJcbiAgICBoZWFkZXI6IHtcclxuICAgICAgICBpZDogXCJDb3VudHJ5XCIsXHJcbiAgICAgICAgZ2FtZXM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgUGxheWVkXCIsXHJcbiAgICAgICAgd2luczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBXb25cIixcclxuICAgICAgICB3aW5fcmF0ZTogXCJXaW4gUmF0ZVwiXHJcbiAgICB9LFxyXG4gICAgZm9ybWF0OiB7XHJcbiAgICAgICAgZ2FtZXM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5V29ybGRDdXAsIChkKSA9PiBkW1wiZ2FtZXNcIl0pKSxcclxuICAgICAgICB3aW5zOiBzcGFya2JhcihkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwLCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwLCAoZCkgPT4gZFtcIndpbl9yYXRlXCJdKVxyXG4gICAgICAgICksXHJcbiAgICB9LFxyXG4gICAgcm93czogMTAwLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcclxuICAgIGNvbnN0IHdpZHRoID0gOTI4O1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gNjAwO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yID0gZDMuc2NhbGVPcmRpbmFsKHBlcnNvbmFsX2NvbG91cnMpO1xyXG5cclxuICAgIGNvbnN0IGxpbmtzID0gZWRnZXNSdWdieVdvcmxkQ3VwLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcbiAgICBjb25zdCBub2RlcyA9IGNpcmN1bGFyTm9kZXNSdWdieVdvcmxkQ3VwLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzU2NhbGUgPSBkM1xyXG4gICAgICAgIC5zY2FsZVNxcnQoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIGQzLm1heChub2RlcywgKGQpID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgMjVdKTtcclxuXHJcbiAgICBjb25zdCBsaW5rQ29sb3IgPSBkM1xyXG4gICAgICAgIC5zY2FsZUxpbmVhcigpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSlcclxuICAgICAgICAucmFuZ2UoW1wiIzJjYTAyY1wiLCBcIiNmZjdmMGVcIiwgXCIjZDYyNzI4XCJdKTtcclxuXHJcbiAgICBjb25zdCBzdmcgPSBkM1xyXG4gICAgICAgIC5jcmVhdGUoXCJzdmdcIilcclxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHQgKyA1MF0pXHJcbiAgICAgICAgLmF0dHIoXCJwcmVzZXJ2ZUFzcGVjdFJhdGlvXCIsIFwieE1pZFlNaWQgbWVldFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvO1wiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgYXJyb3doZWFkIG1hcmtlciBmb3IgZWFjaCBsaW5rXHJcbiAgICBjb25zdCBkZWZzID0gc3ZnLmFwcGVuZChcImRlZnNcIik7XHJcblxyXG4gICAgbGlua3MuZm9yRWFjaCgoZCwgaSkgPT4ge1xyXG4gICAgICAgIGRlZnMuYXBwZW5kKFwibWFya2VyXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYGFycm93aGVhZC0ke2l9YClcclxuICAgICAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAtMyA2IDZcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZYXCIsIDYpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWVwiLCAwKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDQpXHJcbiAgICAgICAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxyXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgXCJNMCwtM0w2LDBMMCwzXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBsaW5rQ29sb3IoZC53ZWlnaHQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkM1xyXG4gICAgICAgIC5mb3JjZVNpbXVsYXRpb24obm9kZXMpXHJcbiAgICAgICAgLmZvcmNlKFxyXG4gICAgICAgICAgICBcImxpbmtcIixcclxuICAgICAgICAgICAgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZCgoZCkgPT4gZC5pZClcclxuICAgICAgICApXHJcbiAgICAgICAgLmZvcmNlKFwiY2hhcmdlXCIsIGQzLmZvcmNlTWFueUJvZHkoKSlcclxuICAgICAgICAuZm9yY2UoXCJjZW50ZXJcIiwgZDMuZm9yY2VDZW50ZXIod2lkdGggLyAyLCBoZWlnaHQgLyAyKSlcclxuICAgICAgICAub24oXCJ0aWNrXCIsIHRpY2tlZCk7XHJcblxyXG4gICAgY29uc3QgbGluayA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC42KVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgLmRhdGEobGlua3MpXHJcbiAgICAgICAgLmpvaW4oXCJwYXRoXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IGxpbmtDb2xvcihkLndlaWdodCkpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGQpID0+IDIgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCAoZCkgPT4gcmFkaXVzU2NhbGUoZC53aW5zKSlcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IGNvbG9yKGQuZ3JvdXApKTtcclxuXHJcbiAgICAvLyBUb29sdGlwIHdpdGggZnVsbCB0ZWFtIHN0YXRzXHJcbiAgICBub2RlLmFwcGVuZChcInRpdGxlXCIpLnRleHQoXHJcbiAgICAgICAgKGQpID0+XHJcbiAgICAgICAgICAgIGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoXHJcbiAgICAgICAgICAgICAgICBkLndpbl9yYXRlICogMTAwXHJcbiAgICAgICAgICAgICkudG9GaXhlZCgxKX0lYFxyXG4gICAgKTtcclxuXHJcbiAgICBub2RlLmNhbGwoXHJcbiAgICAgICAgZDNcclxuICAgICAgICAgICAgLmRyYWcoKVxyXG4gICAgICAgICAgICAub24oXCJzdGFydFwiLCBkcmFnc3RhcnRlZClcclxuICAgICAgICAgICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxyXG4gICAgICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbHMgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiMzMzNcIilcclxuICAgICAgICAudGV4dCgoZCkgPT4gZC5pZCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdGlja2VkKCkge1xyXG4gICAgICAgIGxpbmsuYXR0cihcImRcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZS5hdHRyKFwiY3hcIiwgKGQpID0+IGQueCkuYXR0cihcImN5XCIsIChkKSA9PiBkLnkpO1xyXG5cclxuICAgICAgICBsYWJlbHMuYXR0cihcInhcIiwgKGQpID0+IGQueCkuYXR0cihcInlcIiwgKGQpID0+IGQueSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwLjMpLnJlc3RhcnQoKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQuc3ViamVjdC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBudWxsO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBjZWxsIGlzIHJlLXJ1biwgc3RvcCB0aGUgcHJldmlvdXMgc2ltdWxhdGlvbi4gKFRoaXMgZG9lc27igJl0XHJcbiAgICAvLyByZWFsbHkgbWF0dGVyIHNpbmNlIHRoZSB0YXJnZXQgYWxwaGEgaXMgemVybyBhbmQgdGhlIHNpbXVsYXRpb24gd2lsbFxyXG4gICAgLy8gc3RvcCBuYXR1cmFsbHksIGJ1dCBpdOKAmXMgYSBnb29kIHByYWN0aWNlLilcclxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHNpbXVsYXRpb24uc3RvcCgpKTtcclxuXHJcbiAgICByZXR1cm4gc3ZnLm5vZGUoKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWF0Y2hlc0J5WWVhckdyb3VwID0gKGF3YWl0IEZpbGVBdHRhY2htZW50KFwicnVnYnkuY3N2XCIpLmNzdih7IHR5cGVkOiB0cnVlIH0pKVxyXG4gICAgLmZpbHRlcihkID0+IGQuY29tcGV0aXRpb25fbmFtZSA9PT0gXCJSdWdieSBXb3JsZCBDdXBcIilcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgaG9tZV9zY29yZTogK2QuaG9tZV9zY29yZSxcclxuICAgICAgICBhd2F5X3Njb3JlOiArZC5hd2F5X3Njb3JlLFxyXG4gICAgICAgIG1hdGNoX2RhdGU6IG5ldyBEYXRlKGQubWF0Y2hfZGF0ZSksXHJcbiAgICAgICAgeWVhcjogbmV3IERhdGUoZC5tYXRjaF9kYXRlKS5nZXRGdWxsWWVhcigpXHJcbiAgICB9KSlcclxuICAgIC5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgaWYgKGEueWVhciAhPT0gYi55ZWFyKSByZXR1cm4gYS55ZWFyIC0gYi55ZWFyO1xyXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShiLm1hdGNoX2RhdGUpIC0gbmV3IERhdGUoYS5tYXRjaF9kYXRlKTtcclxuICAgIH0pXHJcbiAgICAucmVkdWNlKChhY2MsIG1hdGNoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeWVhciA9IG1hdGNoLnllYXI7XHJcbiAgICAgICAgaWYgKCFhY2NbeWVhcl0pIGFjY1t5ZWFyXSA9IFtdO1xyXG4gICAgICAgIGFjY1t5ZWFyXS5wdXNoKG1hdGNoKTtcclxuICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwge30pO1xyXG5cclxubWF0Y2hEYXRhUnVnYnlXb3JsZEN1cEdyb3VwID0gT2JqZWN0LmZyb21FbnRyaWVzKFxyXG4gICAgT2JqZWN0LmVudHJpZXMobWF0Y2hlc0J5WWVhckdyb3VwKS5tYXAoKFt5ZWFyLCBtYXRjaGVzXSkgPT4gW1xyXG4gICAgICAgIHllYXIsXHJcbiAgICAgICAgbWF0Y2hlcy5zbGljZSg4LCAyMDApXHJcbiAgICBdKVxyXG4pO1xyXG5cclxuZ3JvdXBNYXRjaGVzID0gT2JqZWN0LnZhbHVlcyhtYXRjaERhdGFSdWdieVdvcmxkQ3VwR3JvdXApXHJcbiAgICAuZmxhdCgpXHJcbiAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5tYXRjaF9kYXRlKSAtIG5ldyBEYXRlKGIubWF0Y2hfZGF0ZSkpXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIHdpbm5lcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5ob21lX3RlYW0gOiBkLmF3YXlfdGVhbSxcclxuICAgICAgICBsb3NlcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5hd2F5X3RlYW0gOiBkLmhvbWVfdGVhbVxyXG4gICAgfSkpO1xyXG5cclxudGVhbVN0YXRzUnVnYnlXb3JsZEN1cEdyb3VwID0ge1xyXG4gICAgY29uc3Qgc3RhdHMgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKGNvbnN0IGQgb2YgZ3JvdXBNYXRjaGVzKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCB0ZWFtIG9mIFtkLmhvbWVfdGVhbSwgZC5hd2F5X3RlYW1dKSB7XHJcbiAgICAgICAgICAgIGlmICghc3RhdHMuaGFzKHRlYW0pKSBzdGF0cy5zZXQodGVhbSwgeyB0ZWFtLCBnYW1lczogMCwgd2luczogMCB9KTtcclxuICAgICAgICAgICAgc3RhdHMuZ2V0KHRlYW0pLmdhbWVzKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN0YXRzLmdldChkLndpbm5lcikud2lucysrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oc3RhdHMudmFsdWVzKCkpLm1hcChkID0+ICh7XHJcbiAgICAgICAgLi4uZCxcclxuICAgICAgICB3aW5fcmF0ZTogZC53aW5zIC8gZC5nYW1lc1xyXG4gICAgfSkpLnNvcnQoKGEsIGIpID0+IGIud2lucyAtIGEud2lucyB8fCBiLmdhbWVzIC0gYS5nYW1lcyB8fCBiLndpbl9yYXRlIC0gYS53aW5fcmF0ZSk7XHJcbn07XHJcblxyXG5lZGdlc1J1Z2J5V29ybGRDdXBHcm91cCA9IHtcclxuICAgIGNvbnN0IGVkZ2VNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKGNvbnN0IGQgb2YgZ3JvdXBNYXRjaGVzKSB7XHJcbiAgICAgICAgY29uc3QgW3RlYW0xLCB0ZWFtMl0gPSBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXS5zb3J0KCk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYCR7dGVhbTF9fCR7dGVhbTJ9YDtcclxuICAgICAgICBpZiAoIWVkZ2VNYXAuaGFzKGtleSkpIGVkZ2VNYXAuc2V0KGtleSwgeyB0ZWFtMSwgdGVhbTIsIHdpbnNfdGVhbTE6IDAsIHdpbnNfdGVhbTI6IDAsIHRvdGFsOiAwIH0pO1xyXG4gICAgICAgIGNvbnN0IGVkZ2UgPSBlZGdlTWFwLmdldChrZXkpO1xyXG4gICAgICAgIGVkZ2UudG90YWwrKztcclxuICAgICAgICBpZiAoZC53aW5uZXIgPT09IHRlYW0xKSBlZGdlLndpbnNfdGVhbTErKztcclxuICAgICAgICBlbHNlIGVkZ2Uud2luc190ZWFtMisrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oZWRnZU1hcC52YWx1ZXMoKSkubWFwKCh7IHRlYW0xLCB0ZWFtMiwgd2luc190ZWFtMSwgd2luc190ZWFtMiwgdG90YWwgfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRvbWluYW50ID0gd2luc190ZWFtMSA+PSB3aW5zX3RlYW0yID8gdGVhbTEgOiB0ZWFtMjtcclxuICAgICAgICBjb25zdCB3ZWFrZXIgPSB3aW5zX3RlYW0xIDwgd2luc190ZWFtMiA/IHRlYW0xIDogdGVhbTI7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc291cmNlOiBkb21pbmFudCxcclxuICAgICAgICAgICAgdGFyZ2V0OiB3ZWFrZXIsXHJcbiAgICAgICAgICAgIHdlaWdodDogTWF0aC5tYXgod2luc190ZWFtMSwgd2luc190ZWFtMikgLyB0b3RhbFxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufTtcclxuXHJcbm5vZGVzUnVnYnlXb3JsZEN1cEdyb3VwID0gdGVhbVN0YXRzUnVnYnlXb3JsZEN1cEdyb3VwXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICBpZDogZC50ZWFtLFxyXG4gICAgICAgIGdyb3VwOiBkLndpbnMsXHJcbiAgICAgICAgd2luczogZC53aW5zLFxyXG4gICAgICAgIGdhbWVzOiBkLmdhbWVzLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbl9yYXRlLFxyXG4gICAgICAgIHRpdGxlOiBgJHtkLnRlYW19XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoZC53aW5fcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYFxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT5cclxuICAgICAgICBiLndpbnMgLSBhLndpbnMgfHxcclxuICAgICAgICBiLmdhbWVzIC0gYS5nYW1lcyB8fFxyXG4gICAgICAgIGIud2luX3JhdGUgLSBhLndpbl9yYXRlXHJcbiAgICApO1xyXG5cclxuY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBHcm91cCA9IHtcclxuICAgIGNvbnN0IHJhZGl1cyA9IDI1MDtcclxuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJZID0gMzAwO1xyXG4gICAgY29uc3QgYW5nbGVTdGVwID0gKDIgKiBNYXRoLlBJKSAvIG5vZGVzUnVnYnlXb3JsZEN1cEdyb3VwLmxlbmd0aDtcclxuXHJcbiAgICByZXR1cm4gbm9kZXNSdWdieVdvcmxkQ3VwR3JvdXAubWFwKChub2RlLCBpKSA9PiAoe1xyXG4gICAgICAgIC4uLm5vZGUsXHJcbiAgICAgICAgZng6IGNlbnRlclggKyByYWRpdXMgKiBNYXRoLmNvcyhpICogYW5nbGVTdGVwKSxcclxuICAgICAgICBmeTogY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGkgKiBhbmdsZVN0ZXApXHJcbiAgICB9KSk7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMudGFibGUobm9kZXNSdWdieVdvcmxkQ3VwR3JvdXAsIHtcclxuICAgIGNvbHVtbnM6IFtcclxuICAgICAgICBcImlkXCIsXHJcbiAgICAgICAgXCJnYW1lc1wiLFxyXG4gICAgICAgIFwid2luc1wiLFxyXG4gICAgICAgIFwid2luX3JhdGVcIlxyXG4gICAgXSxcclxuICAgIGhlYWRlcjoge1xyXG4gICAgICAgIGlkOiBcIkNvdW50cnlcIixcclxuICAgICAgICBnYW1lczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBQbGF5ZWRcIixcclxuICAgICAgICB3aW5zOiBcIk51bWJlciBvZiBNYXRjaGVzIFdvblwiLFxyXG4gICAgICAgIHdpbl9yYXRlOiBcIldpbiBSYXRlXCJcclxuICAgIH0sXHJcbiAgICBmb3JtYXQ6IHtcclxuICAgICAgICBnYW1lczogc3BhcmtiYXIoZDMubWF4KG5vZGVzUnVnYnlXb3JsZEN1cEdyb3VwLCAoZCkgPT4gZFtcImdhbWVzXCJdKSksXHJcbiAgICAgICAgd2luczogc3BhcmtiYXIoZDMubWF4KG5vZGVzUnVnYnlXb3JsZEN1cEdyb3VwLCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwR3JvdXAsIChkKSA9PiBkW1wid2luX3JhdGVcIl0pXHJcbiAgICAgICAgKSxcclxuICAgIH0sXHJcbiAgICByb3dzOiAxMDAsXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xyXG4gICAgY29uc3Qgd2lkdGggPSA5Mjg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSA2MDA7XHJcblxyXG4gICAgY29uc3QgY29sb3IgPSBkMy5zY2FsZU9yZGluYWwocGVyc29uYWxfY29sb3Vycyk7XHJcblxyXG4gICAgY29uc3QgbGlua3MgPSBlZGdlc1J1Z2J5V29ybGRDdXBHcm91cC5tYXAoKGQpID0+ICh7IC4uLmQgfSkpO1xyXG4gICAgY29uc3Qgbm9kZXMgPSBjaXJjdWxhck5vZGVzUnVnYnlXb3JsZEN1cEdyb3VwLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzU2NhbGUgPSBkM1xyXG4gICAgICAgIC5zY2FsZVNxcnQoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIGQzLm1heChub2RlcywgKGQpID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgMjVdKTtcclxuXHJcbiAgICBjb25zdCBsaW5rQ29sb3IgPSBkM1xyXG4gICAgICAgIC5zY2FsZUxpbmVhcigpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSlcclxuICAgICAgICAucmFuZ2UoW1wiIzJjYTAyY1wiLCBcIiNmZjdmMGVcIiwgXCIjZDYyNzI4XCJdKTtcclxuXHJcbiAgICBjb25zdCBzdmcgPSBkM1xyXG4gICAgICAgIC5jcmVhdGUoXCJzdmdcIilcclxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHQgKyA1MF0pXHJcbiAgICAgICAgLmF0dHIoXCJwcmVzZXJ2ZUFzcGVjdFJhdGlvXCIsIFwieE1pZFlNaWQgbWVldFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvO1wiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgYXJyb3doZWFkIG1hcmtlciBmb3IgZWFjaCBsaW5rXHJcbiAgICBjb25zdCBkZWZzID0gc3ZnLmFwcGVuZChcImRlZnNcIik7XHJcblxyXG4gICAgbGlua3MuZm9yRWFjaCgoZCwgaSkgPT4ge1xyXG4gICAgICAgIGRlZnMuYXBwZW5kKFwibWFya2VyXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYGFycm93aGVhZC0ke2l9YClcclxuICAgICAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAtMyA2IDZcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZYXCIsIDYpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWVwiLCAwKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDQpXHJcbiAgICAgICAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxyXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgXCJNMCwtM0w2LDBMMCwzXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBsaW5rQ29sb3IoZC53ZWlnaHQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkM1xyXG4gICAgICAgIC5mb3JjZVNpbXVsYXRpb24obm9kZXMpXHJcbiAgICAgICAgLmZvcmNlKFxyXG4gICAgICAgICAgICBcImxpbmtcIixcclxuICAgICAgICAgICAgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZCgoZCkgPT4gZC5pZClcclxuICAgICAgICApXHJcbiAgICAgICAgLmZvcmNlKFwiY2hhcmdlXCIsIGQzLmZvcmNlTWFueUJvZHkoKSlcclxuICAgICAgICAuZm9yY2UoXCJjZW50ZXJcIiwgZDMuZm9yY2VDZW50ZXIod2lkdGggLyAyLCBoZWlnaHQgLyAyKSlcclxuICAgICAgICAub24oXCJ0aWNrXCIsIHRpY2tlZCk7XHJcblxyXG4gICAgY29uc3QgbGluayA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC42KVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgLmRhdGEobGlua3MpXHJcbiAgICAgICAgLmpvaW4oXCJwYXRoXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IGxpbmtDb2xvcihkLndlaWdodCkpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGQpID0+IDIgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCAoZCkgPT4gcmFkaXVzU2NhbGUoZC53aW5zKSlcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IGNvbG9yKGQuZ3JvdXApKTtcclxuXHJcbiAgICAvLyBUb29sdGlwIHdpdGggZnVsbCB0ZWFtIHN0YXRzXHJcbiAgICBub2RlLmFwcGVuZChcInRpdGxlXCIpLnRleHQoXHJcbiAgICAgICAgKGQpID0+XHJcbiAgICAgICAgICAgIGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoXHJcbiAgICAgICAgICAgICAgICBkLndpbl9yYXRlICogMTAwXHJcbiAgICAgICAgICAgICkudG9GaXhlZCgxKX0lYFxyXG4gICAgKTtcclxuXHJcbiAgICBub2RlLmNhbGwoXHJcbiAgICAgICAgZDNcclxuICAgICAgICAgICAgLmRyYWcoKVxyXG4gICAgICAgICAgICAub24oXCJzdGFydFwiLCBkcmFnc3RhcnRlZClcclxuICAgICAgICAgICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxyXG4gICAgICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbHMgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiMzMzNcIilcclxuICAgICAgICAudGV4dCgoZCkgPT4gZC5pZCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdGlja2VkKCkge1xyXG4gICAgICAgIGxpbmsuYXR0cihcImRcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZS5hdHRyKFwiY3hcIiwgKGQpID0+IGQueCkuYXR0cihcImN5XCIsIChkKSA9PiBkLnkpO1xyXG5cclxuICAgICAgICBsYWJlbHMuYXR0cihcInhcIiwgKGQpID0+IGQueCkuYXR0cihcInlcIiwgKGQpID0+IGQueSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwLjMpLnJlc3RhcnQoKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQuc3ViamVjdC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBudWxsO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBjZWxsIGlzIHJlLXJ1biwgc3RvcCB0aGUgcHJldmlvdXMgc2ltdWxhdGlvbi4gKFRoaXMgZG9lc27igJl0XHJcbiAgICAvLyByZWFsbHkgbWF0dGVyIHNpbmNlIHRoZSB0YXJnZXQgYWxwaGEgaXMgemVybyBhbmQgdGhlIHNpbXVsYXRpb24gd2lsbFxyXG4gICAgLy8gc3RvcCBuYXR1cmFsbHksIGJ1dCBpdOKAmXMgYSBnb29kIHByYWN0aWNlLilcclxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHNpbXVsYXRpb24uc3RvcCgpKTtcclxuXHJcbiAgICByZXR1cm4gc3ZnLm5vZGUoKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWF0Y2hlc0J5WWVhclF1YXJ0ZXJzID0gKGF3YWl0IEZpbGVBdHRhY2htZW50KFwicnVnYnkuY3N2XCIpLmNzdih7IHR5cGVkOiB0cnVlIH0pKVxyXG4gICAgLmZpbHRlcihkID0+IGQuY29tcGV0aXRpb25fbmFtZSA9PT0gXCJSdWdieSBXb3JsZCBDdXBcIilcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgaG9tZV9zY29yZTogK2QuaG9tZV9zY29yZSxcclxuICAgICAgICBhd2F5X3Njb3JlOiArZC5hd2F5X3Njb3JlLFxyXG4gICAgICAgIG1hdGNoX2RhdGU6IG5ldyBEYXRlKGQubWF0Y2hfZGF0ZSksXHJcbiAgICAgICAgeWVhcjogbmV3IERhdGUoZC5tYXRjaF9kYXRlKS5nZXRGdWxsWWVhcigpXHJcbiAgICB9KSlcclxuICAgIC5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgaWYgKGEueWVhciAhPT0gYi55ZWFyKSByZXR1cm4gYS55ZWFyIC0gYi55ZWFyO1xyXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShiLm1hdGNoX2RhdGUpIC0gbmV3IERhdGUoYS5tYXRjaF9kYXRlKTtcclxuICAgIH0pXHJcbiAgICAucmVkdWNlKChhY2MsIG1hdGNoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeWVhciA9IG1hdGNoLnllYXI7XHJcbiAgICAgICAgaWYgKCFhY2NbeWVhcl0pIGFjY1t5ZWFyXSA9IFtdO1xyXG4gICAgICAgIGFjY1t5ZWFyXS5wdXNoKG1hdGNoKTtcclxuICAgICAgICByZXR1cm4gYWNjO1xyXG4gICAgfSwge30pO1xyXG5cclxubWF0Y2hEYXRhUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzID0gT2JqZWN0LmZyb21FbnRyaWVzKFxyXG4gICAgT2JqZWN0LmVudHJpZXMobWF0Y2hlc0J5WWVhclF1YXJ0ZXJzKS5tYXAoKFt5ZWFyLCBtYXRjaGVzXSkgPT4gW1xyXG4gICAgICAgIHllYXIsXHJcbiAgICAgICAgbWF0Y2hlcy5zbGljZSg0LCA4KVxyXG4gICAgXSlcclxuKTtcclxuXHJcbnRvcDhNYXRjaGVzID0gT2JqZWN0LnZhbHVlcyhtYXRjaERhdGFSdWdieVdvcmxkQ3VwUXVhcnRlcnMpXHJcbiAgICAuZmxhdCgpXHJcbiAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5tYXRjaF9kYXRlKSAtIG5ldyBEYXRlKGIubWF0Y2hfZGF0ZSkpXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIHdpbm5lcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5ob21lX3RlYW0gOiBkLmF3YXlfdGVhbSxcclxuICAgICAgICBsb3NlcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5hd2F5X3RlYW0gOiBkLmhvbWVfdGVhbVxyXG4gICAgfSkpO1xyXG5cclxudGVhbVN0YXRzUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzID0ge1xyXG4gICAgY29uc3Qgc3RhdHMgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKGNvbnN0IGQgb2YgdG9wOE1hdGNoZXMpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHRlYW0gb2YgW2QuaG9tZV90ZWFtLCBkLmF3YXlfdGVhbV0pIHtcclxuICAgICAgICAgICAgaWYgKCFzdGF0cy5oYXModGVhbSkpIHN0YXRzLnNldCh0ZWFtLCB7IHRlYW0sIGdhbWVzOiAwLCB3aW5zOiAwIH0pO1xyXG4gICAgICAgICAgICBzdGF0cy5nZXQodGVhbSkuZ2FtZXMrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RhdHMuZ2V0KGQud2lubmVyKS53aW5zKys7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShzdGF0cy52YWx1ZXMoKSkubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbnMgLyBkLmdhbWVzXHJcbiAgICB9KSkuc29ydCgoYSwgYikgPT4gYi53aW5zIC0gYS53aW5zIHx8IGIuZ2FtZXMgLSBhLmdhbWVzIHx8IGIud2luX3JhdGUgLSBhLndpbl9yYXRlKTtcclxufTtcclxuXHJcbmVkZ2VzUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzID0ge1xyXG4gICAgY29uc3QgZWRnZU1hcCA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0b3A4TWF0Y2hlcykge1xyXG4gICAgICAgIGNvbnN0IFt0ZWFtMSwgdGVhbTJdID0gW2QuaG9tZV90ZWFtLCBkLmF3YXlfdGVhbV0uc29ydCgpO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke3RlYW0xfXwke3RlYW0yfWA7XHJcbiAgICAgICAgaWYgKCFlZGdlTWFwLmhhcyhrZXkpKSBlZGdlTWFwLnNldChrZXksIHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xOiAwLCB3aW5zX3RlYW0yOiAwLCB0b3RhbDogMCB9KTtcclxuICAgICAgICBjb25zdCBlZGdlID0gZWRnZU1hcC5nZXQoa2V5KTtcclxuICAgICAgICBlZGdlLnRvdGFsKys7XHJcbiAgICAgICAgaWYgKGQud2lubmVyID09PSB0ZWFtMSkgZWRnZS53aW5zX3RlYW0xKys7XHJcbiAgICAgICAgZWxzZSBlZGdlLndpbnNfdGVhbTIrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKGVkZ2VNYXAudmFsdWVzKCkpLm1hcCgoeyB0ZWFtMSwgdGVhbTIsIHdpbnNfdGVhbTEsIHdpbnNfdGVhbTIsIHRvdGFsIH0pID0+IHtcclxuICAgICAgICBjb25zdCBkb21pbmFudCA9IHdpbnNfdGVhbTEgPj0gd2luc190ZWFtMiA/IHRlYW0xIDogdGVhbTI7XHJcbiAgICAgICAgY29uc3Qgd2Vha2VyID0gd2luc190ZWFtMSA8IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogZG9taW5hbnQsXHJcbiAgICAgICAgICAgIHRhcmdldDogd2Vha2VyLFxyXG4gICAgICAgICAgICB3ZWlnaHQ6IE1hdGgubWF4KHdpbnNfdGVhbTEsIHdpbnNfdGVhbTIpIC8gdG90YWxcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5ub2Rlc1J1Z2J5V29ybGRDdXBRdWFydGVycyA9IHRlYW1TdGF0c1J1Z2J5V29ybGRDdXBRdWFydGVyc1xyXG4gICAgLm1hcChkID0+ICh7XHJcbiAgICAgICAgaWQ6IGQudGVhbSxcclxuICAgICAgICBncm91cDogZC53aW5zLFxyXG4gICAgICAgIHdpbnM6IGQud2lucyxcclxuICAgICAgICBnYW1lczogZC5nYW1lcyxcclxuICAgICAgICB3aW5fcmF0ZTogZC53aW5fcmF0ZSxcclxuICAgICAgICB0aXRsZTogYCR7ZC50ZWFtfVxcbldpbnM6ICR7ZC53aW5zfVxcbkdhbWVzOiAke2QuZ2FtZXN9XFxuV2luIFJhdGU6ICR7KGQud2luX3JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWBcclxuICAgIH0pKVxyXG4gICAgLnNvcnQoKGEsIGIpID0+XHJcbiAgICAgICAgYi53aW5zIC0gYS53aW5zIHx8XHJcbiAgICAgICAgYi5nYW1lcyAtIGEuZ2FtZXMgfHxcclxuICAgICAgICBiLndpbl9yYXRlIC0gYS53aW5fcmF0ZVxyXG4gICAgKTtcclxuXHJcbmNpcmN1bGFyTm9kZXNSdWdieVdvcmxkQ3VwUXVhcnRlcnMgPSB7XHJcbiAgICBjb25zdCByYWRpdXMgPSAyNTA7XHJcbiAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyO1xyXG4gICAgY29uc3QgY2VudGVyWSA9IDMwMDtcclxuICAgIGNvbnN0IGFuZ2xlU3RlcCA9ICgyICogTWF0aC5QSSkgLyBub2Rlc1J1Z2J5V29ybGRDdXBRdWFydGVycy5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIG5vZGVzUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzLm1hcCgobm9kZSwgaSkgPT4gKHtcclxuICAgICAgICAuLi5ub2RlLFxyXG4gICAgICAgIGZ4OiBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoaSAqIGFuZ2xlU3RlcCksXHJcbiAgICAgICAgZnk6IGNlbnRlclkgKyByYWRpdXMgKiBNYXRoLnNpbihpICogYW5nbGVTdGVwKVxyXG4gICAgfSkpO1xyXG59O1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLnRhYmxlKG5vZGVzUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzLCB7XHJcbiAgICBjb2x1bW5zOiBbXHJcbiAgICAgICAgXCJpZFwiLFxyXG4gICAgICAgIFwiZ2FtZXNcIixcclxuICAgICAgICBcIndpbnNcIixcclxuICAgICAgICBcIndpbl9yYXRlXCJcclxuICAgIF0sXHJcbiAgICBoZWFkZXI6IHtcclxuICAgICAgICBpZDogXCJDb3VudHJ5XCIsXHJcbiAgICAgICAgZ2FtZXM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgUGxheWVkXCIsXHJcbiAgICAgICAgd2luczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBXb25cIixcclxuICAgICAgICB3aW5fcmF0ZTogXCJXaW4gUmF0ZVwiXHJcbiAgICB9LFxyXG4gICAgZm9ybWF0OiB7XHJcbiAgICAgICAgZ2FtZXM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5V29ybGRDdXBRdWFydGVycywgKGQpID0+IGRbXCJnYW1lc1wiXSkpLFxyXG4gICAgICAgIHdpbnM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5V29ybGRDdXBRdWFydGVycywgKGQpID0+IGRbXCJ3aW5zXCJdKSksXHJcbiAgICAgICAgd2luX3JhdGU6IHNwYXJrYmFyUGVyY2VudChcclxuICAgICAgICAgICAgZDMubWF4KG5vZGVzUnVnYnlXb3JsZEN1cFF1YXJ0ZXJzLCAoZCkgPT4gZFtcIndpbl9yYXRlXCJdKVxyXG4gICAgICAgICksXHJcbiAgICB9LFxyXG4gICAgcm93czogMTAwLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcclxuICAgIGNvbnN0IHdpZHRoID0gOTI4O1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gNjAwO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yID0gZDMuc2NhbGVPcmRpbmFsKHBlcnNvbmFsX2NvbG91cnMpO1xyXG5cclxuICAgIGNvbnN0IGxpbmtzID0gZWRnZXNSdWdieVdvcmxkQ3VwUXVhcnRlcnMubWFwKChkKSA9PiAoeyAuLi5kIH0pKTtcclxuICAgIGNvbnN0IG5vZGVzID0gY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBRdWFydGVycy5tYXAoKGQpID0+ICh7IC4uLmQgfSkpO1xyXG5cclxuICAgIGNvbnN0IHJhZGl1c1NjYWxlID0gZDNcclxuICAgICAgICAuc2NhbGVTcXJ0KClcclxuICAgICAgICAuZG9tYWluKFswLCBkMy5tYXgobm9kZXMsIChkKSA9PiBkLndpbnMpXSlcclxuICAgICAgICAucmFuZ2UoWzUsIDUwXSk7XHJcblxyXG4gICAgY29uc3QgbGlua0NvbG9yID0gZDNcclxuICAgICAgICAuc2NhbGVMaW5lYXIoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIDAuNSwgMV0pXHJcbiAgICAgICAgLnJhbmdlKFtcIiMyY2EwMmNcIiwgXCIjZmY3ZjBlXCIsIFwiI2Q2MjcyOFwiXSk7XHJcblxyXG4gICAgY29uc3Qgc3ZnID0gZDNcclxuICAgICAgICAuY3JlYXRlKFwic3ZnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcclxuICAgICAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXHJcbiAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0ICsgNTBdKVxyXG4gICAgICAgIC5hdHRyKFwicHJlc2VydmVBc3BlY3RSYXRpb1wiLCBcInhNaWRZTWlkIG1lZXRcIilcclxuICAgICAgICAuYXR0cihcInN0eWxlXCIsIFwid2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bztcIik7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgdW5pcXVlIGFycm93aGVhZCBtYXJrZXIgZm9yIGVhY2ggbGlua1xyXG4gICAgY29uc3QgZGVmcyA9IHN2Zy5hcHBlbmQoXCJkZWZzXCIpO1xyXG5cclxuICAgIGxpbmtzLmZvckVhY2goKGQsIGkpID0+IHtcclxuICAgICAgICBkZWZzLmFwcGVuZChcIm1hcmtlclwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImlkXCIsIGBhcnJvd2hlYWQtJHtpfWApXHJcbiAgICAgICAgICAgIC5hdHRyKFwidmlld0JveFwiLCBcIjAgLTMgNiA2XCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWFwiLCA2KVxyXG4gICAgICAgICAgICAuYXR0cihcInJlZllcIiwgMClcclxuICAgICAgICAgICAgLmF0dHIoXCJtYXJrZXJXaWR0aFwiLCAyKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlckhlaWdodFwiLCA0KVxyXG4gICAgICAgICAgICAuYXR0cihcIm9yaWVudFwiLCBcImF1dG9cIilcclxuICAgICAgICAgICAgLmFwcGVuZChcInBhdGhcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIFwiTTAsLTNMNiwwTDAsM1wiKVxyXG4gICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgbGlua0NvbG9yKGQud2VpZ2h0KSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBzaW11bGF0aW9uID0gZDNcclxuICAgICAgICAuZm9yY2VTaW11bGF0aW9uKG5vZGVzKVxyXG4gICAgICAgIC5mb3JjZShcclxuICAgICAgICAgICAgXCJsaW5rXCIsXHJcbiAgICAgICAgICAgIGQzLmZvcmNlTGluayhsaW5rcykuaWQoKGQpID0+IGQuaWQpXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5mb3JjZShcImNoYXJnZVwiLCBkMy5mb3JjZU1hbnlCb2R5KCkpXHJcbiAgICAgICAgLmZvcmNlKFwiY2VudGVyXCIsIGQzLmZvcmNlQ2VudGVyKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMikpXHJcbiAgICAgICAgLm9uKFwidGlja1wiLCB0aWNrZWQpO1xyXG5cclxuICAgIGNvbnN0IGxpbmsgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcclxuICAgICAgICAuYXR0cihcInN0cm9rZS1vcGFjaXR5XCIsIDAuNilcclxuICAgICAgICAuc2VsZWN0QWxsKFwicGF0aFwiKVxyXG4gICAgICAgIC5kYXRhKGxpbmtzKVxyXG4gICAgICAgIC5qb2luKFwicGF0aFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIChkKSA9PiBsaW5rQ29sb3IoZC53ZWlnaHQpKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIChkKSA9PiA1ICogZC53ZWlnaHQpXHJcbiAgICAgICAgLmF0dHIoXCJtYXJrZXItZW5kXCIsIChkLCBpKSA9PiBgdXJsKCNhcnJvd2hlYWQtJHtpfSlgKTtcclxuXHJcbiAgICBjb25zdCBub2RlID0gc3ZnXHJcbiAgICAgICAgLmFwcGVuZChcImdcIilcclxuICAgICAgICAuc2VsZWN0QWxsKFwiY2lyY2xlXCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJjaXJjbGVcIilcclxuICAgICAgICAuYXR0cihcInJcIiwgKGQpID0+IHJhZGl1c1NjYWxlKGQud2lucykpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIChkKSA9PiBjb2xvcihkLmdyb3VwKSk7XHJcblxyXG4gICAgLy8gVG9vbHRpcCB3aXRoIGZ1bGwgdGVhbSBzdGF0c1xyXG4gICAgbm9kZS5hcHBlbmQoXCJ0aXRsZVwiKS50ZXh0KFxyXG4gICAgICAgIChkKSA9PlxyXG4gICAgICAgICAgICBgJHtkLmlkfVxcbldpbnM6ICR7ZC53aW5zfVxcbkdhbWVzOiAke2QuZ2FtZXN9XFxuV2luIFJhdGU6ICR7KFxyXG4gICAgICAgICAgICAgICAgZC53aW5fcmF0ZSAqIDEwMFxyXG4gICAgICAgICAgICApLnRvRml4ZWQoMSl9JWBcclxuICAgICk7XHJcblxyXG4gICAgbm9kZS5jYWxsKFxyXG4gICAgICAgIGQzXHJcbiAgICAgICAgICAgIC5kcmFnKClcclxuICAgICAgICAgICAgLm9uKFwic3RhcnRcIiwgZHJhZ3N0YXJ0ZWQpXHJcbiAgICAgICAgICAgIC5vbihcImRyYWdcIiwgZHJhZ2dlZClcclxuICAgICAgICAgICAgLm9uKFwiZW5kXCIsIGRyYWdlbmRlZClcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgbGFiZWxzID0gc3ZnXHJcbiAgICAgICAgLmFwcGVuZChcImdcIilcclxuICAgICAgICAuc2VsZWN0QWxsKFwidGV4dFwiKVxyXG4gICAgICAgIC5kYXRhKG5vZGVzKVxyXG4gICAgICAgIC5qb2luKFwidGV4dFwiKVxyXG4gICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcclxuICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcclxuICAgICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjEwcHhcIilcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgXCIjMzMzXCIpXHJcbiAgICAgICAgLnRleHQoKGQpID0+IGQuaWQpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHRpY2tlZCgpIHtcclxuICAgICAgICBsaW5rLmF0dHIoXCJkXCIsIChkKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR4ID0gZC50YXJnZXQueCAtIGQuc291cmNlLng7XHJcbiAgICAgICAgICAgIGNvbnN0IGR5ID0gZC50YXJnZXQueSAtIGQuc291cmNlLnk7XHJcbiAgICAgICAgICAgIGNvbnN0IGRyID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcclxuICAgICAgICAgICAgY29uc3QgciA9IHJhZGl1c1NjYWxlKGQudGFyZ2V0LndpbnMpO1xyXG4gICAgICAgICAgICBjb25zdCByYXRpbyA9IChkciAtIHIpIC8gZHI7XHJcbiAgICAgICAgICAgIGNvbnN0IHR4ID0gZC5zb3VyY2UueCArIGR4ICogcmF0aW87XHJcbiAgICAgICAgICAgIGNvbnN0IHR5ID0gZC5zb3VyY2UueSArIGR5ICogcmF0aW87XHJcbiAgICAgICAgICAgIHJldHVybiBgTSR7ZC5zb3VyY2UueH0sJHtkLnNvdXJjZS55fUwke3R4fSwke3R5fWA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5vZGUuYXR0cihcImN4XCIsIChkKSA9PiBkLngpLmF0dHIoXCJjeVwiLCAoZCkgPT4gZC55KTtcclxuXHJcbiAgICAgICAgbGFiZWxzLmF0dHIoXCJ4XCIsIChkKSA9PiBkLngpLmF0dHIoXCJ5XCIsIChkKSA9PiBkLnkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdzdGFydGVkKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMC4zKS5yZXN0YXJ0KCk7XHJcbiAgICAgICAgZXZlbnQuc3ViamVjdC5meCA9IGV2ZW50LnN1YmplY3QueDtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ5ID0gZXZlbnQuc3ViamVjdC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdnZWQoZXZlbnQpIHtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQueDtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ5ID0gZXZlbnQueTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnZW5kZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gbnVsbDtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ5ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXaGVuIHRoaXMgY2VsbCBpcyByZS1ydW4sIHN0b3AgdGhlIHByZXZpb3VzIHNpbXVsYXRpb24uIChUaGlzIGRvZXNu4oCZdFxyXG4gICAgLy8gcmVhbGx5IG1hdHRlciBzaW5jZSB0aGUgdGFyZ2V0IGFscGhhIGlzIHplcm8gYW5kIHRoZSBzaW11bGF0aW9uIHdpbGxcclxuICAgIC8vIHN0b3AgbmF0dXJhbGx5LCBidXQgaXTigJlzIGEgZ29vZCBwcmFjdGljZS4pXHJcbiAgICBpbnZhbGlkYXRpb24udGhlbigoKSA9PiBzaW11bGF0aW9uLnN0b3AoKSk7XHJcblxyXG4gICAgcmV0dXJuIHN2Zy5ub2RlKCk7XHJcbn1cclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1hdGNoZXNCeVllYXJTZW1pcyA9IChhd2FpdCBGaWxlQXR0YWNobWVudChcInJ1Z2J5LmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KSlcclxuICAgIC5maWx0ZXIoZCA9PiBkLmNvbXBldGl0aW9uX25hbWUgPT09IFwiUnVnYnkgV29ybGQgQ3VwXCIpXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIGhvbWVfc2NvcmU6ICtkLmhvbWVfc2NvcmUsXHJcbiAgICAgICAgYXdheV9zY29yZTogK2QuYXdheV9zY29yZSxcclxuICAgICAgICBtYXRjaF9kYXRlOiBuZXcgRGF0ZShkLm1hdGNoX2RhdGUpLFxyXG4gICAgICAgIHllYXI6IG5ldyBEYXRlKGQubWF0Y2hfZGF0ZSkuZ2V0RnVsbFllYXIoKVxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgIGlmIChhLnllYXIgIT09IGIueWVhcikgcmV0dXJuIGEueWVhciAtIGIueWVhcjtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYi5tYXRjaF9kYXRlKSAtIG5ldyBEYXRlKGEubWF0Y2hfZGF0ZSk7XHJcbiAgICB9KVxyXG4gICAgLnJlZHVjZSgoYWNjLCBtYXRjaCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHllYXIgPSBtYXRjaC55ZWFyO1xyXG4gICAgICAgIGlmICghYWNjW3llYXJdKSBhY2NbeWVhcl0gPSBbXTtcclxuICAgICAgICBhY2NbeWVhcl0ucHVzaChtYXRjaCk7XHJcbiAgICAgICAgcmV0dXJuIGFjYztcclxuICAgIH0sIHt9KTtcclxuXHJcbm1hdGNoRGF0YVJ1Z2J5V29ybGRDdXBTZW1pcyA9IE9iamVjdC5mcm9tRW50cmllcyhcclxuICAgIE9iamVjdC5lbnRyaWVzKG1hdGNoZXNCeVllYXJTZW1pcykubWFwKChbeWVhciwgbWF0Y2hlc10pID0+IFtcclxuICAgICAgICB5ZWFyLFxyXG4gICAgICAgIG1hdGNoZXMuc2xpY2UoMiwgNCkgLy8gYXNzdW1pbmcgc29ydGVkIGZyb20gbGF0ZXN0IHRvIGVhcmxpZXN0XHJcbiAgICBdKVxyXG4pO1xyXG5cclxudG9wNE1hdGNoZXMgPSBPYmplY3QudmFsdWVzKG1hdGNoRGF0YVJ1Z2J5V29ybGRDdXBTZW1pcylcclxuICAgIC5mbGF0KClcclxuICAgIC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShhLm1hdGNoX2RhdGUpIC0gbmV3IERhdGUoYi5tYXRjaF9kYXRlKSlcclxuICAgIC5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgd2lubmVyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmhvbWVfdGVhbSA6IGQuYXdheV90ZWFtLFxyXG4gICAgICAgIGxvc2VyOiBkLmhvbWVfc2NvcmUgPiBkLmF3YXlfc2NvcmUgPyBkLmF3YXlfdGVhbSA6IGQuaG9tZV90ZWFtXHJcbiAgICB9KSk7XHJcblxyXG50ZWFtU3RhdHNSdWdieVdvcmxkQ3VwU2VtaXMgPSB7XHJcbiAgICBjb25zdCBzdGF0cyA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0b3A0TWF0Y2hlcykge1xyXG4gICAgICAgIGZvciAoY29uc3QgdGVhbSBvZiBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXSkge1xyXG4gICAgICAgICAgICBpZiAoIXN0YXRzLmhhcyh0ZWFtKSkgc3RhdHMuc2V0KHRlYW0sIHsgdGVhbSwgZ2FtZXM6IDAsIHdpbnM6IDAgfSk7XHJcbiAgICAgICAgICAgIHN0YXRzLmdldCh0ZWFtKS5nYW1lcysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0cy5nZXQoZC53aW5uZXIpLndpbnMrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRzLnZhbHVlcygpKS5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgd2luX3JhdGU6IGQud2lucyAvIGQuZ2FtZXNcclxuICAgIH0pKS5zb3J0KChhLCBiKSA9PiBiLndpbnMgLSBhLndpbnMgfHwgYi5nYW1lcyAtIGEuZ2FtZXMgfHwgYi53aW5fcmF0ZSAtIGEud2luX3JhdGUpO1xyXG59O1xyXG5cclxuZWRnZXNSdWdieVdvcmxkQ3VwU2VtaXMgPSB7XHJcbiAgICBjb25zdCBlZGdlTWFwID0gbmV3IE1hcCgpO1xyXG4gICAgZm9yIChjb25zdCBkIG9mIHRvcDRNYXRjaGVzKSB7XHJcbiAgICAgICAgY29uc3QgW3RlYW0xLCB0ZWFtMl0gPSBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXS5zb3J0KCk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gYCR7dGVhbTF9fCR7dGVhbTJ9YDtcclxuICAgICAgICBpZiAoIWVkZ2VNYXAuaGFzKGtleSkpIGVkZ2VNYXAuc2V0KGtleSwgeyB0ZWFtMSwgdGVhbTIsIHdpbnNfdGVhbTE6IDAsIHdpbnNfdGVhbTI6IDAsIHRvdGFsOiAwIH0pO1xyXG4gICAgICAgIGNvbnN0IGVkZ2UgPSBlZGdlTWFwLmdldChrZXkpO1xyXG4gICAgICAgIGVkZ2UudG90YWwrKztcclxuICAgICAgICBpZiAoZC53aW5uZXIgPT09IHRlYW0xKSBlZGdlLndpbnNfdGVhbTErKztcclxuICAgICAgICBlbHNlIGVkZ2Uud2luc190ZWFtMisrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oZWRnZU1hcC52YWx1ZXMoKSkubWFwKCh7IHRlYW0xLCB0ZWFtMiwgd2luc190ZWFtMSwgd2luc190ZWFtMiwgdG90YWwgfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRvbWluYW50ID0gd2luc190ZWFtMSA+PSB3aW5zX3RlYW0yID8gdGVhbTEgOiB0ZWFtMjtcclxuICAgICAgICBjb25zdCB3ZWFrZXIgPSB3aW5zX3RlYW0xIDwgd2luc190ZWFtMiA/IHRlYW0xIDogdGVhbTI7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc291cmNlOiBkb21pbmFudCxcclxuICAgICAgICAgICAgdGFyZ2V0OiB3ZWFrZXIsXHJcbiAgICAgICAgICAgIHdlaWdodDogTWF0aC5tYXgod2luc190ZWFtMSwgd2luc190ZWFtMikgLyB0b3RhbFxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufTtcclxuXHJcbm5vZGVzUnVnYnlXb3JsZEN1cFNlbWlzID0gdGVhbVN0YXRzUnVnYnlXb3JsZEN1cFNlbWlzXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICBpZDogZC50ZWFtLFxyXG4gICAgICAgIGdyb3VwOiBkLndpbnMsXHJcbiAgICAgICAgd2luczogZC53aW5zLFxyXG4gICAgICAgIGdhbWVzOiBkLmdhbWVzLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbl9yYXRlLFxyXG4gICAgICAgIHRpdGxlOiBgJHtkLnRlYW19XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoZC53aW5fcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYFxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT5cclxuICAgICAgICBiLndpbnMgLSBhLndpbnMgfHxcclxuICAgICAgICBiLmdhbWVzIC0gYS5nYW1lcyB8fFxyXG4gICAgICAgIGIud2luX3JhdGUgLSBhLndpbl9yYXRlXHJcbiAgICApO1xyXG5cclxuY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBTZW1pcyA9IHtcclxuICAgIGNvbnN0IHJhZGl1cyA9IDI1MDtcclxuICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7XHJcbiAgICBjb25zdCBjZW50ZXJZID0gMzAwO1xyXG4gICAgY29uc3QgYW5nbGVTdGVwID0gKDIgKiBNYXRoLlBJKSAvIG5vZGVzUnVnYnlXb3JsZEN1cFNlbWlzLmxlbmd0aDtcclxuXHJcbiAgICByZXR1cm4gbm9kZXNSdWdieVdvcmxkQ3VwU2VtaXMubWFwKChub2RlLCBpKSA9PiAoe1xyXG4gICAgICAgIC4uLm5vZGUsXHJcbiAgICAgICAgZng6IGNlbnRlclggKyByYWRpdXMgKiBNYXRoLmNvcyhpICogYW5nbGVTdGVwKSxcclxuICAgICAgICBmeTogY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGkgKiBhbmdsZVN0ZXApXHJcbiAgICB9KSk7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMudGFibGUobm9kZXNSdWdieVdvcmxkQ3VwU2VtaXMsIHtcclxuICAgIGNvbHVtbnM6IFtcclxuICAgICAgICBcImlkXCIsXHJcbiAgICAgICAgXCJnYW1lc1wiLFxyXG4gICAgICAgIFwid2luc1wiLFxyXG4gICAgICAgIFwid2luX3JhdGVcIlxyXG4gICAgXSxcclxuICAgIGhlYWRlcjoge1xyXG4gICAgICAgIGlkOiBcIkNvdW50cnlcIixcclxuICAgICAgICBnYW1lczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBQbGF5ZWRcIixcclxuICAgICAgICB3aW5zOiBcIk51bWJlciBvZiBNYXRjaGVzIFdvblwiLFxyXG4gICAgICAgIHdpbl9yYXRlOiBcIldpbiBSYXRlXCJcclxuICAgIH0sXHJcbiAgICBmb3JtYXQ6IHtcclxuICAgICAgICBnYW1lczogc3BhcmtiYXIoZDMubWF4KG5vZGVzUnVnYnlXb3JsZEN1cFNlbWlzLCAoZCkgPT4gZFtcImdhbWVzXCJdKSksXHJcbiAgICAgICAgd2luczogc3BhcmtiYXIoZDMubWF4KG5vZGVzUnVnYnlXb3JsZEN1cFNlbWlzLCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwU2VtaXMsIChkKSA9PiBkW1wid2luX3JhdGVcIl0pXHJcbiAgICAgICAgKSxcclxuICAgIH0sXHJcbiAgICByb3dzOiAxMDAsXHJcbn0pO1xyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xyXG4gICAgY29uc3Qgd2lkdGggPSA5Mjg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSA2MDA7XHJcblxyXG4gICAgY29uc3QgY29sb3IgPSBkMy5zY2FsZU9yZGluYWwocGVyc29uYWxfY29sb3Vycyk7XHJcblxyXG4gICAgY29uc3QgbGlua3MgPSBlZGdlc1J1Z2J5V29ybGRDdXBTZW1pcy5tYXAoKGQpID0+ICh7IC4uLmQgfSkpO1xyXG4gICAgY29uc3Qgbm9kZXMgPSBjaXJjdWxhck5vZGVzUnVnYnlXb3JsZEN1cFNlbWlzLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzU2NhbGUgPSBkM1xyXG4gICAgICAgIC5zY2FsZVNxcnQoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIGQzLm1heChub2RlcywgKGQpID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgNTBdKTtcclxuXHJcbiAgICBjb25zdCBsaW5rQ29sb3IgPSBkM1xyXG4gICAgICAgIC5zY2FsZUxpbmVhcigpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSlcclxuICAgICAgICAucmFuZ2UoW1wiIzJjYTAyY1wiLCBcIiNmZjdmMGVcIiwgXCIjZDYyNzI4XCJdKTtcclxuXHJcbiAgICBjb25zdCBzdmcgPSBkM1xyXG4gICAgICAgIC5jcmVhdGUoXCJzdmdcIilcclxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHQgKyA1MF0pXHJcbiAgICAgICAgLmF0dHIoXCJwcmVzZXJ2ZUFzcGVjdFJhdGlvXCIsIFwieE1pZFlNaWQgbWVldFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvO1wiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgYXJyb3doZWFkIG1hcmtlciBmb3IgZWFjaCBsaW5rXHJcbiAgICBjb25zdCBkZWZzID0gc3ZnLmFwcGVuZChcImRlZnNcIik7XHJcblxyXG4gICAgbGlua3MuZm9yRWFjaCgoZCwgaSkgPT4ge1xyXG4gICAgICAgIGRlZnMuYXBwZW5kKFwibWFya2VyXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYGFycm93aGVhZC0ke2l9YClcclxuICAgICAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAtMyA2IDZcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZYXCIsIDYpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWVwiLCAwKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDQpXHJcbiAgICAgICAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxyXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgXCJNMCwtM0w2LDBMMCwzXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBsaW5rQ29sb3IoZC53ZWlnaHQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkM1xyXG4gICAgICAgIC5mb3JjZVNpbXVsYXRpb24obm9kZXMpXHJcbiAgICAgICAgLmZvcmNlKFxyXG4gICAgICAgICAgICBcImxpbmtcIixcclxuICAgICAgICAgICAgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZCgoZCkgPT4gZC5pZClcclxuICAgICAgICApXHJcbiAgICAgICAgLmZvcmNlKFwiY2hhcmdlXCIsIGQzLmZvcmNlTWFueUJvZHkoKSlcclxuICAgICAgICAuZm9yY2UoXCJjZW50ZXJcIiwgZDMuZm9yY2VDZW50ZXIod2lkdGggLyAyLCBoZWlnaHQgLyAyKSlcclxuICAgICAgICAub24oXCJ0aWNrXCIsIHRpY2tlZCk7XHJcblxyXG4gICAgY29uc3QgbGluayA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC42KVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgLmRhdGEobGlua3MpXHJcbiAgICAgICAgLmpvaW4oXCJwYXRoXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IGxpbmtDb2xvcihkLndlaWdodCkpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGQpID0+IDUgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCAoZCkgPT4gcmFkaXVzU2NhbGUoZC53aW5zKSlcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IGNvbG9yKGQuZ3JvdXApKTtcclxuXHJcbiAgICAvLyBUb29sdGlwIHdpdGggZnVsbCB0ZWFtIHN0YXRzXHJcbiAgICBub2RlLmFwcGVuZChcInRpdGxlXCIpLnRleHQoXHJcbiAgICAgICAgKGQpID0+XHJcbiAgICAgICAgICAgIGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoXHJcbiAgICAgICAgICAgICAgICBkLndpbl9yYXRlICogMTAwXHJcbiAgICAgICAgICAgICkudG9GaXhlZCgxKX0lYFxyXG4gICAgKTtcclxuXHJcbiAgICBub2RlLmNhbGwoXHJcbiAgICAgICAgZDNcclxuICAgICAgICAgICAgLmRyYWcoKVxyXG4gICAgICAgICAgICAub24oXCJzdGFydFwiLCBkcmFnc3RhcnRlZClcclxuICAgICAgICAgICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxyXG4gICAgICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbHMgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiMzMzNcIilcclxuICAgICAgICAudGV4dCgoZCkgPT4gZC5pZCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdGlja2VkKCkge1xyXG4gICAgICAgIGxpbmsuYXR0cihcImRcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZS5hdHRyKFwiY3hcIiwgKGQpID0+IGQueCkuYXR0cihcImN5XCIsIChkKSA9PiBkLnkpO1xyXG5cclxuICAgICAgICBsYWJlbHMuYXR0cihcInhcIiwgKGQpID0+IGQueCkuYXR0cihcInlcIiwgKGQpID0+IGQueSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwLjMpLnJlc3RhcnQoKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQuc3ViamVjdC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBudWxsO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBjZWxsIGlzIHJlLXJ1biwgc3RvcCB0aGUgcHJldmlvdXMgc2ltdWxhdGlvbi4gKFRoaXMgZG9lc27igJl0XHJcbiAgICAvLyByZWFsbHkgbWF0dGVyIHNpbmNlIHRoZSB0YXJnZXQgYWxwaGEgaXMgemVybyBhbmQgdGhlIHNpbXVsYXRpb24gd2lsbFxyXG4gICAgLy8gc3RvcCBuYXR1cmFsbHksIGJ1dCBpdOKAmXMgYSBnb29kIHByYWN0aWNlLilcclxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHNpbXVsYXRpb24uc3RvcCgpKTtcclxuXHJcbiAgICByZXR1cm4gc3ZnLm5vZGUoKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWF0Y2hEYXRhUnVnYnlXb3JsZEN1cEZpbmFscyA9IChhd2FpdCBGaWxlQXR0YWNobWVudChcInJ1Z2J5LmNzdlwiKS5jc3YoeyB0eXBlZDogdHJ1ZSB9KSlcclxuICAgIC5maWx0ZXIoZCA9PiBkLmNvbXBldGl0aW9uX25hbWUgPT09IFwiUnVnYnkgV29ybGQgQ3VwXCIpXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIGhvbWVfc2NvcmU6ICtkLmhvbWVfc2NvcmUsXHJcbiAgICAgICAgYXdheV9zY29yZTogK2QuYXdheV9zY29yZSxcclxuICAgICAgICBtYXRjaF9kYXRlOiBuZXcgRGF0ZShkLm1hdGNoX2RhdGUpLFxyXG4gICAgICAgIHllYXI6IG5ldyBEYXRlKGQubWF0Y2hfZGF0ZSkuZ2V0RnVsbFllYXIoKVxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgIGlmIChhLnllYXIgIT09IGIueWVhcikgcmV0dXJuIGEueWVhciAtIGIueWVhcjtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYi5tYXRjaF9kYXRlKSAtIG5ldyBEYXRlKGEubWF0Y2hfZGF0ZSk7XHJcbiAgICB9KS5yZWR1Y2UoKGFjYywgbWF0Y2gpID0+IHtcclxuICAgICAgICBjb25zdCB5ZWFyID0gbWF0Y2gueWVhcjtcclxuICAgICAgICBpZiAoIWFjY1t5ZWFyXSkgYWNjW3llYXJdID0gW107XHJcbiAgICAgICAgaWYgKGFjY1t5ZWFyXS5sZW5ndGggPCAyKSBhY2NbeWVhcl0ucHVzaChtYXRjaCk7XHJcbiAgICAgICAgcmV0dXJuIGFjYztcclxuICAgIH0sIHt9KTtcclxuXHJcbnRvcDJNYXRjaGVzID0gT2JqZWN0LnZhbHVlcyhtYXRjaERhdGFSdWdieVdvcmxkQ3VwRmluYWxzKVxyXG4gICAgLmZsYXQoKVxyXG4gICAgLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGEubWF0Y2hfZGF0ZSkgLSBuZXcgRGF0ZShiLm1hdGNoX2RhdGUpKVxyXG4gICAgLm1hcChkID0+ICh7XHJcbiAgICAgICAgLi4uZCxcclxuICAgICAgICB3aW5uZXI6IGQuaG9tZV9zY29yZSA+IGQuYXdheV9zY29yZSA/IGQuaG9tZV90ZWFtIDogZC5hd2F5X3RlYW0sXHJcbiAgICAgICAgbG9zZXI6IGQuaG9tZV9zY29yZSA+IGQuYXdheV9zY29yZSA/IGQuYXdheV90ZWFtIDogZC5ob21lX3RlYW1cclxuICAgIH0pKTtcclxuXHJcbnRlYW1TdGF0c1J1Z2J5V29ybGRDdXBGaW5hbHMgPSB7XHJcbiAgICBjb25zdCBzdGF0cyA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0b3AyTWF0Y2hlcykge1xyXG4gICAgICAgIGZvciAoY29uc3QgdGVhbSBvZiBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXSkge1xyXG4gICAgICAgICAgICBpZiAoIXN0YXRzLmhhcyh0ZWFtKSkgc3RhdHMuc2V0KHRlYW0sIHsgdGVhbSwgZ2FtZXM6IDAsIHdpbnM6IDAgfSk7XHJcbiAgICAgICAgICAgIHN0YXRzLmdldCh0ZWFtKS5nYW1lcysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0cy5nZXQoZC53aW5uZXIpLndpbnMrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRzLnZhbHVlcygpKS5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgd2luX3JhdGU6IGQud2lucyAvIGQuZ2FtZXNcclxuICAgIH0pKS5zb3J0KChhLCBiKSA9PiBiLndpbnMgLSBhLndpbnMgfHwgYi5nYW1lcyAtIGEuZ2FtZXMgfHwgYi53aW5fcmF0ZSAtIGEud2luX3JhdGUpO1xyXG59O1xyXG5cclxuZWRnZXNSdWdieVdvcmxkQ3VwRmluYWxzID0ge1xyXG4gICAgY29uc3QgZWRnZU1hcCA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0b3AyTWF0Y2hlcykge1xyXG4gICAgICAgIGNvbnN0IFt0ZWFtMSwgdGVhbTJdID0gW2QuaG9tZV90ZWFtLCBkLmF3YXlfdGVhbV0uc29ydCgpO1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGAke3RlYW0xfXwke3RlYW0yfWA7XHJcbiAgICAgICAgaWYgKCFlZGdlTWFwLmhhcyhrZXkpKSBlZGdlTWFwLnNldChrZXksIHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xOiAwLCB3aW5zX3RlYW0yOiAwLCB0b3RhbDogMCB9KTtcclxuICAgICAgICBjb25zdCBlZGdlID0gZWRnZU1hcC5nZXQoa2V5KTtcclxuICAgICAgICBlZGdlLnRvdGFsKys7XHJcbiAgICAgICAgaWYgKGQud2lubmVyID09PSB0ZWFtMSkgZWRnZS53aW5zX3RlYW0xKys7XHJcbiAgICAgICAgZWxzZSBlZGdlLndpbnNfdGVhbTIrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKGVkZ2VNYXAudmFsdWVzKCkpLm1hcCgoeyB0ZWFtMSwgdGVhbTIsIHdpbnNfdGVhbTEsIHdpbnNfdGVhbTIsIHRvdGFsIH0pID0+IHtcclxuICAgICAgICBjb25zdCBkb21pbmFudCA9IHdpbnNfdGVhbTEgPj0gd2luc190ZWFtMiA/IHRlYW0xIDogdGVhbTI7XHJcbiAgICAgICAgY29uc3Qgd2Vha2VyID0gd2luc190ZWFtMSA8IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogZG9taW5hbnQsXHJcbiAgICAgICAgICAgIHRhcmdldDogd2Vha2VyLFxyXG4gICAgICAgICAgICB3ZWlnaHQ6IE1hdGgubWF4KHdpbnNfdGVhbTEsIHdpbnNfdGVhbTIpIC8gdG90YWxcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5ub2Rlc1J1Z2J5V29ybGRDdXBGaW5hbHMgPSB0ZWFtU3RhdHNSdWdieVdvcmxkQ3VwRmluYWxzXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICBpZDogZC50ZWFtLFxyXG4gICAgICAgIGdyb3VwOiBkLndpbnMsXHJcbiAgICAgICAgd2luczogZC53aW5zLFxyXG4gICAgICAgIGdhbWVzOiBkLmdhbWVzLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbl9yYXRlLFxyXG4gICAgICAgIHRpdGxlOiBgJHtkLnRlYW19XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoZC53aW5fcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYFxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT5cclxuICAgICAgICBiLndpbnMgLSBhLndpbnMgfHxcclxuICAgICAgICBiLmdhbWVzIC0gYS5nYW1lcyB8fFxyXG4gICAgICAgIGIud2luX3JhdGUgLSBhLndpbl9yYXRlXHJcbiAgICApO1xyXG5cclxuY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBGaW5hbHMgPSB7XHJcbiAgICBjb25zdCByYWRpdXMgPSAyNTA7XHJcbiAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyO1xyXG4gICAgY29uc3QgY2VudGVyWSA9IDMwMDtcclxuICAgIGNvbnN0IGFuZ2xlU3RlcCA9ICgyICogTWF0aC5QSSkgLyBub2Rlc1J1Z2J5V29ybGRDdXBGaW5hbHMubGVuZ3RoO1xyXG5cclxuICAgIHJldHVybiBub2Rlc1J1Z2J5V29ybGRDdXBGaW5hbHMubWFwKChub2RlLCBpKSA9PiAoe1xyXG4gICAgICAgIC4uLm5vZGUsXHJcbiAgICAgICAgZng6IGNlbnRlclggKyByYWRpdXMgKiBNYXRoLmNvcyhpICogYW5nbGVTdGVwKSxcclxuICAgICAgICBmeTogY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGkgKiBhbmdsZVN0ZXApXHJcbiAgICB9KSk7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMudGFibGUobm9kZXNSdWdieVdvcmxkQ3VwRmluYWxzLCB7XHJcbiAgICBjb2x1bW5zOiBbXHJcbiAgICAgICAgXCJpZFwiLFxyXG4gICAgICAgIFwiZ2FtZXNcIixcclxuICAgICAgICBcIndpbnNcIixcclxuICAgICAgICBcIndpbl9yYXRlXCJcclxuICAgIF0sXHJcbiAgICBoZWFkZXI6IHtcclxuICAgICAgICBpZDogXCJDb3VudHJ5XCIsXHJcbiAgICAgICAgZ2FtZXM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgUGxheWVkXCIsXHJcbiAgICAgICAgd2luczogXCJOdW1iZXIgb2YgTWF0Y2hlcyBXb25cIixcclxuICAgICAgICB3aW5fcmF0ZTogXCJXaW4gUmF0ZVwiXHJcbiAgICB9LFxyXG4gICAgZm9ybWF0OiB7XHJcbiAgICAgICAgZ2FtZXM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5V29ybGRDdXBGaW5hbHMsIChkKSA9PiBkW1wiZ2FtZXNcIl0pKSxcclxuICAgICAgICB3aW5zOiBzcGFya2JhcihkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwRmluYWxzLCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwRmluYWxzLCAoZCkgPT4gZFtcIndpbl9yYXRlXCJdKVxyXG4gICAgICAgICksXHJcbiAgICB9LFxyXG4gICAgcm93czogMTAwLFxyXG59KTtcclxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcclxuICAgIGNvbnN0IHdpZHRoID0gOTI4O1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gNjAwO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yID0gZDMuc2NhbGVPcmRpbmFsKHBlcnNvbmFsX2NvbG91cnMpO1xyXG5cclxuICAgIGNvbnN0IGxpbmtzID0gZWRnZXNSdWdieVdvcmxkQ3VwRmluYWxzLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcbiAgICBjb25zdCBub2RlcyA9IGNpcmN1bGFyTm9kZXNSdWdieVdvcmxkQ3VwRmluYWxzLm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzU2NhbGUgPSBkM1xyXG4gICAgICAgIC5zY2FsZVNxcnQoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIGQzLm1heChub2RlcywgKGQpID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgNTBdKTtcclxuXHJcbiAgICBjb25zdCBsaW5rQ29sb3IgPSBkM1xyXG4gICAgICAgIC5zY2FsZUxpbmVhcigpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSlcclxuICAgICAgICAucmFuZ2UoW1wiIzJjYTAyY1wiLCBcIiNmZjdmMGVcIiwgXCIjZDYyNzI4XCJdKTtcclxuXHJcbiAgICBjb25zdCBzdmcgPSBkM1xyXG4gICAgICAgIC5jcmVhdGUoXCJzdmdcIilcclxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHQgKyA1MF0pXHJcbiAgICAgICAgLmF0dHIoXCJwcmVzZXJ2ZUFzcGVjdFJhdGlvXCIsIFwieE1pZFlNaWQgbWVldFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvO1wiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgYXJyb3doZWFkIG1hcmtlciBmb3IgZWFjaCBsaW5rXHJcbiAgICBjb25zdCBkZWZzID0gc3ZnLmFwcGVuZChcImRlZnNcIik7XHJcblxyXG4gICAgbGlua3MuZm9yRWFjaCgoZCwgaSkgPT4ge1xyXG4gICAgICAgIGRlZnMuYXBwZW5kKFwibWFya2VyXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYGFycm93aGVhZC0ke2l9YClcclxuICAgICAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAtMyA2IDZcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZYXCIsIDYpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWVwiLCAwKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDQpXHJcbiAgICAgICAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxyXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgXCJNMCwtM0w2LDBMMCwzXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBsaW5rQ29sb3IoZC53ZWlnaHQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkM1xyXG4gICAgICAgIC5mb3JjZVNpbXVsYXRpb24obm9kZXMpXHJcbiAgICAgICAgLmZvcmNlKFxyXG4gICAgICAgICAgICBcImxpbmtcIixcclxuICAgICAgICAgICAgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZCgoZCkgPT4gZC5pZClcclxuICAgICAgICApXHJcbiAgICAgICAgLmZvcmNlKFwiY2hhcmdlXCIsIGQzLmZvcmNlTWFueUJvZHkoKSlcclxuICAgICAgICAuZm9yY2UoXCJjZW50ZXJcIiwgZDMuZm9yY2VDZW50ZXIod2lkdGggLyAyLCBoZWlnaHQgLyAyKSlcclxuICAgICAgICAub24oXCJ0aWNrXCIsIHRpY2tlZCk7XHJcblxyXG4gICAgY29uc3QgbGluayA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC42KVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgLmRhdGEobGlua3MpXHJcbiAgICAgICAgLmpvaW4oXCJwYXRoXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IGxpbmtDb2xvcihkLndlaWdodCkpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGQpID0+IDUgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCAoZCkgPT4gcmFkaXVzU2NhbGUoZC53aW5zKSlcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IGNvbG9yKGQuZ3JvdXApKTtcclxuXHJcbiAgICAvLyBUb29sdGlwIHdpdGggZnVsbCB0ZWFtIHN0YXRzXHJcbiAgICBub2RlLmFwcGVuZChcInRpdGxlXCIpLnRleHQoXHJcbiAgICAgICAgKGQpID0+XHJcbiAgICAgICAgICAgIGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoXHJcbiAgICAgICAgICAgICAgICBkLndpbl9yYXRlICogMTAwXHJcbiAgICAgICAgICAgICkudG9GaXhlZCgxKX0lYFxyXG4gICAgKTtcclxuXHJcbiAgICBub2RlLmNhbGwoXHJcbiAgICAgICAgZDNcclxuICAgICAgICAgICAgLmRyYWcoKVxyXG4gICAgICAgICAgICAub24oXCJzdGFydFwiLCBkcmFnc3RhcnRlZClcclxuICAgICAgICAgICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxyXG4gICAgICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbHMgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiMzMzNcIilcclxuICAgICAgICAudGV4dCgoZCkgPT4gZC5pZCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdGlja2VkKCkge1xyXG4gICAgICAgIGxpbmsuYXR0cihcImRcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZS5hdHRyKFwiY3hcIiwgKGQpID0+IGQueCkuYXR0cihcImN5XCIsIChkKSA9PiBkLnkpO1xyXG5cclxuICAgICAgICBsYWJlbHMuYXR0cihcInhcIiwgKGQpID0+IGQueCkuYXR0cihcInlcIiwgKGQpID0+IGQueSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwLjMpLnJlc3RhcnQoKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQuc3ViamVjdC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBudWxsO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBjZWxsIGlzIHJlLXJ1biwgc3RvcCB0aGUgcHJldmlvdXMgc2ltdWxhdGlvbi4gKFRoaXMgZG9lc27igJl0XHJcbiAgICAvLyByZWFsbHkgbWF0dGVyIHNpbmNlIHRoZSB0YXJnZXQgYWxwaGEgaXMgemVybyBhbmQgdGhlIHNpbXVsYXRpb24gd2lsbFxyXG4gICAgLy8gc3RvcCBuYXR1cmFsbHksIGJ1dCBpdOKAmXMgYSBnb29kIHByYWN0aWNlLilcclxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHNpbXVsYXRpb24uc3RvcCgpKTtcclxuXHJcbiAgICByZXR1cm4gc3ZnLm5vZGUoKTtcclxufVxyXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWF0Y2hEYXRhUnVnYnlXb3JsZEN1cFRlc3QgPSAoYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJydWdieS5jc3ZcIikuY3N2KHsgdHlwZWQ6IHRydWUgfSkpXHJcbiAgICAuZmlsdGVyKGQgPT4gZC5jb21wZXRpdGlvbl9uYW1lID09PSBcIlJ1Z2J5IFdvcmxkIEN1cFwiKVxyXG4gICAgLm1hcChkID0+ICh7XHJcbiAgICAgICAgLi4uZCxcclxuICAgICAgICBob21lX3Njb3JlOiArZC5ob21lX3Njb3JlLFxyXG4gICAgICAgIGF3YXlfc2NvcmU6ICtkLmF3YXlfc2NvcmUsXHJcbiAgICAgICAgbWF0Y2hfZGF0ZTogbmV3IERhdGUoZC5tYXRjaF9kYXRlKSxcclxuICAgICAgICB5ZWFyOiBuZXcgRGF0ZShkLm1hdGNoX2RhdGUpLmdldEZ1bGxZZWFyKClcclxuICAgIH0pKVxyXG4gICAgLnNvcnQoKGEsIGIpID0+IHtcclxuICAgICAgICBpZiAoYS55ZWFyICE9PSBiLnllYXIpIHJldHVybiBhLnllYXIgLSBiLnllYXI7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGIubWF0Y2hfZGF0ZSkgLSBuZXcgRGF0ZShhLm1hdGNoX2RhdGUpO1xyXG4gICAgfSkucmVkdWNlKChhY2MsIG1hdGNoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeWVhciA9IG1hdGNoLnllYXI7XHJcbiAgICAgICAgaWYgKCFhY2NbeWVhcl0pIGFjY1t5ZWFyXSA9IFtdO1xyXG4gICAgICAgIGlmIChhY2NbeWVhcl0ubGVuZ3RoIDwgOCkgYWNjW3llYXJdLnB1c2gobWF0Y2gpO1xyXG4gICAgICAgIHJldHVybiBhY2M7XHJcbiAgICB9LCB7fSk7XHJcblxyXG50ZXN0TWF0Y2hlcyA9IE9iamVjdC52YWx1ZXMobWF0Y2hEYXRhUnVnYnlXb3JsZEN1cFRlc3QpXHJcbiAgICAuZmxhdCgpXHJcbiAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYS5tYXRjaF9kYXRlKSAtIG5ldyBEYXRlKGIubWF0Y2hfZGF0ZSkpXHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICAuLi5kLFxyXG4gICAgICAgIHdpbm5lcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5ob21lX3RlYW0gOiBkLmF3YXlfdGVhbSxcclxuICAgICAgICBsb3NlcjogZC5ob21lX3Njb3JlID4gZC5hd2F5X3Njb3JlID8gZC5hd2F5X3RlYW0gOiBkLmhvbWVfdGVhbVxyXG4gICAgfSkpO1xyXG5cclxudGVhbVN0YXRzUnVnYnlXb3JsZEN1cFRlc3QgPSB7XHJcbiAgICBjb25zdCBzdGF0cyA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAoY29uc3QgZCBvZiB0ZXN0TWF0Y2hlcykge1xyXG4gICAgICAgIGZvciAoY29uc3QgdGVhbSBvZiBbZC5ob21lX3RlYW0sIGQuYXdheV90ZWFtXSkge1xyXG4gICAgICAgICAgICBpZiAoIXN0YXRzLmhhcyh0ZWFtKSkgc3RhdHMuc2V0KHRlYW0sIHsgdGVhbSwgZ2FtZXM6IDAsIHdpbnM6IDAgfSk7XHJcbiAgICAgICAgICAgIHN0YXRzLmdldCh0ZWFtKS5nYW1lcysrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdGF0cy5nZXQoZC53aW5uZXIpLndpbnMrKztcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHN0YXRzLnZhbHVlcygpKS5tYXAoZCA9PiAoe1xyXG4gICAgICAgIC4uLmQsXHJcbiAgICAgICAgd2luX3JhdGU6IGQud2lucyAvIGQuZ2FtZXNcclxuICAgIH0pKS5zb3J0KChhLCBiKSA9PiBiLndpbnMgLSBhLndpbnMgfHwgYi5nYW1lcyAtIGEuZ2FtZXMgfHwgYi53aW5fcmF0ZSAtIGEud2luX3JhdGUpO1xyXG59O1xyXG5cclxuZWRnZXNSdWdieVdvcmxkQ3VwVGVzdCA9IHtcclxuICAgIGNvbnN0IGVkZ2VNYXAgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKGNvbnN0IGQgb2YgdGVzdE1hdGNoZXMpIHtcclxuICAgICAgICBjb25zdCBbdGVhbTEsIHRlYW0yXSA9IFtkLmhvbWVfdGVhbSwgZC5hd2F5X3RlYW1dLnNvcnQoKTtcclxuICAgICAgICBjb25zdCBrZXkgPSBgJHt0ZWFtMX18JHt0ZWFtMn1gO1xyXG4gICAgICAgIGlmICghZWRnZU1hcC5oYXMoa2V5KSkgZWRnZU1hcC5zZXQoa2V5LCB7IHRlYW0xLCB0ZWFtMiwgd2luc190ZWFtMTogMCwgd2luc190ZWFtMjogMCwgdG90YWw6IDAgfSk7XHJcbiAgICAgICAgY29uc3QgZWRnZSA9IGVkZ2VNYXAuZ2V0KGtleSk7XHJcbiAgICAgICAgZWRnZS50b3RhbCsrO1xyXG4gICAgICAgIGlmIChkLndpbm5lciA9PT0gdGVhbTEpIGVkZ2Uud2luc190ZWFtMSsrO1xyXG4gICAgICAgIGVsc2UgZWRnZS53aW5zX3RlYW0yKys7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlZGdlTWFwLnZhbHVlcygpKS5tYXAoKHsgdGVhbTEsIHRlYW0yLCB3aW5zX3RlYW0xLCB3aW5zX3RlYW0yLCB0b3RhbCB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZG9taW5hbnQgPSB3aW5zX3RlYW0xID49IHdpbnNfdGVhbTIgPyB0ZWFtMSA6IHRlYW0yO1xyXG4gICAgICAgIGNvbnN0IHdlYWtlciA9IHdpbnNfdGVhbTEgPCB3aW5zX3RlYW0yID8gdGVhbTEgOiB0ZWFtMjtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzb3VyY2U6IGRvbWluYW50LFxyXG4gICAgICAgICAgICB0YXJnZXQ6IHdlYWtlcixcclxuICAgICAgICAgICAgd2VpZ2h0OiBNYXRoLm1heCh3aW5zX3RlYW0xLCB3aW5zX3RlYW0yKSAvIHRvdGFsXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxubm9kZXNSdWdieVdvcmxkQ3VwVGVzdCA9IHRlYW1TdGF0c1J1Z2J5V29ybGRDdXBUZXN0XHJcbiAgICAubWFwKGQgPT4gKHtcclxuICAgICAgICBpZDogZC50ZWFtLFxyXG4gICAgICAgIGdyb3VwOiBkLndpbnMsXHJcbiAgICAgICAgd2luczogZC53aW5zLFxyXG4gICAgICAgIGdhbWVzOiBkLmdhbWVzLFxyXG4gICAgICAgIHdpbl9yYXRlOiBkLndpbl9yYXRlLFxyXG4gICAgICAgIHRpdGxlOiBgJHtkLnRlYW19XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoZC53aW5fcmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYFxyXG4gICAgfSkpXHJcbiAgICAuc29ydCgoYSwgYikgPT5cclxuICAgICAgICBiLndpbnMgLSBhLndpbnMgfHxcclxuICAgICAgICBiLmdhbWVzIC0gYS5nYW1lcyB8fFxyXG4gICAgICAgIGIud2luX3JhdGUgLSBhLndpbl9yYXRlXHJcbiAgICApO1xyXG5cclxuY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBUZXN0ID0ge1xyXG4gICAgY29uc3QgcmFkaXVzID0gMjUwO1xyXG4gICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjtcclxuICAgIGNvbnN0IGNlbnRlclkgPSAzMDA7XHJcbiAgICBjb25zdCBhbmdsZVN0ZXAgPSAoMiAqIE1hdGguUEkpIC8gbm9kZXNSdWdieVdvcmxkQ3VwVGVzdC5sZW5ndGg7XHJcblxyXG4gICAgcmV0dXJuIG5vZGVzUnVnYnlXb3JsZEN1cFRlc3QubWFwKChub2RlLCBpKSA9PiAoe1xyXG4gICAgICAgIC4uLm5vZGUsXHJcbiAgICAgICAgZng6IGNlbnRlclggKyByYWRpdXMgKiBNYXRoLmNvcyhpICogYW5nbGVTdGVwKSxcclxuICAgICAgICBmeTogY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGkgKiBhbmdsZVN0ZXApXHJcbiAgICB9KSk7XHJcbn07XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJJbnB1dHMudGFibGUobm9kZXNSdWdieVdvcmxkQ3VwVGVzdCwge1xyXG4gICAgY29sdW1uczogW1xyXG4gICAgICAgIFwiaWRcIixcclxuICAgICAgICBcImdhbWVzXCIsXHJcbiAgICAgICAgXCJ3aW5zXCIsXHJcbiAgICAgICAgXCJ3aW5fcmF0ZVwiXHJcbiAgICBdLFxyXG4gICAgaGVhZGVyOiB7XHJcbiAgICAgICAgaWQ6IFwiQ291bnRyeVwiLFxyXG4gICAgICAgIGdhbWVzOiBcIk51bWJlciBvZiBNYXRjaGVzIFBsYXllZFwiLFxyXG4gICAgICAgIHdpbnM6IFwiTnVtYmVyIG9mIE1hdGNoZXMgV29uXCIsXHJcbiAgICAgICAgd2luX3JhdGU6IFwiV2luIFJhdGVcIlxyXG4gICAgfSxcclxuICAgIGZvcm1hdDoge1xyXG4gICAgICAgIGdhbWVzOiBzcGFya2JhcihkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwVGVzdCwgKGQpID0+IGRbXCJnYW1lc1wiXSkpLFxyXG4gICAgICAgIHdpbnM6IHNwYXJrYmFyKGQzLm1heChub2Rlc1J1Z2J5V29ybGRDdXBUZXN0LCAoZCkgPT4gZFtcIndpbnNcIl0pKSxcclxuICAgICAgICB3aW5fcmF0ZTogc3BhcmtiYXJQZXJjZW50KFxyXG4gICAgICAgICAgICBkMy5tYXgobm9kZXNSdWdieVdvcmxkQ3VwVGVzdCwgKGQpID0+IGRbXCJ3aW5fcmF0ZVwiXSlcclxuICAgICAgICApLFxyXG4gICAgfSxcclxuICAgIHJvd3M6IDEwMCxcclxufSk7XHJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XHJcbiAgICBjb25zdCB3aWR0aCA9IDkyODtcclxuICAgIGNvbnN0IGhlaWdodCA9IDYwMDtcclxuXHJcbiAgICBjb25zdCBjb2xvciA9IGQzLnNjYWxlT3JkaW5hbChwZXJzb25hbF9jb2xvdXJzKTtcclxuXHJcbiAgICBjb25zdCBsaW5rcyA9IGVkZ2VzUnVnYnlXb3JsZEN1cFRlc3QubWFwKChkKSA9PiAoeyAuLi5kIH0pKTtcclxuICAgIGNvbnN0IG5vZGVzID0gY2lyY3VsYXJOb2Rlc1J1Z2J5V29ybGRDdXBUZXN0Lm1hcCgoZCkgPT4gKHsgLi4uZCB9KSk7XHJcblxyXG4gICAgY29uc3QgcmFkaXVzU2NhbGUgPSBkM1xyXG4gICAgICAgIC5zY2FsZVNxcnQoKVxyXG4gICAgICAgIC5kb21haW4oWzAsIGQzLm1heChub2RlcywgKGQpID0+IGQud2lucyldKVxyXG4gICAgICAgIC5yYW5nZShbNSwgNTBdKTtcclxuXHJcbiAgICBjb25zdCBsaW5rQ29sb3IgPSBkM1xyXG4gICAgICAgIC5zY2FsZUxpbmVhcigpXHJcbiAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSlcclxuICAgICAgICAucmFuZ2UoW1wiIzJjYTAyY1wiLCBcIiNmZjdmMGVcIiwgXCIjZDYyNzI4XCJdKTtcclxuXHJcbiAgICBjb25zdCBzdmcgPSBkM1xyXG4gICAgICAgIC5jcmVhdGUoXCJzdmdcIilcclxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxyXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodClcclxuICAgICAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHQgKyA1MF0pXHJcbiAgICAgICAgLmF0dHIoXCJwcmVzZXJ2ZUFzcGVjdFJhdGlvXCIsIFwieE1pZFlNaWQgbWVldFwiKVxyXG4gICAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvO1wiKTtcclxuXHJcbiAgICAvLyBDcmVhdGUgYSB1bmlxdWUgYXJyb3doZWFkIG1hcmtlciBmb3IgZWFjaCBsaW5rXHJcbiAgICBjb25zdCBkZWZzID0gc3ZnLmFwcGVuZChcImRlZnNcIik7XHJcblxyXG4gICAgbGlua3MuZm9yRWFjaCgoZCwgaSkgPT4ge1xyXG4gICAgICAgIGRlZnMuYXBwZW5kKFwibWFya2VyXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYGFycm93aGVhZC0ke2l9YClcclxuICAgICAgICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFwiMCAtMyA2IDZcIilcclxuICAgICAgICAgICAgLmF0dHIoXCJyZWZYXCIsIDYpXHJcbiAgICAgICAgICAgIC5hdHRyKFwicmVmWVwiLCAwKVxyXG4gICAgICAgICAgICAuYXR0cihcIm1hcmtlcldpZHRoXCIsIDIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwibWFya2VySGVpZ2h0XCIsIDQpXHJcbiAgICAgICAgICAgIC5hdHRyKFwib3JpZW50XCIsIFwiYXV0b1wiKVxyXG4gICAgICAgICAgICAuYXBwZW5kKFwicGF0aFwiKVxyXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgXCJNMCwtM0w2LDBMMCwzXCIpXHJcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBsaW5rQ29sb3IoZC53ZWlnaHQpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkM1xyXG4gICAgICAgIC5mb3JjZVNpbXVsYXRpb24obm9kZXMpXHJcbiAgICAgICAgLmZvcmNlKFxyXG4gICAgICAgICAgICBcImxpbmtcIixcclxuICAgICAgICAgICAgZDMuZm9yY2VMaW5rKGxpbmtzKS5pZCgoZCkgPT4gZC5pZClcclxuICAgICAgICApXHJcbiAgICAgICAgLmZvcmNlKFwiY2hhcmdlXCIsIGQzLmZvcmNlTWFueUJvZHkoKSlcclxuICAgICAgICAuZm9yY2UoXCJjZW50ZXJcIiwgZDMuZm9yY2VDZW50ZXIod2lkdGggLyAyLCBoZWlnaHQgLyAyKSlcclxuICAgICAgICAub24oXCJ0aWNrXCIsIHRpY2tlZCk7XHJcblxyXG4gICAgY29uc3QgbGluayA9IHN2Z1xyXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXHJcbiAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxyXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC42KVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJwYXRoXCIpXHJcbiAgICAgICAgLmRhdGEobGlua3MpXHJcbiAgICAgICAgLmpvaW4oXCJwYXRoXCIpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IGxpbmtDb2xvcihkLndlaWdodCkpXHJcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGQpID0+IDUgKiBkLndlaWdodClcclxuICAgICAgICAuYXR0cihcIm1hcmtlci1lbmRcIiwgKGQsIGkpID0+IGB1cmwoI2Fycm93aGVhZC0ke2l9KWApO1xyXG5cclxuICAgIGNvbnN0IG5vZGUgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcclxuICAgICAgICAuZGF0YShub2RlcylcclxuICAgICAgICAuam9pbihcImNpcmNsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiclwiLCAoZCkgPT4gcmFkaXVzU2NhbGUoZC53aW5zKSlcclxuICAgICAgICAuYXR0cihcImZpbGxcIiwgKGQpID0+IGNvbG9yKGQuZ3JvdXApKTtcclxuXHJcbiAgICAvLyBUb29sdGlwIHdpdGggZnVsbCB0ZWFtIHN0YXRzXHJcbiAgICBub2RlLmFwcGVuZChcInRpdGxlXCIpLnRleHQoXHJcbiAgICAgICAgKGQpID0+XHJcbiAgICAgICAgICAgIGAke2QuaWR9XFxuV2luczogJHtkLndpbnN9XFxuR2FtZXM6ICR7ZC5nYW1lc31cXG5XaW4gUmF0ZTogJHsoXHJcbiAgICAgICAgICAgICAgICBkLndpbl9yYXRlICogMTAwXHJcbiAgICAgICAgICAgICkudG9GaXhlZCgxKX0lYFxyXG4gICAgKTtcclxuXHJcbiAgICBub2RlLmNhbGwoXHJcbiAgICAgICAgZDNcclxuICAgICAgICAgICAgLmRyYWcoKVxyXG4gICAgICAgICAgICAub24oXCJzdGFydFwiLCBkcmFnc3RhcnRlZClcclxuICAgICAgICAgICAgLm9uKFwiZHJhZ1wiLCBkcmFnZ2VkKVxyXG4gICAgICAgICAgICAub24oXCJlbmRcIiwgZHJhZ2VuZGVkKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBsYWJlbHMgPSBzdmdcclxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxyXG4gICAgICAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmRhdGEobm9kZXMpXHJcbiAgICAgICAgLmpvaW4oXCJ0ZXh0XCIpXHJcbiAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxyXG4gICAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMTBweFwiKVxyXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIiMzMzNcIilcclxuICAgICAgICAudGV4dCgoZCkgPT4gZC5pZCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdGlja2VkKCkge1xyXG4gICAgICAgIGxpbmsuYXR0cihcImRcIiwgKGQpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZHggPSBkLnRhcmdldC54IC0gZC5zb3VyY2UueDtcclxuICAgICAgICAgICAgY29uc3QgZHkgPSBkLnRhcmdldC55IC0gZC5zb3VyY2UueTtcclxuICAgICAgICAgICAgY29uc3QgZHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xyXG4gICAgICAgICAgICBjb25zdCByID0gcmFkaXVzU2NhbGUoZC50YXJnZXQud2lucyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gKGRyIC0gcikgLyBkcjtcclxuICAgICAgICAgICAgY29uc3QgdHggPSBkLnNvdXJjZS54ICsgZHggKiByYXRpbztcclxuICAgICAgICAgICAgY29uc3QgdHkgPSBkLnNvdXJjZS55ICsgZHkgKiByYXRpbztcclxuICAgICAgICAgICAgcmV0dXJuIGBNJHtkLnNvdXJjZS54fSwke2Quc291cmNlLnl9TCR7dHh9LCR7dHl9YDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbm9kZS5hdHRyKFwiY3hcIiwgKGQpID0+IGQueCkuYXR0cihcImN5XCIsIChkKSA9PiBkLnkpO1xyXG5cclxuICAgICAgICBsYWJlbHMuYXR0cihcInhcIiwgKGQpID0+IGQueCkuYXR0cihcInlcIiwgKGQpID0+IGQueSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ3N0YXJ0ZWQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50LmFjdGl2ZSkgc2ltdWxhdGlvbi5hbHBoYVRhcmdldCgwLjMpLnJlc3RhcnQoKTtcclxuICAgICAgICBldmVudC5zdWJqZWN0LmZ4ID0gZXZlbnQuc3ViamVjdC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC5zdWJqZWN0Lnk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ2dlZChldmVudCkge1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBldmVudC54O1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBldmVudC55O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdlbmRlZChldmVudCkge1xyXG4gICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDApO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnggPSBudWxsO1xyXG4gICAgICAgIGV2ZW50LnN1YmplY3QuZnkgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFdoZW4gdGhpcyBjZWxsIGlzIHJlLXJ1biwgc3RvcCB0aGUgcHJldmlvdXMgc2ltdWxhdGlvbi4gKFRoaXMgZG9lc27igJl0XHJcbiAgICAvLyByZWFsbHkgbWF0dGVyIHNpbmNlIHRoZSB0YXJnZXQgYWxwaGEgaXMgemVybyBhbmQgdGhlIHNpbXVsYXRpb24gd2lsbFxyXG4gICAgLy8gc3RvcCBuYXR1cmFsbHksIGJ1dCBpdOKAmXMgYSBnb29kIHByYWN0aWNlLilcclxuICAgIGludmFsaWRhdGlvbi50aGVuKCgpID0+IHNpbXVsYXRpb24uc3RvcCgpKTtcclxuXHJcbiAgICByZXR1cm4gc3ZnLm5vZGUoKTtcclxufVxyXG4ifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>